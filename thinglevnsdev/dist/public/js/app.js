/*
 RequireJS text 1.0.8 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/* =========================================================
 * bootstrap-modal.js v2.1.0
 * http://twitter.github.com/bootstrap/javascript.html#modals
 * =========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */

/* ===================================================
 * bootstrap-transition.js v2.1.0
 * http://twitter.github.com/bootstrap/javascript.html#transitions
 * ===================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */

/*
 * jScrollPane - v2.0.0beta12 - 2012-05-14
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */

/*
 * jQuery Combobox Plugin 1.0b4
 * Copyright 2011 Eugene Poltorakov (http://poltorakov.com) 
 * Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php
 * 
 * There are several event which triggered from this plugin on select element.
 * - update_position - Trigger before update position of dropdown. 
 *                     It gets calculated offset object as second argument which could be changed to affect position of dropdown;
 * - before_show - trigger before show dropdown;
 * - before_hide - trigger before hide dropdown;
 * - combo_init - trigger after init;
 * 
 * 
 * todo: 
 * - somehow handle mobile devices
 * - add adjustWidth & basic theme support overview in readme
 * - make multiselect widget using checkboxes
 */

/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */

/* ==========================================================
 * bootstrap-carousel.js v2.1.0
 * http://twitter.github.com/bootstrap/javascript.html#carousel
 * ==========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */

/**
 * jQuery Masonry v2.1.05
 * A dynamic layout plugin for jQuery
 * The flip-side of CSS Floats
 * http://masonry.desandro.com
 *
 * Licensed under the MIT license.
 * Copyright 2012 David DeSandro
 */

/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.7.2
 *
 */

/*!
 * jQuery Form Plugin
 * version: 3.09 (16-APR-2012)
 * @requires jQuery v1.3.2 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses:
 *    http://malsup.github.com/mit-license.txt
 *    http://malsup.github.com/gpl-license-v2.txt
 */

/*!
 * jQuery Tools v1.2.7 - The missing UI library for the Web
 * 
 * scrollable/scrollable.js
 * scrollable/scrollable.autoscroll.js
 * scrollable/scrollable.navigator.js
 * 
 * NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.
 * 
 * http://flowplayer.org/tools/
 * 
 */

/* ============================================================
 * bootstrap-dropdown.js v2.1.0
 * http://twitter.github.com/bootstrap/javascript.html#dropdowns
 * ============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */

function splitPath(e){var t=new Array,n={},r=e.split(/[/?&#]/);for(var i=0;i<r.length;i++){var s=r[i].split("=");s.length==1?t.push(s[0]):n[s[0]]=s[1]}return t.push(n),t}function fuzzyDate(e){var t=[[60,"just now",1],[120,"1 minute ago","1 minute from now"],[3600,"minutes",60],[7200,"1 hour ago","1 hour from now"],[86400,"hours",3600],[172800,"yesterday","tomorrow"],[604800,"days",86400],[1209600,"last week","next week"],[2419200,"weeks",604800],[4838400,"last month","next month"],[29030400,"months",2419200],[58060800,"last year","next year"],[290304e4,"years",29030400],[580608e4,"last century","next century"],[580608e5,"centuries",290304e4]],n=(new Date-e)/1e3,r="ago",i=1;n<0&&(n=Math.abs(n),r="from now",i=2);var s=0,o;while(o=t[s++])if(n<o[0])return typeof o[2]=="string"?o[i]:Math.floor(n/o[2])+" "+o[1]+" "+r;return time}(function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("text",[],function(){var a,f;return a={version:"1.0.8",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}return t},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&(u[e]=n),r(n)},load:function(e,t,n,u){if(u.isBuild&&!u.inlineText)n();else{var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})}},write:function(e,t,n){if(u.hasOwnProperty(t)){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}},a.createXhr()?a.get=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(f=require.nodeRequire("fs"),a.get=function(e,t){var n=f.readFileSync(e,"utf8");n.indexOf("ï»¿")===0&&(n=n.substring(1)),t(n)}):typeof Packages!="undefined"&&(a.get=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a})})(),define("text!tpl/title.html",[],function(){return'<% if (title) { %>\n<hgroup id="things-title">\n    <h2><%= subtitle %></h2>\n    <h1><%= title %></h1>\n</hgroup>\n<% } %>'}),define("views/title",["require","text!tpl/title.html"],function(e){var t=e("text!tpl/title.html");return Backbone.View.extend({template:_.template(t),render:function(){$("#things-title","#main").remove(),this.options.title&&$(this.el).html(this.template({title:this.options.title,subtitle:this.options.subtitle}))}})}),define("views/titled",["require","views/title"],function(e){var t=e("views/title");return Backbone.View.extend({render:function(){var e=new t({title:this.options.title,subtitle:this.options.subtitle});e.render(),$(this.el).append($(e.el)),this.options.view&&(this.options.view.render(),$(this.el).append($(this.options.view.el))),this.options.html&&$(this.el).append($(this.options.html))},undelegateEvents:function(){return this.options.view&&typeof this.options.view.undelegateEvents=="function"&&this.options.view.undelegateEvents(),this},delegateEvents:function(){return this.options.view&&typeof this.options.view.delegateEvents=="function"&&this.options.view.delegateEvents(),this}})}),define("helpers",["require"],function(e){var t={baseURL:document.location.protocol+"//"+document.location.host+document.location.pathname,staticURL:function(e){return this.baseURL+"/"+e}};return t.ViewHelper=function(){this._ensureElement(),this.delegateEvents(),this.initialize()},_.extend(t.ViewHelper.prototype,Backbone.View.prototype,{el:"body"}),t.ViewHelper.extend=Backbone.View.extend,t}),define("models",[],function(){var e=Backbone.Model.prototype.fetch;Backbone.Model.prototype.fetch=function(t){var n=this,r=t.success;return t.success=function(){n._syncAttributes={},r&&r.apply(this,arguments)},t.error||(t.error=function(){App.router.navigate("404",{trigger:!0})}),e.call(this,t),this};var t=Backbone.Model.prototype.set;Backbone.Model.prototype.set=function(e,n,r){t.call(this,e,n,r);var i;return _.isObject(e)||e==null?(i=e,r=n):(i={},i[e]=n),this._syncAttributes=this._syncAttributes||{},_.extend(this._syncAttributes,i),this},Backbone.Model.prototype.method=function(e,t,n){typeof t=="undefined"&&(t="read"),typeof n=="undefined"&&(n={}),n.url=n.url||this.url()+"/"+e,n.contentType="application/json",n.data=JSON.stringify(n.data),Backbone.sync(t,this,n)},Backbone.Model.prototype.sync=function(e,t,n){e=="update"&&!n.data&&(n.contentType="application/json",n.data=JSON.stringify(t._syncAttributes)),t._syncAttributes={};var r=this,i=n.success;return n.success=function(){typeof i=="function"&&i.apply(this,arguments),r._syncAttributes={}},Backbone.sync(e,t,n)};var n={Thing:Backbone.Model.extend({idAttribute:"_id",urlRoot:"/api/things",_wallPicture:null,_smallPicturesPercent:.5,initialize:function(){this.get("likers")||this.set("likers",[])},getDate:function(){return new Date(this.get("createdAt"))},getWallPicture:function(){if(this._wallPicture!=null)return this._wallPicture;var e=Math.random()<=this._smallPicturesPercent?"small":"medium",t=this.getCoverPicture(e);return e=="medium"&&t.width!=App.Config.get("imageSizeMap").medium.width&&(t=this.getCoverPicture("small")),this._wallPicture=t,this._wallPicture},getCoverPicture:function(e){var t=0,n=this.get("pictures");return n.length>1&&(t=_.find(this.get("pictures"),function(e){return e.isCover})),this.getPicture(t||0,e)},getPicture:function(e,t){var n=typeof e=="object"?e:this.get("pictures")[e];return typeof n=="undefined"?{}:_.find(n.sizes,function(e){return e.name==t})},share:function(){var e=this;App.currentUser.checkAuth(function(){var t=document.location.protocol+"//"+document.location.host,n={method:"feed",link:t+"/#!things/"+e.get("_id"),picture:e.getCoverPicture("medium").url,name:e.get("title"),description:e.get("description")},r=window.location.pathname+window.location.search+window.location.hash;FB.ui(n,function(t){t&&t.post_id&&(window._gaq&&window._gaq.push(["_trackSocial","facebook","share",n.link,r]),console.log("Thingle is shared to Facebook."),e.method("share","create"))})},!0)}}),Tag:Backbone.Model.extend({idAttribute:"_id",url:"/api/tags"}),Comment:Backbone.Model.extend({idAttribute:"_id",initialize:function(e){this.urlRoot="/api/things/"+e.thing+"/comments"}}),Deck:Backbone.Model.extend({idAttribute:"_id",url:"/api/decks",initialize:function(){var e=Backbone.Collection.extend({model:App.Models.Thing,url:"/api/things"});this.things=new e,this.things.url="/api/decks/"+this.get("_id")+"/things"}}),Category:Backbone.Model.extend({url:"/api/categories"}),User:Backbone.Model.extend({idAttribute:"_id",urlRoot:"/api/users",follow:function(e,t){var n=this;App.currentUser.checkAuth(function(){typeof t=="undefined"&&(t=!1);var r=t?"delete":"create",i="/api/users/"+App.currentUser.get("_id")+"/followings";t&&(i+="/"+n.get("_id")),n.method("",r,{data:{userId:n.get("_id")},url:i,success:function(){var r=n.get("_id");if(t){var i=App.currentUser.attributes.followings.indexOf(r);App.currentUser.attributes.followings.splice(i,1)}else App.currentUser.attributes.followings.push(r);typeof e=="function"&&e.apply(this,arguments)}})},!0)},unfollow:function(e){this.follow(e,!0)}}),CurrentUser:Backbone.Model.extend({urlRoot:"/api/session",_authenticated:null,autoAuth:function(e,t){console.log("autoAuth");var n=this,r=function(){FB.getLoginStatus(function(t){t.status&&t.status==="connected"?e():(App.on("fb-authed",e),App.trigger("fb-login"))})};typeof FB=="undefined"?App.on("fb-loaded",r):r()},checkAuth:function(e,t,n){var r=this;if(r._authenticated===null)return r._checkAuthRemote(e,t,n);this._authenticated?(typeof e=="function"&&e(),App.trigger("authorized")):(typeof e=="function"&&App.on("auth",e),t&&App.trigger("unauthorized"))},_checkAuthRemote:function(e,t,n){var r=this;r.fetch({success:function(){r._authenticated=!0,r.id="default",typeof e=="function"&&e(),App.trigger("authorized")},error:function(n,i){i.status==401&&(r._authenticated=!1),typeof e=="function"&&App.on("auth",e),t&&App.trigger("unauthorized")}})},authenticate:function(e,t){if(!e){typeof t=="function"&&t();return}var n=this;n.set("access_token",e),n.save({},{success:function(){n._authenticated=!0,n.id="default",console.log("user authed"),App.trigger("auth"),typeof t=="function"&&t()},error:function(e,r){r.status==401&&(n._authenticated=!1),App.trigger("auth-failed"),typeof t=="function"&&t()}})},login:function(){var e=this;App.trigger("login")},logout:function(e){var t=this;t.destroy({success:function(){t._authenticated=!1,t.id=null,typeof e=="function"&&e()}})}}),Notification:Backbone.Model.extend({idAttribute:"_id",urlRoot:"/api/profile/notifications"})},r={Things:Backbone.Collection.extend({model:n.Thing,url:"/api/things"}),Comments:Backbone.Collection.extend({model:n.Comment,initialize:function(e){this.url="/api/things/"+e+"/comments"}}),Decks:Backbone.Collection.extend({model:n.Deck,url:"/api/decks"}),Users:Backbone.Collection.extend({model:n.User,url:"/api/users"}),Notifications:Backbone.Collection.extend({model:n.Notification,url:"/api/profile/notifications"})};return{Models:n,Collections:r}}),define("analytics",[],function(){if(App.Config.get("ga")){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),window._gaq=window._gaq||[],window._gaq.push(["_setAccount",App.Config.get("ga")]),$(document).on("click","a[href*='http://']:not([href*='"+window.location.hostname+"'])",function(){window._gaq.push(["_trackEvent","outbound_links","click",this.href])})}}),define("metadata",[],function(){function t(e){var t=e.title&&(e.title.slice(0,8)=="Thingle "||e.title.slice(e.title.length-8)==" Thingle"?e.title:e.title+" - Thingle")||"Thingle",n=e.description||"",r=e.keywords&&e.keywords instanceof Array&&e.keywords.join(",")||e.keywords||"",i=e.robots||"";document.title=t,$("meta[name=description]").attr("content",n),$("meta[name=keywords]").attr("content",r),$("meta[name=robots]").attr("content",i)}var e={title:document.title,description:$("meta[name=description]").attr("content"),keywords:$("meta[name=keywords]").attr("content"),robots:$("meta[name=robots]").attr("content")};App.on("meta:reset",function(){t(e)}),App.on("meta:change",function(e){t(e)})}),define("backbone-override",[],function(){Backbone.History.prototype.getHash=function(){var e=(window||this).location.href.match(/#(.*)$/),t=e?e[1]:"";return decodeURIComponent(t).replace(/^!/,"")},Backbone.History.prototype._updateHash=function(e,t,n){t="!"+t,n?e.replace(e.href.replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t},Backbone.History.prototype.loadUrl=function(e){var t=this.fragment=this.getFragment(e),n=_.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return/^\//.test(t)&&(t=t.slice(1)),t="/#"+t,window._gaq&&window._gaq.push(["_trackPageview",t]),n}}),define("helpers/cookie",{getCookie:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):undefined},setCookie:function(e,t,n){n=n||{};var r=n.expires;if(typeof r=="number"&&r){var i=new Date;i.setTime(i.getTime()+r*1e3),r=n.expires=i}r&&r.toUTCString&&(n.expires=r.toUTCString()),t=encodeURIComponent(t);var s=e+"="+t;for(var o in n){s+="; "+o;var u=n[o];u!==!0&&(s+="="+u)}document.cookie=s},deleteCookie:function(e){this.setCookie(e,null,{expires:-1})}}),require.config({baseUrl:"/1348135696/js",paths:{text:"lib/text"}});var App={};_.extend(App,Backbone.Events),App.history={},App.page=function(e,t,n,r){App.trigger("meta:reset"),typeof n=="function"&&(r=n,n=!1),n=n?n:!1;var i=document.location.hash.replace(/\W+/g,"-");i=i||"-";if(n&&$("#content #main").data("viewName")){var s=$("#content #main");App.history[s.data("viewName")]={page:s,scroll:$("#content").scrollTop()},s.detach(),s.data("view").undelegateEvents(),$("#content").prepend($('<section id="main" />')),delete s}App.history[i]&&$("#content #main").data("restoreState")?($("#content #main").remove(),$("#content").append(App.history[i].page),$("#content").scrollTop(App.history[i].scroll),App.history[i].page.data("view").delegateEvents()):($("#content #",i).empty().remove(),$("#content #main").data("viewName",i),App.view(e,t,n,function(){typeof r=="function"&&r(),$("#content #main").data("view",App.currentPage)})),delete App.history[i],$("#content #main").data("restoreState",n)},App.view=function(e,t,n,r){typeof n=="function"&&(r=n,n=!1),require(["views/"+e,"views/titled"],function(e,i){var s=new e(t);if(s.title){var o=new i({title:s.title,subtitle:s.category?"/ "+s.category+" /":"",view:s});o.auth=s.auth,s=o}var u=function(){s.render(),$(s.el).parents().length===0&&(typeof App.currentPage=="object"&&(typeof App.currentPage.destroy=="function"&&App.currentPage.destroy(),n||(App.currentPage.remove(),App.currentPage.undelegateEvents()),s.delegateEvents()),$("section#main").empty().append($(s.el)),App.currentPage=s),typeof r=="function"&&r()};s.auth?App.currentUser.checkAuth(u,!0):u()})},App.popup=function(e,t){var n=e.replace("/","-")+"-popup";$("#"+n).remove();var r=$('<div class="modal fade thingle-modal" />').attr("id",n);return $("body").append(r),t=t||{},t.el=r,App.view("popups/"+e,t,function(){r.modal("show")}),r},App.init=function(e){var t=function(){require(["helpers","models","analytics","metadata","backbone-override"],function(t,n){App.Helpers=t,App.Models=n.Models,App.Collections=n.Collections,App.currentUser=new App.Models.CurrentUser;var r=$("body").attr("helper"),i=function(){$("[view]").each(function(){App.view($(this).attr("view"),{el:this})})};App.isMobile=navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry)/),App.isMobile&&$("body").addClass("touch"),typeof r!="undefined"?require(["helpers/"+r],function(e){App.Helpers.layoutHelper=new e,i()}):i(),typeof e=="function"&&e(),require(["helpers/cookie"],function(e){e.getCookie("visited")||(e.setCookie("visited",!0,{expires:9999999999}),App.popup("welcome"))})})},n=Backbone.Model.extend({url:"/api/config"});App.Config=new n,App.Config.fetch({success:t})},App.Router=Backbone.Router.extend({routes:{"":"list_things","?q=:q":"list_things","things/new":"new_thing","things/*path":"thing_details","bookmarklet?*query":"bookmarklet","decks/:id":"list_decks","categories/:id":"category_page",profile:"profile","profile/friends/things":"profile_friends_things","profile/things/liked":"profile_liked_things","profile/*path":"profile",activity:"activity_stream","users/:id":"user_decks","users/:id/decks":"user_decks","users/:id/things/best":"user_best_things","followings/things":"followings_things",mingle:"user_mingle","mingle/*path":"user_mingle"},list_decks:function(){App.page("decks/index",arguments)},new_thing:function(){App.page("things/new",arguments)},list_things:function(){App.page("things/index",arguments)},thing_details:function(e){var t=splitPath(e);App.currentUser.authenticate(t[t.length-1].access_token,function(){App.page("things/show",t,!0)})},category_page:function(e){App.page("things/things-list",{el:this.el,title:decodeURIComponent(e),category:"thingles",url:"/api/tags/"+e+"/things",showDeleteButton:!0})},bookmarklet:function(e){var t=e.split("&"),n={};for(var r=0;r<t.length;++r){var i=t[r].split("="),s=n[i[0]];if(s){if(!(s instanceof Array)){var o=new Array;o.push(s),n[i[0]]=o}n[i[0]].push(decodeURIComponent(i[1]))}else n[i[0]]=decodeURIComponent(i[1])}App.view("bookmarklet/index",n)},profile:function(e){var t=this;App.currentUser.checkAuth(function(){t.navigate("users/"+App.currentUser.get("_id")+(e?"/"+e:""),{trigger:!0})},!0)},profile_liked_things:function(){App.page("profile/liked_things",arguments)},profile_friends_things:function(){App.page("profile/friends_things",arguments)},activity_stream:function(){App.page("activity_stream",arguments)},user_decks:function(){App.page("profile/decks",arguments)},user_best_things:function(){App.page("profile/best_things",arguments)},followings_things:function(){App.page("followings/things",arguments)},user_mingle:function(e){App.currentUser.autoAuth(function(){App.view("mingle/mingle-root",{path:"mingle/"+e})},!0)},initialize:function(){this.route(/^(about|contact|privacy|terms|legal|help|404)(\/.*)?/,"static",function(){App.trigger("meta:reset"),App.view("static")})}}),$(document).ready(function(){App.init(function(){App.router=new App.Router,Backbone.history.start(),App.trigger("load"),console.log("loaded")})}),define("app",function(){}),!function(e){var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n);if(this.isShown||n.isDefaultPrevented())return;e("body").addClass("modal-open"),this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1).focus(),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.trigger("shown")}):t.$element.trigger("shown")})},hide:function(t){t&&t.preventDefault();var n=this;t=e.Event("hide"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,e("body").removeClass("modal-open"),this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]!==e.target&&!t.$element.has(e.target).length&&t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(e){this.$element.hide().trigger("hidden"),this.backdrop()},removeBackdrop:function(){this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.options.backdrop!="static"&&this.$backdrop.click(e.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),i?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(this.removeBackdrop,this)):this.removeBackdrop()):t&&t()}},e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),typeof n=="object"&&n);i||r.data("modal",i=new t(this,s)),typeof n=="string"?i[n]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e(function(){e("body").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s).one("hide",function(){n.focus()})})})}(window.jQuery),define("lib/bootstrap/bootstrap-modal",function(){}),!function(e){e(function(){e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery),define("lib/bootstrap/bootstrap-transition",function(){}),function(e,t,n){e.fn.jScrollPane=function(r){function i(r,i){function K(t){var i,o,a,w,E,x,T=!1,C=!1;s=t;if(u===n)E=r.scrollTop(),x=r.scrollLeft(),r.css({overflow:"hidden",padding:0}),f=r.innerWidth()+R,l=r.innerHeight(),r.width(f),u=e('<div class="jspPane" />').css("padding",q).append(r.children()),h=e('<div class="jspContainer" />').css({width:f+"px",height:l+"px"}).append(u).appendTo(r);else{r.css("width",""),T=s.stickToBottom&&yt(),C=s.stickToRight&&bt(),w=r.innerWidth()+R!=f||r.outerHeight()!=l,w&&(f=r.innerWidth()+R,l=r.innerHeight(),h.css({width:f+"px",height:l+"px"}));if(!w&&U==p&&u.outerHeight()==d){r.width(f);return}U=p,u.css("width",""),r.width(f),h.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}u.css("overflow","auto"),t.contentWidth?p=t.contentWidth:p=u[0].scrollWidth,d=u[0].scrollHeight,u.css("overflow",""),v=p/f,m=d/l,g=m>1,y=v>1,!y&&!g?(r.removeClass("jspScrollable"),u.css({top:0,width:h.width()-R}),Et(),Tt(),Ct(),st()):(r.addClass("jspScrollable"),i=s.maintainPosition&&(S||N),i&&(o=mt(),a=gt()),Q(),Y(),et(),i&&(dt(C?p-f:o,!1),pt(T?d-l:a,!1)),xt(),wt(),At(),s.enableKeyboardNavigation&&Nt(),s.clickOnTrack&&it(),kt(),s.hijackInternalLinks&&Lt()),s.autoReinitialise&&!I?I=setInterval(function(){K(s)},s.autoReinitialiseDelay):!s.autoReinitialise&&I&&clearInterval(I),E&&r.scrollTop(0)&&pt(E,!1),x&&r.scrollLeft(0)&&dt(x,!1),r.trigger("jsp-initialised",[y||g])}function Q(){g&&(h.append(e('<div class="jspVerticalBar" />').append(e('<div class="jspCap jspCapTop" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragTop" />'),e('<div class="jspDragBottom" />'))),e('<div class="jspCap jspCapBottom" />'))),C=h.find(">.jspVerticalBar"),k=C.find(">.jspTrack"),w=k.find(">.jspDrag"),s.showArrows&&(M=e('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",nt(0,-1)).bind("click.jsp",St),_=e('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",nt(0,1)).bind("click.jsp",St),s.arrowScrollOnHover&&(M.bind("mouseover.jsp",nt(0,-1,M)),_.bind("mouseover.jsp",nt(0,1,_))),tt(k,s.verticalArrowPositions,M,_)),A=l,h.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){A-=e(this).outerHeight()}),w.hover(function(){w.addClass("jspHover")},function(){w.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",St),w.addClass("jspActive");var n=t.pageY-w.position().top;return e("html").bind("mousemove.jsp",function(e){ut(e.pageY-n,!1)}).bind("mouseup.jsp mouseleave.jsp",ot),!1}),G())}function G(){k.height(A+"px"),S=0,L=s.verticalGutter+k.outerWidth(),u.width(f-L-R);try{C.position().left===0&&u.css("margin-left",L+"px")}catch(e){}}function Y(){y&&(h.append(e('<div class="jspHorizontalBar" />').append(e('<div class="jspCap jspCapLeft" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragLeft" />'),e('<div class="jspDragRight" />'))),e('<div class="jspCap jspCapRight" />'))),D=h.find(">.jspHorizontalBar"),P=D.find(">.jspTrack"),x=P.find(">.jspDrag"),s.showArrows&&(j=e('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",nt(-1,0)).bind("click.jsp",St),F=e('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",nt(1,0)).bind("click.jsp",St),s.arrowScrollOnHover&&(j.bind("mouseover.jsp",nt(-1,0,j)),F.bind("mouseover.jsp",nt(1,0,F))),tt(P,s.horizontalArrowPositions,j,F)),x.hover(function(){x.addClass("jspHover")},function(){x.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",St),x.addClass("jspActive");var n=t.pageX-x.position().left;return e("html").bind("mousemove.jsp",function(e){ft(e.pageX-n,!1)}).bind("mouseup.jsp mouseleave.jsp",ot),!1}),H=h.innerWidth(),Z())}function Z(){h.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){H-=e(this).outerWidth()}),P.width(H+"px"),N=0}function et(){if(y&&g){var t=P.outerHeight(),n=k.outerWidth();A-=t,e(D).find(">.jspCap:visible,>.jspArrow").each(function(){H+=e(this).outerWidth()}),H-=n,l-=n,f-=t,P.parent().append(e('<div class="jspCorner" />').css("width",t+"px")),G(),Z()}y&&u.width(h.outerWidth()-R+"px"),d=u.outerHeight(),m=d/l,y&&(B=Math.ceil(1/v*H),B>s.horizontalDragMaxWidth?B=s.horizontalDragMaxWidth:B<s.horizontalDragMinWidth&&(B=s.horizontalDragMinWidth),x.width(B+"px"),T=H-B,lt(N)),g&&(O=Math.ceil(1/m*A),O>s.verticalDragMaxHeight?O=s.verticalDragMaxHeight:O<s.verticalDragMinHeight&&(O=s.verticalDragMinHeight),w.height(O+"px"),E=A-O,at(S))}function tt(e,t,n,r){var i="before",s="after",o;t=="os"&&(t=/Mac/.test(navigator.platform)?"after":"split"),t==i?s=t:t==s&&(i=t,o=n,n=r,r=o),e[i](n)[s](r)}function nt(e,t,n){return function(){return rt(e,t,this,n),this.blur(),!1}}function rt(t,n,r,i){r=e(r).addClass("jspActive");var u,a,f=!0,l=function(){t!==0&&o.scrollByX(t*s.arrowButtonSpeed),n!==0&&o.scrollByY(n*s.arrowButtonSpeed),a=setTimeout(l,f?s.initialDelay:s.arrowRepeatFreq),f=!1};l(),u=i?"mouseout.jsp":"mouseup.jsp",i=i||e("html"),i.bind(u,function(){r.removeClass("jspActive"),a&&clearTimeout(a),a=null,i.unbind(u)})}function it(){st(),g&&k.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var r=e(this),i=r.offset(),u=t.pageY-i.top-S,a,f=!0,h=function(){var e=r.offset(),n=t.pageY-e.top-O/2,i=l*s.scrollPagePercent,c=E*i/(d-l);if(u<0)S-c>n?o.scrollByY(-i):ut(n);else{if(!(u>0)){p();return}S+c<n?o.scrollByY(i):ut(n)}a=setTimeout(h,f?s.initialDelay:s.trackClickRepeatFreq),f=!1},p=function(){a&&clearTimeout(a),a=null,e(document).unbind("mouseup.jsp",p)};return h(),e(document).bind("mouseup.jsp",p),!1}}),y&&P.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var r=e(this),i=r.offset(),u=t.pageX-i.left-N,a,l=!0,h=function(){var e=r.offset(),n=t.pageX-e.left-B/2,i=f*s.scrollPagePercent,c=T*i/(p-f);if(u<0)N-c>n?o.scrollByX(-i):ft(n);else{if(!(u>0)){d();return}N+c<n?o.scrollByX(i):ft(n)}a=setTimeout(h,l?s.initialDelay:s.trackClickRepeatFreq),l=!1},d=function(){a&&clearTimeout(a),a=null,e(document).unbind("mouseup.jsp",d)};return h(),e(document).bind("mouseup.jsp",d),!1}})}function st(){P&&P.unbind("mousedown.jsp"),k&&k.unbind("mousedown.jsp")}function ot(){e("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),w&&w.removeClass("jspActive"),x&&x.removeClass("jspActive")}function ut(e,t){if(!g)return;e<0?e=0:e>E&&(e=E),t===n&&(t=s.animateScroll),t?o.animate(w,"top",e,at):(w.css("top",e),at(e))}function at(e){e===n&&(e=w.position().top),h.scrollTop(0),S=e;var t=S===0,i=S==E,s=e/E,o=-s*(d-l);if(z!=t||X!=i)z=t,X=i,r.trigger("jsp-arrow-change",[z,X,W,V]);ct(t,i),u.css("top",o),r.trigger("jsp-scroll-y",[-o,t,i]).trigger("scroll")}function ft(e,t){if(!y)return;e<0?e=0:e>T&&(e=T),t===n&&(t=s.animateScroll),t?o.animate(x,"left",e,lt):(x.css("left",e),lt(e))}function lt(e){e===n&&(e=x.position().left),h.scrollTop(0),N=e;var t=N===0,i=N==T,s=e/T,o=-s*(p-f);if(W!=t||V!=i)W=t,V=i,r.trigger("jsp-arrow-change",[z,X,W,V]);ht(t,i),u.css("left",o),r.trigger("jsp-scroll-x",[-o,t,i]).trigger("scroll")}function ct(e,t){s.showArrows&&(M[e?"addClass":"removeClass"]("jspDisabled"),_[t?"addClass":"removeClass"]("jspDisabled"))}function ht(e,t){s.showArrows&&(j[e?"addClass":"removeClass"]("jspDisabled"),F[t?"addClass":"removeClass"]("jspDisabled"))}function pt(e,t){var n=e/(d-l);ut(n*E,t)}function dt(e,t){var n=e/(p-f);ft(n*T,t)}function vt(t,n,r){var i,o,u,a=0,c=0,p,d,v,m,g,y;try{i=e(t)}catch(w){return}o=i.outerHeight(),u=i.outerWidth(),h.scrollTop(0),h.scrollLeft(0);while(!i.is(".jspPane")){a+=i.position().top,c+=i.position().left,i=i.offsetParent();if(/^body|html$/i.test(i[0].nodeName))return}p=gt(),v=p+l,a<p||n?g=a-s.verticalGutter:a+o>v&&(g=a-l+o+s.verticalGutter),g&&pt(g,r),d=mt(),m=d+f,c<d||n?y=c-s.horizontalGutter:c+u>m&&(y=c-f+u+s.horizontalGutter),y&&dt(y,r)}function mt(){return-u.position().left}function gt(){return-u.position().top}function yt(){var e=d-l;return e>20&&e-gt()<10}function bt(){var e=p-f;return e>20&&e-mt()<10}function wt(){h.unbind(J).bind(J,function(e,t,n,r){var i=N,u=S;return o.scrollBy(n*s.mouseWheelSpeed,-r*s.mouseWheelSpeed,!1),i==N&&u==S})}function Et(){h.unbind(J)}function St(){return!1}function xt(){u.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(e){vt(e.target,!1)})}function Tt(){u.find(":input,a").unbind("focus.jsp")}function Nt(){function a(){var e=N,r=S;switch(t){case 40:o.scrollByY(s.keyboardSpeed,!1);break;case 38:o.scrollByY(-s.keyboardSpeed,!1);break;case 34:case 32:o.scrollByY(l*s.scrollPagePercent,!1);break;case 33:o.scrollByY(-l*s.scrollPagePercent,!1);break;case 39:o.scrollByX(s.keyboardSpeed,!1);break;case 37:o.scrollByX(-s.keyboardSpeed,!1)}return n=e!=N||r!=S,n}var t,n,i=[];y&&i.push(D[0]),g&&i.push(C[0]),u.focus(function(){r.focus()}),r.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(r){if(r.target!==this&&(!i.length||!e(r.target).closest(i).length))return;var s=N,o=S;switch(r.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:t=r.keyCode,a();break;case 35:pt(d-l),t=null;break;case 36:pt(0),t=null}return n=r.keyCode==t&&s!=N||o!=S,!n}).bind("keypress.jsp",function(e){return e.keyCode==t&&a(),!n}),s.hideFocus?(r.css("outline","none"),"hideFocus"in h[0]&&r.attr("hideFocus",!0)):(r.css("outline",""),"hideFocus"in h[0]&&r.attr("hideFocus",!1))}function Ct(){r.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function kt(){if(location.hash&&location.hash.length>1){var t,n,r=escape(location.hash.substr(1));try{t=e("#"+r+', a[name="'+r+'"]')}catch(i){return}t.length&&u.find(r)&&(h.scrollTop()===0?n=setInterval(function(){h.scrollTop()>0&&(vt(t,!0),e(document).scrollTop(h.position().top),clearInterval(n))},50):(vt(t,!0),e(document).scrollTop(h.position().top)))}}function Lt(){if(e(document.body).data("jspHijack"))return;e(document.body).data("jspHijack",!0),e(document.body).delegate("a[href*=#]","click",function(n){var r=this.href.substr(0,this.href.indexOf("#")),i=location.href,s,o,u,f,l,c;location.href.indexOf("#")!==-1&&(i=location.href.substr(0,location.href.indexOf("#")));if(r!==i)return;s=escape(this.href.substr(this.href.indexOf("#")+1)),o;try{o=e("#"+s+', a[name="'+s+'"]')}catch(h){return}if(!o.length)return;u=o.closest(".jspScrollable"),f=u.data("jsp"),f.scrollToElement(o,!0),u[0].scrollIntoView&&(l=e(t).scrollTop(),c=o.offset().top,(c<l||c>l+e(t).height())&&u[0].scrollIntoView()),n.preventDefault()})}function At(){var e,t,n,r,i,s=!1;h.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(o){var u=o.originalEvent.touches[0];e=mt(),t=gt(),n=u.pageX,r=u.pageY,i=!1,s=!0}).bind("touchmove.jsp",function(u){if(!s)return;var a=u.originalEvent.touches[0],f=N,l=S;return o.scrollTo(e+n-a.pageX,t+r-a.pageY),i=i||Math.abs(n-a.pageX)>5||Math.abs(r-a.pageY)>5,f==N&&l==S}).bind("touchend.jsp",function(e){s=!1}).bind("click.jsp-touchclick",function(e){if(i)return i=!1,!1})}function Ot(){var e=gt(),t=mt();r.removeClass("jspScrollable").unbind(".jsp"),r.replaceWith($.append(u.children())),$.scrollTop(e),$.scrollLeft(t),I&&clearInterval(I)}var s,o=this,u,f,l,h,p,d,v,m,g,y,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z=!0,W=!0,X=!1,V=!1,$=r.clone(!1,!1).empty(),J=e.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";q=r.css("paddingTop")+" "+r.css("paddingRight")+" "+r.css("paddingBottom")+" "+r.css("paddingLeft"),R=(parseInt(r.css("paddingLeft"),10)||0)+(parseInt(r.css("paddingRight"),10)||0),e.extend(o,{reinitialise:function(t){t=e.extend({},s,t),K(t)},scrollToElement:function(e,t,n){vt(e,t,n)},scrollTo:function(e,t,n){dt(e,n),pt(t,n)},scrollToX:function(e,t){dt(e,t)},scrollToY:function(e,t){pt(e,t)},scrollToPercentX:function(e,t){dt(e*(p-f),t)},scrollToPercentY:function(e,t){pt(e*(d-l),t)},scrollBy:function(e,t,n){o.scrollByX(e,n),o.scrollByY(t,n)},scrollByX:function(e,t){var n=mt()+Math[e<0?"floor":"ceil"](e),r=n/(p-f);ft(r*T,t)},scrollByY:function(e,t){var n=gt()+Math[e<0?"floor":"ceil"](e),r=n/(d-l);ut(r*E,t)},positionDragX:function(e,t){ft(e,t)},positionDragY:function(e,t){ut(e,t)},animate:function(e,t,n,r){var i={};i[t]=n,e.animate(i,{duration:s.animateDuration,easing:s.animateEase,queue:!1,step:r})},getContentPositionX:function(){return mt()},getContentPositionY:function(){return gt()},getContentWidth:function(){return p},getContentHeight:function(){return d},getPercentScrolledX:function(){return mt()/(p-f)},getPercentScrolledY:function(){return gt()/(d-l)},getIsScrollableH:function(){return y},getIsScrollableV:function(){return g},getContentPane:function(){return u},scrollToBottom:function(e){ut(E,e)},hijackInternalLinks:e.noop,destroy:function(){Ot()}}),K(i)}return r=e.extend({},e.fn.jScrollPane.defaults,r),e.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){r[this]=r[this]||r.speed}),this.each(function(){var t=e(this),n=t.data("jsp");n?n.reinitialise(r):(n=new i(t,r),t.data("jsp",n))})},e.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:n,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}(jQuery,this),define("lib/jquery.jscrollpane.min",function(){}),function(e,t){var n=function(n,r){var i=this,s=e(n),o=!1;if(n.combobox!=t)return!1;n.combobox=i,i.options=r,i.element=n,i.$element=s,i.multiple=n.multiple,(i._list=(i.list=e('<ul class="'+i.options.classes.list+(i.multiple?" "+i.options.classes.multiple:"")+'" />')).get(0)).combobox=i,i.multiple||((i._wrapper=(i.wrapper=e('<div class="'+i.options.classes.wrapper+'" />')).get(0)).combobox=i,(i._selected=(i.selected=e('<div class="'+i.options.classes.selected+'" />')).get(0)).combobox=i,(i._button=(i.button=e('<div class="'+i.options.classes.button+'">+</div>')).get(0)).combobox=i),i.$element.bind("change",function(e){i.updateSelected()}).bind("focus",function(e){i.focus()}).bind("blur",function(e){i.blur()}).bind("keyup",function(e){switch(e.which){case 38:case 40:i.updateSelected()}});var u=i.element.form;u!==null&&u.combobox_reset_processed===t&&(u.combobox_reset_processed=!0,e(u).bind("reset",function(t){setTimeout(function(){e.each(u.elements,function(){this.tagName=="SELECT"&&typeof this.combobox!="undefined"&&this.combobox.updateSelected()})},1)})),i.multiple?i.list.bind("click",function(e){i.$element.focus()}):i.wrapper.bind("click",function(e){return i.isDisabled()?!1:i.blocked?!1:(i.state?i.hide():(o||(o=!0,i.list.add(i.button).add(i.selected).hover(function(e){clearTimeout(i.timer)},function(e){i.timer=setTimeout(function(){i.hide()},400)})),i.show()),i.$element.focus(),!1)}),i.options.hoverEnabled&&!i.multiple&&i.wrapper.hover(function(){i.wrapper.addClass(i.options.classes.wrapHover)},function(){!i.blocked&&!i.state&&i.wrapper.removeClass(i.options.classes.wrapHover)}),i.width=i.options.width?i.options.width:i.$element.outerWidth(),i.height=i.options.height?i.options.height:i.$element.outerHeight(),i.btnWidth=i.options.btnWidth;if(i.options.adjustWidth&&i.btnWidth>20)switch(typeof i.options.adjustWidth){case"boolean":i.width=i.width+i.options.btnWidth-20;break;case"number":i.width=i.width+i.options.adjustWidth}var a=e.browser.msie&&e.browser.version.match(/^\d+/)[0]<8?"inline":"inline-block";i.multiple?(i._list.style.display=a,i._list.style.width=i.width+"px"):(i.wrapper.css({display:a,width:i.width,height:i.height}),i.button.css({width:i.btnWidth,height:i.height,display:"inline-block"}),i.selected.css({width:i.width-i.btnWidth,height:i.height,display:"inline-block"}),i.list.css({width:i.width,position:"absolute"})),i.multiple?i.list.insertAfter(i.$element):(i.wrapper.append(i.button),i.wrapper.append(i.selected),i.wrapper.insertAfter(i.$element)),i.updateDisabled(),i.rebuild(),i.updateSelected(),i.multiple||(i._list.style.display="none",e("body").append(i.list)),i.element.style.position="absolute",i.element.style.zIndex=-1,i.$element.css({width:0,height:0,opacity:.01}),i.$element.trigger("combo_init")};e.extend(n.prototype,{state:!1,blocked:!1,timer:null,value:null,disabled:!1,multiple:!1,isCTRL:!1,groups:!1,default_options:{width:!1,height:!1,btnWidth:15,showSpeed:"fast",hideSpeed:"fast",hideSelected:!1,listMaxHeight:!1,hoverEnabled:!1,forceScroll:!1,adjustWidth:!0,theme:"combo"},default_classes:{wrapper:"wrapper",focus:"focus",disabled:"disabled",multiple:"multiple",button:"button",group:"group",groupLabel:"group-label",list:"list",selected:"selected",itemHover:"item-hover",itemActive:"item-active",wrapHover:"wrapper-hover",wrapActive:"wrapper-active",listLong:"list-long"},rebuild:function(){var r=this,i=new Object,s="";r.groups=r.$element.find("optgroup:first").length==0?!1:!0,r.groups?r.$element.children().each(function(){switch(this.tagName){case"OPTION":i[this.index]={text:this.text,value:this.value},s+="<li>"+i[this.index].text+"</li>";break;case"OPTGROUP":var n=e(this),o=n.children("option");if(o.length>0){var u=n.attr("label");u!=t&&(s+='<li class="'+r.options.classes.groupLabel+'">'+u+"</li>"),s+='<li class="'+r.options.classes.group+'"><ul>',o.each(function(){i[this.index]={text:this.text,value:this.value},s+="<li>"+this.text+"</li>"}),s+="</ul></li>"}}}):r.$element.find("option").each(function(){i[this.index]={text:this.text,value:this.value},s+="<li>"+this.text+"</li>"}),r.list.html(s);var o=r.groups?r.list.find("li").not("."+r.options.classes.groupLabel).not("."+r.options.classes.group):r.list.find("li");return o.each(function(e){this.combobox_index=e,this.combobox_value=i[e].value}),r.options.hoverEnabled&&r.list.mouseenter(function(t){if(this.mouseenter_inited===!0)return;this.mouseenter_inited=!0,o.hover(function(){e(this).addClass(r.options.classes.itemHover)},function(){e(this).removeClass(r.options.classes.itemHover)})}),r.list.click(function(e){if(e.target.nodeName!="LI")return;if(r.isDisabled())return!1;var t=r.$element.find("option");(!r.multiple||!n.isCTRL)&&t.filter(":selected").attr("selected",null),r.multiple&&n.isCTRL&&t.get(e.target.combobox_index).selected==1?t.eq(e.target.combobox_index).removeAttr("selected"):t.eq(e.target.combobox_index).attr("selected","selected"),r.$element.change(),r.updateSelected(),r.multiple||r.hide(),r.removeSelection()}),r},updateSelected:function(){var e=this,t=e.groups?e.list.find("li").not("."+e.options.classes.groupLabel).not("."+e.options.classes.group):e.list.find("li"),n=e.$element.find("option").filter(":selected");e.multiple||e.selected.text(n.text()),t.filter("."+e.options.classes.itemActive).removeClass(e.options.classes.itemActive);if(n.length==0)e.value=null;else{var r=n.get(0).index;e.multiple?(e.value=[],n.each(function(){t.eq(this.index).addClass(e.options.classes.itemActive),e.value[e.value.length]=this.value})):(e.value=n.attr("value"),t.eq(n.get(0).index).addClass(e.options.classes.itemActive))}return e},updatePosition:function(){var e=this;if(e.multiple)return!1;var t=e.wrapper.offset();return t={top:t.top+e.height,left:t.left},e.$element.trigger("update_position",t),e.list.css(t),e},show:function(){var e=this;if(e.blocked)return;e.$element.trigger("before_show");if(e.options.hideSelected&&!e.multiple){$children=e.groups?e.list.find("li").not("."+e.options.classes.groupLabel).not("."+e.options.classes.group):e.list.find("li"),$children.show();for(i=0;i<$children.length;i++)if($children.get(i).combobox_value==e.value){$children.eq(i).hide();break}}e.blocked=!0,e.wrapper.addClass(e.options.classes.wrapActive);var t=!1;return e.options.listMaxHeight?(e.list.css({top:"-9999px",left:"-9999px"}),e.list.height()>=e.options.listMaxHeight?(e.list.addClass(this.options.classes.listLong),e.options.forceScroll&&e.list.css({height:e.options.listMaxHeight,overflow:"auto"}),t=!0):e.list.removeClass(e.options.classes.listLong),e.list.hide(),e.updatePosition(),e.list.show()):this.updatePosition(),e.list.slideDown(e.options.showSpeed,function(){e.state=!0,e.blocked=!1;if(t){var n=e.list.find("."+e.options.classes.itemActive);if(n.length==1)if(e.options.hideSelected){var r=n.prev();r.length==0&&(r=n.next()),r.length==1&&e.list.scrollTop(r.get(0).offsetTop)}else e.list.scrollTop(n.get(0).offsetTop)}}),e},hide:function(){var e=this;return e.blocked||!e.state?!1:(e.$element.trigger("before_hide"),e.blocked=!0,e.wrapper.removeClass(e.options.classes.wrapActive),e.options.hoverEnabled&&e.wrapper.removeClass(e.options.classes.wrapHover),e.options.hideSpeed==0?(e.list.hide(),e.state=!1,e.blocked=!1):e.list.slideUp(e.options.hideSpeed,function(){e.state=!1,e.blocked=!1}),e)},isDisabled:function(){return this.$element.attr("disabled")=="disabled"?!0:!1},updateDisabled:function(){var e=this;e.disabled=e.isDisabled();var t=e.multiple?e.list:e.wrapper;return e.disabled?t.addClass(e.options.classes.disabled):t.removeClass(e.options.classes.disabled),e.disabled},removeSelection:function(){if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection&&document.selection.type!="None")try{document.selection.empty()}catch(e){}},focus:function(){this.wrapper!==t?this.wrapper.addClass(this.options.classes.focus):this.list.addClass(this.options.classes.focus)},blur:function(){this.wrapper!==t?this.wrapper.removeClass(this.options.classes.focus):this.list.removeClass(this.options.classes.focus)}}),e(document).keyup(function(e){e.which==17&&(n.isCTRL=!1)}).keydown(function(e){e.which==17&&(n.isCTRL=!0)}),e.fn.combobox=function(t,r){return t=e.extend({},n.prototype.default_options,t),t.classes=e.extend({},n.prototype.default_classes,r),e.each(t.classes,function(e,n){t.classes[e]=t.theme+"-"+n}),this.each(function(){var e=new n(this,t)})}}(jQuery),define("lib/jquery.combobox",function(){}),define("helpers/select",["lib/jquery.combobox"],function(e){return{customize:function(e){$("select",$(e)).each(function(){var e=$(this),t=$("select").index(e);e.hasClass("with-add-line")?e.combobox({height:38}).bind("before_show",function(){var e=$("body").children(".combo-list").eq(t);e.find(".new-deck-field").length<=0&&e.append('<li><div class="inline new-deck-field"><input type="text"><button class="btn btn-primary">Create</button></div></li>').addClass("bigscroll")}):e.combobox({height:38})})}}}),define("helpers/layout",["require","lib/bootstrap/bootstrap-modal","lib/bootstrap/bootstrap-transition","lib/jquery.jscrollpane.min","./select"],function(e){e("lib/bootstrap/bootstrap-modal"),e("lib/bootstrap/bootstrap-transition"),e("lib/jquery.jscrollpane.min");var t=e("./select");return App.Helpers.ViewHelper.extend({shelf_scroll:null,events:{"click .shelf-toggle":"toggleShelf","mouseenter .profile-item dd a":"hoverProfileDt","mouseleave .profile-item dd a":"hoverProfileDt","click [data-toggle=modal]":"openPopup","click #error":function(e){$(e.target).hide()}},initialize:function(){var e=this;App.on("unauthorized",function(){App.popup("login")}),App.on("auth",function(){e.openShelf()}),$("form#search-form","header").submit(function(){var e=$("input[name='search']",$(this)),t=e.val();return t&&(e.val(""),App.router.navigate("?q="+encodeURIComponent(t),{trigger:!0})),!1}),$(".logo").click(function(){var e=this;window.location.href="http://"+location.host+"#"}),t.customize("body"),this.$("#error").ajaxError(function(e,t){var n=this;if(t.status.toString()[0]!="5")return;$(this).empty().append("<h2>Oops</h2>").append("Something went wrong on our server. Please try again.").show(),setTimeout(function(){$(n).hide()},5e3)})},toggleShelf:function(e){var t=this,n=$("#shelf"),r=n.hasClass("opened"),i=$(e.target);if(n.is(":animated"))return!1;if(e===r)return!1;var s=$("#things-list"),o=r?0:221;return n.animate({width:o},App.isMobile?0:"fast","linear",function(){n.toggleClass("opened"),s.masonry&&s.masonry("reload"),$(window).resize()}),$(".details-title, .scrollable-outer, .details-nav").each(function(){var e=$(this);e.css("position")=="fixed"&&e.css({right:parseInt(e.css("right"))+(r?-221:221)})}),i.toggleClass("opened"),!1},openShelf:function(){var e=this;e.toggleShelf(!0)},hoverProfileDt:function(e){var t=$(e.target);t.parent().prev("dt").toggleClass("hover")},openPopup:function(e){App.popup($(e.currentTarget).attr("href").replace("#popup-",""))}})}),define("text!tpl/category-menu.html",[],function(){return"<% var column_size = Math.ceil(categories.length / 2) %>\n\n<ul class=\"col\">\n    <% for(var i = 0; i < column_size; ++i) { %>\n        <li><a href=\"#!categories/<%= encodeURIComponent(categories[i].get('name')) %>\" title=\"Discover <%= categories[i].get('name') %>\"><%= categories[i].get('name') %></a></li>\n    <% } %>\n</ul>\n\n<ul class=\"col\">\n    <% for(var i = column_size; i < categories.length; ++i) { %>\n        <li><a href=\"#!categories/<%= encodeURIComponent(categories[i].get('name')) %>\" title=\"Discover <%= categories[i].get('name') %>\"><%= categories[i].get('name') %></a></li>\n    <% } %>\n</ul>"}),define("views/categories-menu",["require","text!tpl/category-menu.html"],function(e){var t=e("text!tpl/category-menu.html"),n=Backbone.Collection.extend({model:App.Models.Category,url:"/api/categories"}),r=Backbone.View.extend({el:"#categories-menu",template:_.template(t),initialize:function(){this.categories=new n},render:function(){var e=this;this.categories.fetch({success:function(t){$(e.el).prepend(e.template({categories:t.models}))}})}});return r}),define("text!tpl/shelf.html",[],function(){return'<div class="b-try">\n    <h2>Try the +thingle button</h2>\n    <a href="#" id="bookmarklet-button">+thingle</a>\n    <p class="description">Add this to your<br>Bookmarks Bar</p>\n</div>\n\n<div class="b-deck">\n\n    <div class="inner">\n        <div class="scroll-pane">\n            <div class="drop-zone"></div>\n            <div class="drag-new-deck">\n                <a href="#">Click or drag-and-drop to<br> create a new Collection</a>\n            </div>\n            <p>Drag-n-drop onto a<br>Collection to add an item</p>\n            <ul id="deck-list">\n            </ul>\n        </div>\n    </div>\n</div>'}),define("helpers/html",{showPreloader:function(e){var t=$("<img style='margin-left: 65px;' src='data:image/gif;base64,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'/>");return t.insertAfter($(e)),$(e).data("preloader",t),$(e).hide(),t},hidePreloader:function(e){$(e).data("preloader").remove(),$(e).removeData("preloader"),$(e).show()},addBookmarklet:function(e){var t=document.location.protocol+"//"+document.location.host,n=t+"/js/bookmarklet/snippet.js",r='javascript:(function(){ var tag = document.createElement("script");tag.setAttribute("type", "text/javascript");tag.innerHTML = \' var Thingle = {host: "'+document.location.host+"\"}; '; "+"document.body.appendChild(tag);"+'tag = document.createElement("script");'+'tag.setAttribute("type", "text/javascript");'+'tag.setAttribute("src", "'+n+'");'+"document.body.appendChild(tag);"+"})();";e.attr("href",r),e.attr("onclick","alert('Drag me to bookmarks!');return false;"),e.on("dragend",function(e){e.originalEvent.y<0&&window._gaq&&window._gaq.push(["_trackEvent","bookmarklet","install"])})}}),define("text!tpl/shelf-unauthorized.html",[],function(){return'<div class="shelf-notlogged">Log in<br>to create your<br>own thingles<br>and collections,<br>comment, and<br>share</div>'}),define("text!tpl/shelf-deck.html",[],function(){return'<% _.each(decks, function(deck) { %>\n<li data-id="<%= deck.get(\'_id\') %>" class="deck-item">\n    <figure class="carousel slide">\n        <a href="#" class="img">\n            <div class="carousel-inner">\n                <div class="cover item active">\n                    <img src="<%= deck.get(\'coverURL\') || \'images/default-shelf-collection.png\' %>" alt="Drag-n-drop onto a Collection to add an item" title="Drag-n-drop onto a Collection to add an item">\n                </div>\n            </div>\n        </a>\n        <figcaption><a href="#"><%= deck.get("name") %></a></figcaption>\n    </figure>\n</li>\n<% }); %>'}),function(e){function r(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=!0,o=0,u=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(i=n.wheelDelta/120),n.detail&&(i=-n.detail/3),u=i,n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS&&(u=0,o=-1*i),n.wheelDeltaY!==undefined&&(u=n.wheelDeltaY/120),n.wheelDeltaX!==undefined&&(o=-1*n.wheelDeltaX/120),r.unshift(t,i,o,u),(e.event.dispatch||e.event.handle).apply(this,r)}var t=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var n=t.length;n;)e.event.fixHooks[t[--n]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],r,!1);else this.onmousewheel=r},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],r,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery),define("lib/jquery.mousewheel",function(){}),!function(e){var t=function(t,n){this.$element=e(t),this.options=n,this.options.slide&&this.slide(this.options.slide),this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},to:function(t){var n=this.$element.find(".item.active"),r=n.parent().children(),i=r.index(n),s=this;if(t>r.length-1||t<0)return;return this.sliding?this.$element.one("slid",function(){s.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",e(r[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle()),clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this,f=e.Event("slide",{relatedTarget:i[0]});this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u]();if(i.hasClass("active"))return;if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid")},0)})}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}},e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e(function(){e("body").on("click.carousel.data-api","[data-slide]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=!i.data("modal")&&e.extend({},i.data(),n.data());i.carousel(s),t.preventDefault()})})}(window.jQuery),define("lib/bootstrap/bootstrap-carousel",function(){}),define("views/shelf",["require","text!tpl/shelf.html","helpers/html","text!tpl/shelf-unauthorized.html","text!tpl/shelf-deck.html","lib/jquery.mousewheel","lib/bootstrap/bootstrap-carousel"],function(e){var t=e("text!tpl/shelf.html"),n=e("helpers/html");return unauthorized_html=e("text!tpl/shelf-unauthorized.html"),deckhtml=e("text!tpl/shelf-deck.html"),Decks=Backbone.Collection.extend({model:App.Models.Deck,url:"/api/decks",initialize:function(e){this.url=e||this.url}}),e("lib/jquery.mousewheel"),e("lib/bootstrap/bootstrap-carousel"),Backbone.View.extend({el:"aside#shelf",shelf_scroll:null,_template:_.template(t),_unauthorizedTemplate:_.template(unauthorized_html),_deckTemplate:_.template(deckhtml),events:{"click .b-sale .open":"openSale","click .b-sale .close":"closeSale","click .deck-item a":"showDeckGrid","click .drag-new-deck a":"addNewDeck","dragenter .drag-new-deck a, .drop-zone":"dragEnterNewDeck","dragleave .drag-new-deck a, .drop-zone":"dragLeaveNewDeck","drop .drag-new-deck a, .drop-zone":"dropZoneHandler","dragenter .deck-item img":"dragEnter","dragover .deck-item img, .drag-new-deck, .drop-zone":"dragOver","dragleave .deck-item img":"dragLeave","drop .deck-item img":"dropHandler"},initialize:function(e){App.on("deckCreated",this.deckCreatedDispatcher,this),App.on("shelfdecks:load",this.loadDecks,this),App.on("shelfdecks:loaded",this.dropToCreateHelper,this),App.on("addToDeck",this.addToDeck,this),App.on("Deck:Removed",this.removeDeck,this)},reinitShelfScroll:function(){var e=$(window).height(),t=$(".b-deck");shelf_scroll.height(e-($("header").outerHeight()+$(".b-try").outerHeight())),shelf_scroll.data("jsp").reinitialise()},openSale:function(e){var t=$(e.target);t.parent().prev(".img").slideDown("normal",this.reinitShelfScroll).prev(".close").fadeIn()},closeSale:function(e){var t=$(e.target);t.fadeOut().next(".img").slideUp("normal",this.reinitShelfScroll)},showDeckGrid:function(e){var t=$(e.target).parents(".deck-item"),n=t.data("id");return App.router.navigate("/decks/"+n,{trigger:!0,replace:!0}),!1},removeDeck:function(e){console.log("shelf.removeDeck"),console.log(e);var t=this.$el.find('.deck-item[data-id="'+e.deck.id+'"]'),n=$(".stats-collections");t.fadeOut()},addNewDeck:function(e){App.popup("decks-new")},deckCreatedDispatcher:function(e){var t=this._qAddToDeck;t&&(t.deck_id=e.deck_id),App.trigger("shelfdecks:load")},dropToCreateHelper:function(e){var t=this,n=t._qAddToDeck;n&&n.thing_id&&t.addToDeck(n),n={}},dragEnterNewDeck:function(e){e.preventDefault(),$(e.currentTarget).addClass("deck-drop-hover")},dragLeaveNewDeck:function(e){$(e.currentTarget).removeClass("deck-drop-hover")},dropZoneHandler:function(e){this._detectFileDrop(e)?this._dropHandlerNewThing(e):this._dropHandlerNewDeck(e)},_dropHandlerNewDeck:function(e){var t=this,n=e.originalEvent.dataTransfer.getData("text/plain"),r=e;t._qAddToDeck={thing_id:n},App.popup("decks-new"),e.preventDefault()},_detectFileDrop:function(e){return e.originalEvent.dataTransfer.files.length>0},_dropHandlerNewThing:function(e,t){typeof window.FileReader=="undefined"?alert("Drug'n'Drop file upload is not supported by your browser."):App.popup("thingles/drag-image",{file:e.originalEvent.dataTransfer.files[0],deckId:t}),e.preventDefault()},dragEnter:function(e){e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy";var t=$(e.target).parents(".deck-item");t.addClass("deck-drop-hover")},dragOver:function(e){return e.originalEvent.dataTransfer.dropEffect="copy",e.preventDefault(),!1},dragLeave:function(e){var t=$(e.target).parents(".deck-item");t.removeClass("deck-drop-hover")},dropHandler:function(e){var t=e.originalEvent.dataTransfer.getData("text/plain"),n=$(e.target).parents(".deck-item"),r=n.data("id");this._detectFileDrop(e)?this._dropHandlerNewThing(e,r):this.addToDeck({deck_id:r,thing_id:t}),e.preventDefault()},addToDeck:function(e){var t=this,n="/api/decks/"+e.deck_id+"/things";jQuery.post(n,{thingId:e.thing_id},function(n){App.trigger("afterRepost",{collection_id:e.deck_id,thingle_id:e.thing_id});var r=$(t.el).find('.deck-item[data-id="'+e.deck_id+'"]');r.removeClass("deck-drop-hover");var i=_.find(n.pictures[0].sizes,function(e){return e.name=="thumb"||"small"}).url;if(i){var s=$('<div class="item"><img src="'+i+'"></div>'),o=r.find(".carousel");o.find(".carousel-inner").append(s);var u=s.parent().children();u.length==2&&(o.carousel({interval:5e3}).data("carousel").sliding=!1),o.carousel(u.index(s)),o.find(".cover").remove()}})},loadDecks:function(e){var t=this,n=e&&e.thingsOpts||{data:{limit:-5}},r="/api/users/"+App.currentUser.get("_id")+"/decks";t._decks=new Decks(r),t._decks.on("reset",function(){App.trigger("shelfdecks:loaded")}),t._decks.fetch({success:function(e){$(t.el).find("#deck-list").html(t._deckTemplate({decks:e.models})),e.each(function(e){var r=$(t.el).find('.deck-item[data-id="'+e.get("_id")+'"]');e.things.on("reset",function(e){var n=e.map(function(e){return _.find(e.get("pictures")[0].sizes,function(e){return e.name=="small"}).url}),i=r.find(".carousel-inner");_.each(n,function(e){i.append($('<div class="item"><img src="'+e+'"></div>'))});if(n.length){var s=r.find(".carousel");s.carousel({interval:5e3}),s.carousel(1),s.find(".cover").remove()}t.reinitShelfScroll()}),e.things.fetch(n)})}}),App.currentUserDecks=t._decks},render:function(){var e=this;$(this.el).html(this._unauthorizedTemplate()),App.currentUser.checkAuth(function(){$(e.el).html(e._template()),n.addBookmarklet($("a#bookmarklet-button"),$(this.el)),e.loadDecks(),shelf_scroll=$(".scroll-pane",".b-deck").jScrollPane(),$(window).resize(e.reinitShelfScroll)})}})}),define("text!tpl/user-controls.html",[],function(){return'<div class="b-head-buttons">\n    <a href="#popup-addnew" data-toggle="modal" class="add" title="Add a Thingle or create a new Collection">Create</a>\n    <div class="profile">\n        <a data-toggle="modal" href="#popup-login" title="Your profile">Login</a>\n        <div class="subnav profile-subnav">\n            <ul>\n                <li><a href="#!mingle/facebook/invite">Friends</a></li>\n                <li><a href="#!profile/decks">Collections</a></li>\n                <li class="logout"><a href="#">Log Out</a></li> \n            <!--\n                <li><a href="#">Thingles</a></li>\n                <li><a href="#">Favorites</a></li>\n                <li><a href="#">Settings</a></li> -->\n            </ul>\n            <!-- <div class="b-featured-things">\n                <h3>Recent Thingles</h3>\n                <a href="#" class="img"><img src="1348135696/tmp/img5.jpg" alt="Food &amp; Drink" width="98" height="98"></a>\n            </div> -->\n        </div>\n    </div>\n    <a href="javascript:void(0)" class="shelf-toggle" title="Click to open or close shelf"></a>\n</div>'}),define("views/user-controls",["require","text!tpl/user-controls.html"],function(e){var t=e("text!tpl/user-controls.html");return Backbone.View.extend({template:_.template(t),events:{"click .logout":"_logout"},initialize:function(){},_logout:function(e){return App.currentUser.logout(function(){window.location="/"}),!1},render:function(){$(this.el).html(this.template({}));var e=this;$(".profile>a",e.el).html("Login"),App.currentUser.checkAuth(function(){$(".profile>a",e.el).css("background-image","url("+App.currentUser.get("picture").medium+")").attr("href","#profile").removeAttr("data-toggle").parent().addClass("logged")})}})}),define("text!tpl/auth.html",[],function(){return"<div id=\"fb-root\"></div>\n<script type=\"text/javascript\">\n    window.fbAsyncInit = function () {\n        FB.init({\n            appId:'<%= fb_app_id %>', // App ID\n            channelUrl:'<%= channel_file %>', // Channel File\n            status:true, // check login status\n            cookie:true, // enable cookies to allow the server to access the session\n            xfbml:true  // parse XFBML\n          , frictionlessRequests:true\n          , oauth:true /** Are we using oauth? */\n        });\n        console.log(FB);\n        App.trigger('fb-loaded');\n\n        // Additional initialization code here\n        \n        //This would attempt to login everyone automatically\n        //App.trigger('fb-login');\n        FB.getLoginStatus(function(fbResponse){\n          var fbR = fbResponse;\n          if(fbR.status){\n            if( fbR.status === \"connected\"){\n              //User is logged into facebook and our app is authed\n              App.trigger('fb-authed', fbR);\n            } else\n            if( fbR.status === \"not_authorized\"){\n              //User is logged into facebook but our app is not authed\n              App.trigger('fb-notauthed');\n            } else\n            if( fbR.status === \"unknown\"){\n              //User is not logged into facebook\n              App.trigger('fb-unknown');\n            }\n          }\n        });\n        \n        // listen for and handle auth.statusChange events\n        // This seems the only way to get the results of \n        // FB.init({status:true}) without manual / polling lookups\n        FB.Event.subscribe('auth.statusChange', function(response) {\n          console.log(response);\n          if (response.authResponse) {\n            App.trigger('fb-authed');\n          }\n        });\n    };\n\n    // Load the SDK Asynchronously\n    (function (d) {\n        var js, id = 'facebook-jssdk',\n                ref = d.getElementsByTagName('script')[0];\n        if (d.getElementById(id)) {\n            return;\n        }\n        js = d.createElement('script');\n        js.id = id;\n        js.async = true;\n        js.src = \"//connect.facebook.net/en_US/all.js\";\n        ref.parentNode.insertBefore(js, ref);\n    }(document));\n</script>\n"}),define("views/auth",["require","text!tpl/auth.html"],function(e){var t=e("text!tpl/auth.html"),n=Backbone.View.extend({el:"#auth",template:_.template(t),login:function(){var e=this,t=function(){FB.login(function(e){App.currentUser.authenticate(e.authResponse.accessToken)},{scope:"publish_stream,email"})};typeof FB=="undefined"?App.on("fb-loaded",t):t()},initialize:function(){App.on("fb-login",this.login)},render:function(){$(this.el).html(this.template({fb_app_id:App.Config.get("fbId"),channel_file:App.Helpers.staticURL("channel.html")}))}});return n}),define("text!tpl/things/things-list.html",[],function(){return'<% _.each(rows, function(thing) { %>\n<figure data-id="<%= thing.get(\'_id\') %>" class="draggable item preloader" draggable="true">\n    <div class="panel">\n        <a class="comments"><%=thing.get(\'stats\').comments %></a>\n        <a class="likes" title="<%= thing.get(\'likes\') %> Likes"><%= thing.get(\'likes\') %></a>\n    </div>\n    <a href="#!things/<%= thing.get(\'_id\') %>" class="img" draggable="false">\n        <img class="lazy" src="data:image/gif;base64,R0lGODlhAQABAJEAAP////////4BAgAAACH5BAQUAP8ALAAAAAABAAEAAAICRAEAOw==" data-original="<%= thing.getWallPicture().url %>" draggable="false" height="<%= thing.getWallPicture().height %>" width="<%= thing.getWallPicture().width %>" alt="<%= thing.get(\'title\') %>" title="<%= thing.get(\'title\') %>"/>\n    </a>\n    <figcaption>\n        <div class="tools-panel owner-edit">\n            <% if (showDeleteButton) { %>\n                <a href="#" class="edit">#</a>\n            <% } else { %>\n                <a href="#" class="share" title="Share" data-name="<%= thing.get(\'title\') %>" data-description="<%= thing.get(\'description\') %>" data-img="<%= thing.getCoverPicture(\'small\').url %>">R</a>\n            <% } %>\n            <a href="#" class="add" title="Add To Collection">+</a>\n            <a href="#" class="like <%= \n                _.include(thing.get(\'likers\'), App.currentUser.get(\'_id\')) ? \'selected\' :\'\'\n            %>" title="Like">k</a>\n        </div>\n        <div class="title">\n            <h2><%= thing.get(\'title\') %></h2>\n\n            <div class="info">\n                <% try { %>\n                    <a href="#!<%= (thing.get(\'curator\') && \'users/\' + thing.get(\'curator\')._id) || \'\' %>" class="avatar" style="background-image: url(<%= (thing.get(\'curator\') && thing.get(\'curator\').picture.small) || \'\' %>)" title="View <%= (thing.get(\'curator\').firstName)%> <%= (thing.get(\'curator\').lastName)%>\'s profile"></a>\n                <% } catch(e) {console.log(thing.get(\'curator\'))} %>\n                <h2>\n                    <a href="#!<%= (thing.get(\'deck\') && \'decks/\' + thing.get(\'deck\')._id) || \'\' %>" title="View Collection">\n                        <%= (thing.get(\'deck\') && thing.get(\'deck\').name) || \'\' %>\n                    </a>\n                </h2>\n            </div>\n        </div>\n    </figcaption>\n</figure>\n<% }); %>'}),define("text!tpl/things/preloader.html",[],function(){return'<div class="infscr-loading" style="display: none">\n    <img src="data:image/gif;base64,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" alt="Loading...">\n    <div>\n        <em>Loading the next set of thingles</em>\n    </div>\n</div>'}),window.Modernizr=function(e,t,n){function r(e){v.cssText=e}function i(e,t){return r(prefixes.join(e+";")+(t||""))}function s(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function u(e,t){for(var r in e)if(v[e[r]]!==n)return t=="pfx"?e[r]:!0;return!1}function a(e,t,r){for(var i in e){var o=t[e[i]];if(o!==n)return r===!1?e[i]:s(o,"function")?o.bind(r||t):o}return!1}function f(e,t,n){var r=e.charAt(0).toUpperCase()+e.substr(1),i=(e+" "+b.join(r+" ")+r).split(" ");return s(t,"string")||s(t,"undefined")?u(i,t):(i=(e+" "+w.join(r+" ")+r).split(" "),a(i,t,n))}var l="2.5.3",c={},h=t.documentElement,p="modernizr",d=t.createElement(p),v=d.style,m,g={}.toString,y="Webkit Moz O ms",b=y.split(" "),w=y.toLowerCase().split(" "),E={},S={},x={},T=[],N=T.slice,C,k={}.hasOwnProperty,L;!s(k,"undefined")&&!s(k.call,"undefined")?L=function(e,t){return k.call(e,t)}:L=function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(typeof t!="function")throw new TypeError;var n=N.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,o=t.apply(s,n.concat(N.call(arguments)));return Object(o)===o?o:s}return t.apply(e,n.concat(N.call(arguments)))};return r}),E.csstransitions=function(){return f("transition")};for(var A in E)L(E,A)&&(C=A.toLowerCase(),c[C]=E[A](),T.push((c[C]?"":"no-")+C));return r(""),d=m=null,c._version=l,c._domPrefixes=w,c._cssomPrefixes=b,c.testProp=function(e){return u([e])},c.testAllProps=f,c}(this,this.document),define("lib/css3.transitions.test",function(){}),function(e,t,n){var r=t.event,i;r.special.smartresize={setup:function(){t(this).bind("resize",r.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",r.special.smartresize.handler)},handler:function(e,n){var r=this,s=arguments;e.type="smartresize",i&&clearTimeout(i),i=setTimeout(function(){t.event.handle.apply(r,s)},n==="execAsap"?0:100)}},t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])},t.Mason=function(e,n){this.element=t(n),this._create(e),this._init()},t.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1,containerStyle:{position:"relative"}},t.Mason.prototype={_filterFindBricks:function(e){var t=this.options.itemSelector;return t?e.filter(t).add(e.find(t)):e},_getBricks:function(e){var t=this._filterFindBricks(e).css({position:"absolute"}).addClass("masonry-brick");return t},_create:function(n){this.options=t.extend(!0,{},t.Mason.settings,n),this.styleQueue=[];var r=this.element[0].style;this.originalStyle={height:r.height||""};var i=this.options.containerStyle;for(var s in i)this.originalStyle[s]=r[s]||"";this.element.css(i),this.horizontalDirection=this.options.isRTL?"right":"left",this.offset={x:parseInt(this.element.css("padding-"+this.horizontalDirection),10),y:parseInt(this.element.css("padding-top"),10)},this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth=="function";var o=this;setTimeout(function(){o.element.addClass("masonry")},0),this.options.isResizable&&t(e).bind("smartresize.masonry",function(){o.resize()}),this.reloadItems()},_init:function(e){this._getColumns(),this._reLayout(e)},option:function(e,n){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))},layout:function(e,t){for(var n=0,r=e.length;n<r;n++)this._placeBrick(e[n]);var i={};i.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var s=0;n=this.cols;while(--n){if(this.colYs[n]!==0)break;s++}i.width=(this.cols-s)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:i});var o=this.isLaidOut?this.options.isAnimated?"animate":"css":"css",u=this.options.animationOptions,a;for(n=0,r=this.styleQueue.length;n<r;n++)a=this.styleQueue[n],a.$el[o](a.style,u);this.styleQueue=[],t&&t.call(e),this.isLaidOut=!0},_getColumns:function(){var e=this.options.isFitWidth?this.element.parent():this.element,t=e.width();this.columnWidth=this.isFluid?this.options.columnWidth(t):this.options.columnWidth||this.$bricks.outerWidth(!0)||t,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((t+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(e){var n=t(e),r,i,s,o,u;r=Math.ceil(n.outerWidth(!0)/this.columnWidth),r=Math.min(r,this.cols);if(r===1)s=this.colYs;else{i=this.cols+1-r,s=[];for(u=0;u<i;u++)o=this.colYs.slice(u,u+r),s[u]=Math.max.apply(Math,o)}var a=Math.min.apply(Math,s),f=0;for(var l=0,c=s.length;l<c;l++)if(s[l]===a){f=l;break}var h={top:a+this.offset.y};h[this.horizontalDirection]=this.columnWidth*f+this.offset.x,this.styleQueue.push({$el:n,style:h});var p=a+n.outerHeight(!0),d=this.cols+1-c;for(l=0;l<d;l++)this.colYs[f+l]=p},resize:function(){var e=this.cols;this._getColumns(),(this.isFluid||this.cols!==e)&&this._reLayout()},_reLayout:function(e){var t=this.cols;this.colYs=[];while(t--)this.colYs.push(0);this.layout(this.$bricks,e)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(e){this.reloadItems(),this._init(e)},appended:function(e,t,n){if(t){this._filterFindBricks(e).css({top:this.element.height()});var r=this;setTimeout(function(){r._appended(e,n)},1)}else this._appended(e,n)},_appended:function(e,t){var n=this._getBricks(e);this.$bricks=this.$bricks.add(n),this.layout(n,t)},remove:function(e){this.$bricks=this.$bricks.not(e),e.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var n=this.element[0].style;for(var r in this.originalStyle)n[r]=this.originalStyle[r];this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),t(e).unbind(".masonry")}},t.fn.imagesLoaded=function(e){function n(){e.call(i,s)}function r(e){var i=e.target;i.src!==u&&t.inArray(i,a)===-1&&(a.push(i),--o<=0&&(setTimeout(n),s.unbind(".imagesLoaded",r)))}var i=this,s=i.find("img").add(i.filter("img")),o=s.length,u="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a=[];return o||n(),s.bind("load.imagesLoaded error.imagesLoaded",r).each(function(){var e=this.src;this.src=u,this.src=e}),i};var s=function(t){e.console&&e.console.error(t)};t.fn.masonry=function(e){if(typeof e=="string"){var n=Array.prototype.slice.call(arguments,1);this.each(function(){var r=t.data(this,"masonry");if(!r){s("cannot call methods on masonry prior to initialization; attempted to call method '"+e+"'");return}if(!t.isFunction(r[e])||e.charAt(0)==="_"){s("no such method '"+e+"' for masonry instance");return}r[e].apply(r,n)})}else this.each(function(){var n=t.data(this,"masonry");n?(n.option(e||{}),n._init()):t.data(this,"masonry",new t.Mason(e,this))});return this}}(window,jQuery),define("lib/jquery.masonry.min",function(){}),function(e,t){$window=e(t),e.fn.lazyload=function(n){function r(){var t=0;i.each(function(){var n=e(this);if(s.skip_invisible&&!n.is(":visible"))return;if(!e.abovethetop(this,s)&&!e.leftofbegin(this,s))if(!e.belowthefold(this,s)&&!e.rightoffold(this,s))n.trigger("appear");else if(++t>s.failure_limit)return!1})}var i=this,s={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null};return n&&(undefined!==n.failurelimit&&(n.failure_limit=n.failurelimit,delete n.failurelimit),undefined!==n.effectspeed&&(n.effect_speed=n.effectspeed,delete n.effectspeed),e.extend(s,n)),$container=s.container===undefined||s.container===t?$window:e(s.container),0===s.event.indexOf("scroll")&&$container.bind(s.event,function(e){return r()}),this.each(function(){var t=this,n=e(t);t.loaded=!1,n.one("appear",function(){if(!this.loaded){if(s.appear){var r=i.length;s.appear.call(t,r,s)}e("<img />").bind("load",function(){n.hide().attr("src",n.data(s.data_attribute))[s.effect](s.effect_speed),t.loaded=!0;var r=e.grep(i,function(e){return!e.loaded});i=e(r);if(s.load){var o=i.length;s.load.call(t,o,s)}}).attr("src",n.data(s.data_attribute))}}),0!==s.event.indexOf("scroll")&&n.bind(s.event,function(e){t.loaded||n.trigger("appear")})}),$window.bind("resize",function(e){r()}),r(),this},e.belowthefold=function(n,r){var i;return r.container===undefined||r.container===t?i=$window.height()+$window.scrollTop():i=$container.offset().top+$container.height(),i<=e(n).offset().top-r.threshold},e.rightoffold=function(n,r){var i;return r.container===undefined||r.container===t?i=$window.width()+$window.scrollLeft():i=$container.offset().left+$container.width(),i<=e(n).offset().left-r.threshold},e.abovethetop=function(n,r){var i;return r.container===undefined||r.container===t?i=$window.scrollTop():i=$container.offset().top,i>=e(n).offset().top+r.threshold+e(n).height()},e.leftofbegin=function(n,r){var i;return r.container===undefined||r.container===t?i=$window.scrollLeft():i=$container.offset().left,i>=e(n).offset().left+r.threshold+e(n).width()},e.inviewport=function(t,n){return!e.rightofscreen(t,n)&&!e.leftofscreen(t,n)&&!e.belowthefold(t,n)&&!e.abovethetop(t,n)},e.extend(e.expr[":"],{"below-the-fold":function(n){return e.belowthefold(n,{threshold:0,container:t})},"above-the-top":function(n){return!e.belowthefold(n,{threshold:0,container:t})},"right-of-screen":function(n){return e.rightoffold(n,{threshold:0,container:t})},"left-of-screen":function(n){return!e.rightoffold(n,{threshold:0,container:t})},"in-viewport":function(n){return!e.inviewport(n,{threshold:0,container:t})},"above-the-fold":function(n){return!e.belowthefold(n,{threshold:0,container:t})},"right-of-fold":function(n){return e.rightoffold(n,{threshold:0,container:t})},"left-of-fold":function(n){return!e.rightoffold(n,{threshold:0,container:t})}})}(jQuery,window),define("lib/jquery.lazyload.min",function(){}),define("views/things/things-list",["require","text!tpl/things/things-list.html","text!tpl/things/preloader.html","lib/css3.transitions.test","lib/jquery.masonry.min","lib/jquery.lazyload.min"],function(e){var t=e("text!tpl/things/things-list.html"),n=e("text!tpl/things/preloader.html"),r=Backbone.Collection.extend({model:App.Models.Thing,url:"/api/things",initialize:function(e){this.url=e||this.url}}),i=40;return e("lib/css3.transitions.test"),e("lib/jquery.masonry.min"),e("lib/jquery.lazyload.min"),Backbone.View.extend({id:"things-list",$preloader:$(n),template:_.template(t),events:{"dragstart .item":"dragStart","dragend .item":"dragEnd","click .like":"toggleLike","click .item .tools-panel .add":"_repost","click .item .tools-panel .edit":"_remove","click .item .tools-panel .share":"_share"},initialize:function(){this.title=this.options.title,this.category=this.options.category,this._things=new r(this.options.url),this._offset=0,this._allLoaded=!1,this._fromDateTime=new Date},delegateEvents:function(){var e=this;Backbone.View.prototype.delegateEvents.apply(this,arguments),$(window).bind("resize.thingsList",function(){e.initMasonry()}),$("section#main .masonry").masonry("reload"),this._initScroll()},undelegateEvents:function(){return Backbone.View.prototype.undelegateEvents.apply(this,arguments),$(window).unbind("scroll.thingsList"),$(window).unbind("resize.thingsList"),this},_initScroll:function(){var e=this;$(window).bind("scroll.thingsList",function(){if(e._loadStarted)return;if($(this).scrollTop()<$("body").height()-$(this).height()-500){e._appending=!1;return}if(e._appending)return;e._appending=!0,e._loadThings()})},render:function(){this._allLoaded=!1,this._loadStarted=!1,this._loadThings()},_loadThings:function(){var e=this;!e._loadStarted&&!e._allLoaded&&(e._loadStarted=!0,e._showPreloader(),e._xhr=e._things.fetch({data:{from:e._fromDateTime.getTime(),limit:i,offset:e._offset},success:function(t){e._loadStarted=!1,e._offset+=i,e._hidePreloader(),t.models.length>0?e._pushThings(t.models):e._allLoaded=!0}}))},_pushThings:function(e){var t=$(this.template({rows:e,showDeleteButton:this.options.showDeleteButton}));$(this.el).append(t).masonry("appended",t,!0),this.initMasonry(),this.$("img.lazy").lazyload({effect:"fadeIn",container:window}).removeClass("lazy").on("appear",function(){var e=this;setTimeout(function(){$(e).parents("figure.item").removeClass("preloader")},1500)})},initMasonry:function(){var e=$(this.el);e.hasClass("masonry")?e.masonry("reload"):e.masonry({isAnimated:!Modernizr.csstransitions,columnWidth:20})},_repost:function(e){return App.popup("repost",{thingId:$(e.target).parents(".item").data("id")}),!1},_remove:function(e){var t=$(e.target).parents(".item");return t.remove(),this.initMasonry(),$(this.el).trigger("onItemRemove",t.data("id")),delete t,!1},_share:function(e){var t=$(e.target),n=t.parents(".item"),r=this._things.get(n.data("id"));return r.share(),!1},_showPreloader:function(){this.$preloader.parents().length==0&&$("#main").after(this.$preloader),this.$preloader.show()},_hidePreloader:function(){this.$preloader.hide()},toggleLike:function(e){var t=$(e.target),n=t.parents(".item"),r=n.data("id"),i=t.hasClass("selected")?"DELETE":"POST",s=function(){$.ajax({type:i,url:"/api/things/"+r+"/likes",success:function(){t.toggleClass("selected");var e=n.find(".likes");e.text(parseInt(e.text(),10)+(i=="POST"?1:-1))}})};return App.currentUser.checkAuth(s,!0),!1},dragStart:function(e){var t=$(e.target);t.hasClass("item")||(t=t.parents(".item"));var n=e.originalEvent.dataTransfer;n.setData("text/plain",t.data("id"));var r=$("#dragproxy").html($('<div class="thing-drag-proxy"><img src="'+t.find("img").attr("src")+'"></div>')).removeClass("hide");n.setDragImage(r.get(0),100,100),window.setTimeout(function(){r.addClass("hide")},200),$("body").addClass("dragging-thing")},dragEnd:function(e){console.log("dragEnd"),$("body").removeClass("dragging-thing")}})}),define("views/things/index",["require","views/titled","views/things/things-list"],function(e){var t=e("views/titled"),n=e("views/things/things-list");return Backbone.View.extend({initialize:function(){this.title=this.options[0]?decodeURIComponent(this.options[0]):null,this.category=this.options[0]?"search result":null,this._thingsView=new n({el:this.el,url:this.options[0]?"/api/things?q="+this.options[0]:"/api/things"})},render:function(){this._thingsView.render()},undelegateEvents:function(){return this._thingsView.undelegateEvents(),this},delegateEvents:function(){return this._thingsView.delegateEvents(),this}})}),function(e){function n(t){var n=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(n))}function r(t){var n=t.target,r=e(n);if(!r.is(":submit,input:image")){var i=r.closest(":submit");if(i.length===0)return;n=i[0]}var s=this;s.clk=n;if(n.type=="image")if(t.offsetX!==undefined)s.clk_x=t.offsetX,s.clk_y=t.offsetY;else if(typeof e.fn.offset=="function"){var o=r.offset();s.clk_x=t.pageX-o.left,s.clk_y=t.pageY-o.top}else s.clk_x=t.pageX-n.offsetLeft,s.clk_y=t.pageY-n.offsetTop;setTimeout(function(){s.clk=s.clk_x=s.clk_y=null},100)}function i(){if(!e.fn.ajaxSubmit.debug)return;var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}var t={};t.fileapi=e("<input type='file'/>").get(0).files!==undefined,t.formdata=window.FormData!==undefined,e.fn.ajaxSubmit=function(n){function x(t){var r=new FormData;for(var i=0;i<t.length;i++)r.append(t[i].name,t[i].value);if(n.extraData)for(var s in n.extraData)n.extraData.hasOwnProperty(s)&&r.append(s,n.extraData[s]);n.data=null;var o=e.extend(!0,{},e.ajaxSettings,n,{contentType:!1,processData:!1,cache:!1,type:"POST"});n.uploadProgress&&(o.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&(e.upload.onprogress=function(e){var t=0,r=e.loaded||e.position,i=e.total;e.lengthComputable&&(t=Math.ceil(r/i*100)),n.uploadProgress(e,r,i,t)}),e}),o.data=null;var u=o.beforeSend;o.beforeSend=function(e,t){t.data=r,u&&u.call(t,e,n)},e.ajax(o)}function T(t){function x(e){var t=e.contentWindow?e.contentWindow.document:e.contentDocument?e.contentDocument:e.document;return t}function C(){function o(){try{var e=x(d).readyState;i("state = "+e),e&&e.toLowerCase()=="uninitialized"&&setTimeout(o,50)}catch(t){i("Server abort: ",t," (",t.name,")"),M(S),b&&clearTimeout(b),b=undefined}}var t=u.attr("target"),n=u.attr("action");s.setAttribute("target",h),r||s.setAttribute("method","POST"),n!=f.url&&s.setAttribute("action",f.url),!f.skipEncodingOverride&&(!r||/post/i.test(r))&&u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),f.timeout&&(b=setTimeout(function(){y=!0,M(E)},f.timeout));var a=[];try{if(f.extraData)for(var l in f.extraData)f.extraData.hasOwnProperty(l)&&a.push(e('<input type="hidden" name="'+l+'">').attr("value",f.extraData[l]).appendTo(s)[0]);f.iframeTarget||(p.appendTo("body"),d.attachEvent?d.attachEvent("onload",M):d.addEventListener("load",M,!1)),setTimeout(o,15),s.submit()}finally{s.setAttribute("action",n),t?s.setAttribute("target",t):u.removeAttr("target"),e(a).remove()}}function M(t){if(v.aborted||O)return;try{L=x(d)}catch(n){i("cannot access response document: ",n),t=S}if(t===E&&v){v.abort("timeout");return}if(t==S&&v){v.abort("server abort");return}if(!L||L.location.href==f.iframeSrc)if(!y)return;d.detachEvent?d.detachEvent("onload",M):d.removeEventListener("load",M,!1);var r="success",s;try{if(y)throw"timeout";var o=f.dataType=="xml"||L.XMLDocument||e.isXMLDoc(L);i("isXml="+o);if(!o&&window.opera&&(L.body===null||!L.body.innerHTML)&&--A){i("requeing onLoad callback, DOM not available"),setTimeout(M,250);return}var u=L.body?L.body:L.documentElement;v.responseText=u?u.innerHTML:null,v.responseXML=L.XMLDocument?L.XMLDocument:L,o&&(f.dataType="xml"),v.getResponseHeader=function(e){var t={"content-type":f.dataType};return t[e]},u&&(v.status=Number(u.getAttribute("status"))||v.status,v.statusText=u.getAttribute("statusText")||v.statusText);var a=(f.dataType||"").toLowerCase(),l=/(json|script|text)/.test(a);if(l||f.textarea){var h=L.getElementsByTagName("textarea")[0];if(h)v.responseText=h.value,v.status=Number(h.getAttribute("status"))||v.status,v.statusText=h.getAttribute("statusText")||v.statusText;else if(l){var m=L.getElementsByTagName("pre")[0],g=L.getElementsByTagName("body")[0];m?v.responseText=m.textContent?m.textContent:m.innerText:g&&(v.responseText=g.textContent?g.textContent:g.innerText)}}else a=="xml"&&!v.responseXML&&v.responseText&&(v.responseXML=_(v.responseText));try{k=P(v,a,f)}catch(t){r="parsererror",v.error=s=t||r}}catch(t){i("error caught: ",t),r="error",v.error=s=t||r}v.aborted&&(i("upload aborted"),r=null),v.status&&(r=v.status>=200&&v.status<300||v.status===304?"success":"error"),r==="success"?(f.success&&f.success.call(f.context,k,"success",v),c&&e.event.trigger("ajaxSuccess",[v,f])):r&&(s===undefined&&(s=v.statusText),f.error&&f.error.call(f.context,v,r,s),c&&e.event.trigger("ajaxError",[v,f,s])),c&&e.event.trigger("ajaxComplete",[v,f]),c&&!--e.active&&e.event.trigger("ajaxStop"),f.complete&&f.complete.call(f.context,v,r),O=!0,f.timeout&&clearTimeout(b),setTimeout(function(){f.iframeTarget||p.remove(),v.responseXML=null},100)}var s=u[0],o,a,f,c,h,p,d,v,m,g,y,b,w=!!e.fn.prop;if(e(":input[name=submit],:input[id=submit]",s).length){alert('Error: Form elements must not have name or id of "submit".');return}if(t)for(a=0;a<l.length;a++)o=e(l[a]),w?o.prop("disabled",!1):o.removeAttr("disabled");f=e.extend(!0,{},e.ajaxSettings,n),f.context=f.context||f,h="jqFormIO"+(new Date).getTime(),f.iframeTarget?(p=e(f.iframeTarget),g=p.attr("name"),g?h=g:p.attr("name",h)):(p=e('<iframe name="'+h+'" src="'+f.iframeSrc+'" />'),p.css({position:"absolute",top:"-1000px",left:"-1000px"})),d=p[0],v={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var n=t==="timeout"?"timeout":"aborted";i("aborting upload... "+n),this.aborted=1,p.attr("src",f.iframeSrc),v.error=n,f.error&&f.error.call(f.context,v,n,t),c&&e.event.trigger("ajaxError",[v,f,n]),f.complete&&f.complete.call(f.context,v,n)}},c=f.global,c&&0===e.active++&&e.event.trigger("ajaxStart"),c&&e.event.trigger("ajaxSend",[v,f]);if(f.beforeSend&&f.beforeSend.call(f.context,v,f)===!1){f.global&&e.active--;return}if(v.aborted)return;m=s.clk,m&&(g=m.name,g&&!m.disabled&&(f.extraData=f.extraData||{},f.extraData[g]=m.value,m.type=="image"&&(f.extraData[g+".x"]=s.clk_x,f.extraData[g+".y"]=s.clk_y)));var E=1,S=2,T=e("meta[name=csrf-token]").attr("content"),N=e("meta[name=csrf-param]").attr("content");N&&T&&(f.extraData=f.extraData||{},f.extraData[N]=T),f.forceSync?C():setTimeout(C,10);var k,L,A=50,O,_=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&t.documentElement.nodeName!="parsererror"?t:null},D=e.parseJSON||function(e){return window.eval("("+e+")")},P=function(t,n,r){var i=t.getResponseHeader("content-type")||"",s=n==="xml"||!n&&i.indexOf("xml")>=0,o=s?t.responseXML:t.responseText;return s&&o.documentElement.nodeName==="parsererror"&&e.error&&e.error("parsererror"),r&&r.dataFilter&&(o=r.dataFilter(o,n)),typeof o=="string"&&(n==="json"||!n&&i.indexOf("json")>=0?o=D(o):(n==="script"||!n&&i.indexOf("javascript")>=0)&&e.globalEval(o)),o}}if(!this.length)return i("ajaxSubmit: skipping submit process - no element selected"),this;var r,s,o,u=this;typeof n=="function"&&(n={success:n}),r=this.attr("method"),s=this.attr("action"),o=typeof s=="string"?e.trim(s):"",o=o||window.location.href||"",o&&(o=(o.match(/^([^#]+)/)||[])[1]),n=e.extend(!0,{url:o,success:e.ajaxSettings.success,type:r||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},n);var a={};this.trigger("form-pre-serialize",[this,n,a]);if(a.veto)return i("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(n.beforeSerialize&&n.beforeSerialize(this,n)===!1)return i("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var f=n.traditional;f===undefined&&(f=e.ajaxSettings.traditional);var l=[],c,h=this.formToArray(n.semantic,l);n.data&&(n.extraData=n.data,c=e.param(n.data,f));if(n.beforeSubmit&&n.beforeSubmit(h,this,n)===!1)return i("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[h,this,n,a]);if(a.veto)return i("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var p=e.param(h,f);c&&(p=p?p+"&"+c:c),n.type.toUpperCase()=="GET"?(n.url+=(n.url.indexOf("?")>=0?"&":"?")+p,n.data=null):n.data=p;var d=[];n.resetForm&&d.push(function(){u.resetForm()}),n.clearForm&&d.push(function(){u.clearForm(n.includeHidden)});if(!n.dataType&&n.target){var v=n.success||function(){};d.push(function(t){var r=n.replaceTarget?"replaceWith":"html";e(n.target)[r](t).each(v,arguments)})}else n.success&&d.push(n.success);n.success=function(e,t,r){var i=n.context||n;for(var s=0,o=d.length;s<o;s++)d[s].apply(i,[e,t,r||u,u])};var m=e("input:file:enabled[value]",this),g=m.length>0,y="multipart/form-data",b=u.attr("enctype")==y||u.attr("encoding")==y,w=t.fileapi&&t.formdata;i("fileAPI :"+w);var E=(g||b)&&!w;n.iframe!==!1&&(n.iframe||E)?n.closeKeepAlive?e.get(n.closeKeepAlive,function(){T(h)}):T(h):(g||b)&&w?x(h):e.ajax(n);for(var S=0;S<l.length;S++)l[S]=null;return this.trigger("form-submit-notify",[this,n]),this},e.fn.ajaxForm=function(t){t=t||{},t.delegation=t.delegation&&e.isFunction(e.fn.on);if(!t.delegation&&this.length===0){var s={s:this.selector,c:this.context};return!e.isReady&&s.s?(i("DOM not ready, queuing ajaxForm"),e(function(){e(s.s,s.c).ajaxForm(t)}),this):(i("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return t.delegation?(e(document).off("submit.form-plugin",this.selector,n).off("click.form-plugin",this.selector,r).on("submit.form-plugin",this.selector,t,n).on("click.form-plugin",this.selector,t,r),this):this.ajaxFormUnbind().bind("submit.form-plugin",t,n).bind("click.form-plugin",t,r)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(n,r){var i=[];if(this.length===0)return i;var s=this[0],o=n?s.getElementsByTagName("*"):s.elements;if(!o)return i;var u,a,f,l,c,h,p;for(u=0,h=o.length;u<h;u++){c=o[u],f=c.name;if(!f)continue;if(n&&s.clk&&c.type=="image"){!c.disabled&&s.clk==c&&(i.push({name:f,value:e(c).val(),type:c.type}),i.push({name:f+".x",value:s.clk_x},{name:f+".y",value:s.clk_y}));continue}l=e.fieldValue(c,!0);if(l&&l.constructor==Array){r&&r.push(c);for(a=0,p=l.length;a<p;a++)i.push({name:f,value:l[a]})}else if(t.fileapi&&c.type=="file"&&!c.disabled){r&&r.push(c);var d=c.files;if(d.length)for(a=0;a<d.length;a++)i.push({name:f,value:d[a],type:c.type});else i.push({name:f,value:"",type:c.type})}else l!==null&&typeof l!="undefined"&&(r&&r.push(c),i.push({name:f,value:l,type:c.type,required:c.required}))}if(!n&&s.clk){var v=e(s.clk),m=v[0];f=m.name,f&&!m.disabled&&m.type=="image"&&(i.push({name:f,value:v.val()}),i.push({name:f+".x",value:s.clk_x},{name:f+".y",value:s.clk_y}))}return i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var n=[];return this.each(function(){var r=this.name;if(!r)return;var i=e.fieldValue(this,t);if(i&&i.constructor==Array)for(var s=0,o=i.length;s<o;s++)n.push({name:r,value:i[s]});else i!==null&&typeof i!="undefined"&&n.push({name:this.name,value:i})}),e.param(n)},e.fn.fieldValue=function(t){for(var n=[],r=0,i=this.length;r<i;r++){var s=this[r],o=e.fieldValue(s,t);if(o===null||typeof o=="undefined"||o.constructor==Array&&!o.length)continue;o.constructor==Array?e.merge(n,o):n.push(o)}return n},e.fieldValue=function(t,n){var r=t.name,i=t.type,s=t.tagName.toLowerCase();n===undefined&&(n=!0);if(n&&(!r||t.disabled||i=="reset"||i=="button"||(i=="checkbox"||i=="radio")&&!t.checked||(i=="submit"||i=="image")&&t.form&&t.form.clk!=t||s=="select"&&t.selectedIndex==-1))return null;if(s=="select"){var o=t.selectedIndex;if(o<0)return null;var u=[],a=t.options,f=i=="select-one",l=f?o+1:a.length;for(var c=f?o:0;c<l;c++){var h=a[c];if(h.selected){var p=h.value;p||(p=h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value);if(f)return p;u.push(p)}}return u}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var n=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var r=this.type,i=this.tagName.toLowerCase();n.test(r)||i=="textarea"?this.value="":r=="checkbox"||r=="radio"?this.checked=!1:i=="select"?this.selectedIndex=-1:t&&(t===!0&&/hidden/.test(r)||typeof t=="string"&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return e===undefined&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return t===undefined&&(t=!0),this.each(function(){var n=this.type;if(n=="checkbox"||n=="radio")this.checked=t;else if(this.tagName.toLowerCase()=="option"){var r=e(this).parent("select");t&&r[0]&&r[0].type=="select-one"&&r.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}(jQuery),define("lib/jquery.form",function(){}),define("text!tpl/things/new.html",[],function(){return'<div class="image">\n    <form action="<%= params.get(\'action\') %>" method="post" enctype="multipart/form-data" id="s3-upload">\n        <input type="hidden" name="key" value="<%= params.get(\'folder\') %>/${filename}">\n        <input type="hidden" name="AWSAccessKeyId" value="<%= params.get(\'AWSAccessKeyId\') %>">\n        <input type="hidden" name="acl" value="<%= params.get(\'acl\') %>">\n        <input type="hidden" name="success_action_redirect" value="<%= params.get(\'success_action_redirect\') %>">\n        <input type="hidden" name="policy" value="<%- params.get(\'policy\') %>">\n        <input type="hidden" name="signature" value="<%= params.get(\'signature\') %>">\n        <input type="hidden" name="Content-Type" value="image/jpeg">\n        <!-- Include any additional input fields here -->\n\n        Upload image:\n        <input name="file" type="file">\n    </form>\n    <br/>\n    <a href="javascript:void(0)" class="upload-btn">Upload</a>\n\n</div>\n\n<div class="thing" style="display: none;">\n    <form id="thing-form">\n        <p>\n            Thingle title:\n            <input type="text" name="title"/>\n        </p>\n\n        <p>\n            Thingle description: <br/>\n            <textarea name="description"></textarea>\n        </p>\n\n\n        <p>\n            Collection: <br/>\n            <select name="deck"></select>\n        </p>\n\n        <p>\n            New Collection: <br/>\n            <input type="text" name="deck_name"/>\n            <a class="create-deck-btn" href="javascript:void(0)">Create</a>\n        </p>\n\n        <p>\n            Tags (comma separated values): <br/>\n            <input type="text" name="tags"/>\n        </p>\n    </form>\n\n    <a href="javascript:void(0)" class="submit-btn">Save</a>\n</div>'}),define("views/things/new",["require","lib/jquery.form","text!tpl/things/new.html"],function(e){e("lib/jquery.form");var t=e("text!tpl/things/new.html"),n=Backbone.Collection.extend({model:App.Models.Deck,url:"/api/decks"}),r=Backbone.Model.extend({url:"/api/things/pictures/upload"});return Backbone.View.extend({auth:!0,id:"new-thing",uploadForm:"form#s3-upload",thingForm:"form#thing-form",events:{"click a.upload-btn":"upload","click a.create-deck-btn":"createDeck","click a.submit-btn":"save"},mimetypes:{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"},template:_.template(t),initialize:function(){this.thing=new App.Models.Thing},upload:function(){var e=$("input[type=file]",this.uploadForm).val();if(!e)return alert("Choose the file to upload");var t=e.match(/[^\.]+$/)[0].toLowerCase(),n=this;this.filename=this.params.get("folder")+"/"+this.params.get("uid")+"."+t,$("input[name=key]",this.uploadForm).val(this.filename);var r=this.mimetypes[t];if(!r)return alert("Wrong image type!");$('input[name="Content-Type"]',this.uploadForm).val(r),$(this.uploadForm).ajaxSubmit({success:function(e){console.log(e)},complete:function(e,t,r){var i=$("<img />").attr({src:n.params.get("action")+n.filename});i.error(function(){alert("There was error while uploading your image. Reload the page and try again.")}),i.load(function(){$(".image",n.el).empty().append(this),$(this).width()>200&&$(this).attr("width",200),n.showThingForm()})}})},showThingForm:function(){$(".thing",this.el).show(),this.thing=new App.Models.Thing,this.thing.set("pictures",[{fileName:this.filename}])},createDeck:function(){var e=new App.Models.Deck;e.set({name:$("[name='deck_name']",this.thingForm).val()}),$("[name='deck_name']",this.thingForm).val(""),e.save({},{success:function(e,t){$("option:selected").attr("selected","");var n=$("<option></option>");n.attr("value",e.get("_id")),n.attr("selected","selected"),n.html(e.get("name")),$("[name='deck']",this.thingForm).prepend(n)}})},save:function(){this.thing.set({title:$("[name=title]",this.thingForm).val(),description:$("[name=description]",this.thingForm).val(),createdDeck:$("[name=deck] option:selected",this.thingForm).val(),tags:$("[name=tags]",this.thingForm).val().replace(/([,;|]\s*)/g,",").split(",")}),this.thing.save({},{success:function(e,t){alert("Saved!")}})},render:function(){var e=this;this.params=new r,this.params.fetch({success:function(t,n){$(e.el).html(e.template({params:t})),$(e.uploadForm).ajaxForm(),e.loadDecks()}})},loadDecks:function(){var e=new n;e.fetch({success:function(e){$.each(e.models,function(e,t){$("option:selected").attr("selected","");var n=$("<option></option>");n.attr("value",t.get("_id")),n.html(t.get("name")),$("[name='deck']",this.thingForm).append(n)})}})}})}),define("text!tpl/things/show.html",[],function(){return'<div class="details-title details-editable" id="title"></div>\n\n<div class="scrollable-outer" id="carousel"></div>\n\n\n<div class="details-content">\n    <nav class="details-nav">\n        <ul>\n        	<li class="add-page"><a href="javascript:void(0)">&</a></li>\n        </ul>\n    </nav>\n    <div class="inner">\n        <!--<div class="details-user bg1">\n            <div class="inner">\n                <a href="#!users/<%= thing.get(\'createdUser\')._id %>" class="img avatar" style="background-image: url(<%= thing.get(\'createdUser\').picture.medium %>);"></a>\n        \n                <div class="user-info">\n                    <div class="username"><a href="#!users/<%= thing.get(\'createdUser\')._id %>"><%= thing.get(\'createdUser\').firstName %> <%= thing.get(\'createdUser\').lastName %></a></div>\n                    <% if (thing.get(\'createdDeck\')) { %>\n                        <div class="collection">posted from the collection<br/><a href="#!decks/<%= thing.get(\'createdDeck\')._id %>"><%= thing.get(\'createdDeck\').name %></a></div>\n                    <% } %>\n                </div>\n                <div class="user-follow">\n                    <a href="javascript:void(0)" class="btn btn-primary btn-follow">Follow</a>\n                    <a href="javascript:void(0)" class="btn btn-primary btn-unfollow">Unfollow</a>\n                    <a href="javascript:void(0)" class="btn btn-primary btn-editprofile">Edit Profile</a>\n                </div>\n            </div>\n        </div>-->\n        \n        <div class="details-block details-editable" id="desc"></div>\n        \n		<div class="details-block" id="map"></div>\n		\n        <div class="details-block" id="comments"></div>\n        \n        <div class="details-block details-editable" id="colls"></div>\n\n        <div class="details-block" id="collectors"></div>\n\n        <div class="details-block" id="likers"></div>\n\n        <div class="details-block details-editable" id="tags"></div>\n        \n        <div class="details-block" id="editors"></div>\n    </div>\n</div>'}),define("text!tpl/things/show/title.html",[],function(){return'<div class="inner">\n  <h1>\n      <i class="avatar" style="background-image: url(<%= thing.getCoverPicture(\'small\').url %>)"></i>\n      <form action="#" method="">\n          <span><%= _.escape(thing.get(\'title\')) %></span>\n      </form>\n  </h1>\n  <a href="javascript:void(0);" class="details-edit">p</a>\n</div>'}),define("views/things/show/title",["require","text!tpl/things/show/title.html"],function(e){var t=e("text!tpl/things/show/title.html");return Backbone.View.extend({id:"title",template:_.template(t),events:{"submit form":"_onFormSubmit"},initialize:function(){this.$el=$("#"+this.id),this.el=this.$el[0],this.$el.on("edit",$.proxy(this._toggleEditForm,this)),this._parent=this.options.parent,this._thing=this.options.thing},render:function(){this.$el.html(this.template({thing:this._thing})),this.$form=$("form",this.$el),this.form=this.$form[0]},_toggleEditForm:function(e,t){t?(this.$form.html('<div class="control-group"><div class="input-append"><input name="title" type="text" value="'+this._thing.get("title")+'">'+'<button class="btn btn-primary" type="submit">3</button>'+"</div>"+"</div>"),this.$form.find("input[type=text]").focus()):this.$form.html("<span>"+this._thing.get("title")+"</span>")},_onFormSubmit:function(){return this._parent.updateThingle({title:$("[name='title']",this.$form).val()}),this._toggleEditForm(null,!1),this.$el.removeClass("edited"),!1}})}),define("text!tpl/things/show/gallery.html",[],function(){return'<div class="scrollable thingle-scrollable one">\n    <div class="items">\n        <% _.each(thing.get(\'pictures\'), function(picture, index) { %>\n            <% if (!picture.processed) return; %>\n            <% var user = picture.createdUser || thing.get(\'createdUser\'); %>\n            <figure data-id="<%= thing.get(\'_id\') %>" draggable="true" class="item preloader">\n                <div class="img">\n                    <a href="<%= picture.sourceURL || thing.get(\'sourceURL\') || \'#\' %>"\n                       draggable="false" target="blank">\n                        <img draggable="false" class="" src="<%= thing.getPicture(index, \'large\').url %>" data-width="<%= thing.getPicture(index, \'large\').width %>" data-height="<%= thing.getPicture(index, \'large\').height %>" />\n                    </a>\n                </div>\n                <figcaption>\n                    <div class="tools-panel">\n                        <!-- <a href="javascript:void(0)" class="delete">#</a>\n                        <a href="javascript:void(0)" class="comment">w</a> -->\n                        <a href="javascript:void(0)" class="share" title="Share" data-name="<%= thing.get(\'title\') %>" data-description="<%= thing.get(\'description\') %>" data-img="<%= thing.getPicture(index, \'small\').url %>">R</a>\n                        <a href="javascript:void(0)" class="add">+</a>\n                        <a href="javascript:void(0)" class="like">k</a>\n                    </div>\n\n                    <div class="title">\n                        <div class="info">\n                            <a href="#!users/<%= user._id %>"\n                               class="owner avatar"\n                               style="background-image: url(<%= user.picture.small %>)"></a>\n                            <h2>\n                                <a href="#!users/<%= user._id %>">\n                                    <%= user.firstName %> <%= user.lastName %>\n                                </a>\n                            </h2>\n                        </div>\n                    </div>\n                </figcaption>\n            </figure>\n        <% }); %>\n    </div>\n\n    <% if (thing.get(\'pictures\').length > 1) { %>\n        <a class="prev"></a>\n        <a class="next"></a>\n    <% } %>\n</div>'}),define("views/things/show/gallery",["require","text!tpl/things/show/gallery.html","lib/jquery.mousewheel"],function(e){var t=e("text!tpl/things/show/gallery.html");return e("lib/jquery.mousewheel"),Backbone.View.extend({id:"carousel",template:_.template(t),events:{"click a.add":"_repost","click .tools-panel .share":"_share","click .tools-panel .like":"_toggleLike","dragstart .item":"_dragStart","dragend .item":"_dragEnd"},navigation:"Gallery",initialize:function(){this.$el=$("#"+this.id),this.el=this.$el[0],this._parent=this.options.parent,this._thing=this.options.thing},render:function(){var e=this,t=this.template({thing:this._thing});this.$el.html(t),App.currentUser.checkAuth(function(){var t=e._thing.get("likers");t&&t.indexOf(App.currentUser.get("_id"))>=0&&$(".tools-panel .like",e.$el).addClass("selected")}),this._initGallery()},_initGallery:function(){var e=this.$(".thingle-scrollable"),t=this.$(".scrollable-position"),n=1;e.scrollable({speed:250,keyboard:!1,onBeforeSeek:function(){this.getItems().removeClass("active")},onSeek:function(){t.children(".current").text(this.getIndex()+1)}});var r=e.data("scrollable");t.children(".total").text(r.getSize()),$(".next, .prev",e).click(function(){r.getItems().eq(r.getIndex()).addClass("active")}),$(".item:first",e).addClass("active"),this._checkLongImages(e)},_checkLongImages:function(e){var t=20,n=403,r=502,i=e.find(".item"),s=i.size(),o=0;i.each(function(i){var u=$(this),a=n+n*t/100;u.find("img").one("load",function(){var t=$(this),i=t.height();i>a?t.removeAttr("height").attr("height",n):i<=a&&i>n&&t.css({"margin-top":-1*Math.ceil((i-n)/2)});var f=t.width();if(f<r){f=f>220?f:220;var l=Math.ceil((r-f)/2);u.css({"margin-left":l,"margin-right":l+18})}t.fadeTo("fast",1,function(){u.removeClass("preloader")}),o++;if(o==s){$(".scrollable-outer").addClass("fixed"),$(".details-content").css({"margin-top":e.outerHeight()+77});var c=e.data("scrollable"),h=1;c.getSize()>h&&(c.seekTo(h),c.getItems().eq(h).addClass("active"))}}).each(function(){this.complete&&$(this).load()})})},_share:function(e){var t=$(e.target),n=t.parents(".item"),r=document.location.protocol+"//"+document.location.host,i=window.location.pathname+window.location.search+window.location.hash,s={method:"feed",link:r+"/#things/"+n.data("id"),picture:t.data("img"),name:t.data("name"),description:t.data("description")};return FB.ui(s,function(e){e&&e.post_id&&window._gaq&&window._gaq.push(["_trackSocial","facebook","share",s.link,i])}),!1},_toggleLike:function(e){var t=this,n=$(".tools-panel .like",t.$el),r=n.hasClass("selected"),i=t._thing.get("_id"),s=n.hasClass("selected")?"DELETE":"POST",o=function(){$.ajax({type:s,url:"/api/things/"+i+"/likes",success:function(){var e=t._thing.get("likers")||[];if(r){var s=e.indexOf(App.currentUser.get("_id"));s>=0&&(e.splice(s,1),t._thing.set("likers",e)),n.removeClass("selected")}else e.indexOf(App.currentUser.get("_id"))<0&&(e.push(App.currentUser.get("_id")),t._thing.set("likers",e)),n.addClass("selected");App.trigger("onLikeSuccess",{thingId:i})}})};App.currentUser.checkAuth(o,!0)},_repost:function(e){return App.popup("repost",{thingId:$(e.target).parents(".item").data("id")}),!1},_dragStart:function(e){var t=$(e.target);t.hasClass("item")||(t=t.parents(".item"));var n=e.originalEvent.dataTransfer;n.setData("text/plain",t.data("id"));var r=$("#dragproxy").html($('<div class="thing-drag-proxy"><img src="'+t.find("img").attr("src")+'"></div>')).removeClass("hide");n.setDragImage(r.get(0),100,100),window.setTimeout(function(){r.addClass("hide")},200),$("body").addClass("dragging-thing")},_dragEnd:function(e){$("body").removeClass("dragging-thing")}})}),define("text!tpl/things/show/comments.html",[],function(){return'<h2><span><%= title %></span></h2>\n<div class="details-comments">\n    <div id="comments-form" class="comment-new collapsed"></div>\n    <div id="comments-list" class="comments"></div>\n</div>'}),define("text!tpl/things/show/comments/form.html",[],function(){return'<div class="inner bg1">\n    <form id="add-comment-form" action="#" method="">\n        <div class="img"><span class="avatar" style="background-image:url(<%= user.get(\'picture\').small %>);"></span></div>\n        <div class="control-group">\n            <textarea placeholder="Add your comment"></textarea>\n        </div>\n        <button type="submit" class="btn btn-primary">Post</button>\n    </form>\n</div>\n<a href="javascript:void(0);" class="close"></a>'}),define("text!tpl/things/show/comments/list.html",[],function(){return'<div class="comments-nav">\n    <a href="javascript:void(0);" class="prev disabled"></a><a href="javascript:void(0);" class="next"></a>\n</div>\n<div class="scrollable">\n    <div class="items">\n        <% _.each(comments, function(comment, i) { %>\n            <% if (i%2==0) { %><div><% } %>\n            <% var user = comment.get(\'author\'); %>\n            <div class="comment">\n                <div class="username">\n                    <a href="#!users/<%=user._id%>" title="<%= user.firstName %> <%= user.lastName %>"><%= user.firstName %><br /> <%= user.lastName %></a>\n                </div>\n                <p><%= nl2br(_.escape(comment.get(\'text\'))) %></p>\n                <div class="date"><%= DateHelper.format(comment.get(\'createdAt\')) %></div>\n            </div>\n            <% if ((i+1)%2==0) { %></div><% } %>\n        <% }); %>\n    </div>\n</div>'}),define("helpers/date",{format:function(e,t){var n=["January","February","March","April","May","June","July","August","September","October","November","December"],r=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];e=typeof e!="object"?new Date(e):e,typeof t!="string"&&(t="%m/%d/%y");var i={};i.j=e.getDate(),i.d=i.j<10?"0"+i.j:i.j,i.S="th",i.S=i["j"]==1?"st":i.S,i.S=i["j"]==2?"nd":i.S,i.S=i["j"]==3?"rd":i.S,i.F=n[e.getMonth()],i.n=e.getMonth()+1,i.m=i.n<10?"0"+i.n:i.n,i.Y=e.getFullYear(),i.y=(""+i.Y)[2]+(""+i.Y)[3],i.w=e.getDay(),i.l=r[i.w],i.G=e.getHours(),i.H=i.G<10?"0"+i.G:i.G,i.a=i.G<12?"am":"pm",i.A=i.a.toUpperCase(),i.g=i.G-12,i.g+=i.g<1?12:0,i.h=i.g<10?"0"+i.g:i.g,i.i=e.getMinutes(),i.i=i.i<10?"0"+i.i:i.i,i.s=e.getSeconds(),i.s=i.s<10?"0"+i.s:i.s,i.u=e.getTime(),i.U=Math.round(i.u/1e3),i.J=fuzzyDate(e);for(var s in i)regex=new RegExp("%"+s,"g"),t=t.replace(regex,i[s]);return t}}),define("helpers/text",{nl2br:function(e){var t="<br />";return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+t+"$2")},br2nl:function(e){return(e+"").replace(/<\s*br[^>]*>/g,"")}}),define("views/things/show/comments",["require","text!tpl/things/show/comments.html","text!tpl/things/show/comments/form.html","text!tpl/things/show/comments/list.html","helpers/date","helpers/text"],function(e){var t=e("text!tpl/things/show/comments.html"),n=e("text!tpl/things/show/comments/form.html"),r=e("text!tpl/things/show/comments/list.html"),i=e("helpers/date"),s=e("helpers/text"),o=App.Models.Comment,u=App.Collections.Comments;return Backbone.View.extend({id:"comments",navigation:"Comments",blockTemplate:_.template(t),formTemplate:_.template(n),listTemplate:_.template(r),events:{"focusin .comment-new textarea":"_extendTextArea","click .comment-new .close":"_collapseTextArea","submit #add-comment-form":"_onFormSubmit"},initialize:function(){this.$el=$("#"+this.id),this.el=this.$el[0],this._parent=this.options.parent,this._thing=this.options.thing,this._comments=new u(this._thing.get("_id"))},render:function(){this.$el.html(this.blockTemplate({title:this.navigation}));var e=this;App.currentUser.checkAuth(function(){e._displayForm()}),this._displayList()},_displayForm:function(){$("#comments-form",this.$el).html(this.formTemplate({user:App.currentUser})),this.$form=$("form",this.$el),this.form=this.$form[0]},_displayList:function(){var e=this;this._comments.fetch({success:function(t){e._putComments(t)}})},_putComments:function(e){var t=_.extend({comments:e.models,DateHelper:i},s);$("#comments-list",this.$el).html(this.listTemplate(t)),$(".scrollable",this.$el).scrollable()},_extendTextArea:function(){$(".comment-new",this.$el).removeClass("collapsed")},_collapseTextArea:function(){$(".comment-new",this.$el).addClass("collapsed"),this.$form.find("textarea").val("")},_onFormSubmit:function(){var e=this.$form.find("textarea").val(),t=this;if(e){var n=new o({text:e,thing:this._thing.get("_id")});n.save(null,{success:function(){var e={_id:App.currentUser.get("_id"),firstName:App.currentUser.get("firstName"),lastName:App.currentUser.get("lastName")};n.set("author",e),t._comments.unshift(n),t._putComments(t._comments)}}),this._collapseTextArea()}return!1}})}),define("text!tpl/things/show/description.html",[],function(){return'<h2><span>Description</span></h2>\n<a href="javascript:void(0);" class="details-edit">p</a>\n<div class="desc">\n    <form action="#" method="">\n        <div class="desc-content" contenteditable="false">\n            <p><%= nl2br(thing.get(\'description\')) %></p>\n        </div>\n        <div class="controls bg1">\n            <a class="btn btn-cancel">Cancel</a><button class="btn btn-primary" type="submit">Submit</button>\n        </div>\n    </form>\n</div>'}),define("views/things/show/description",["require","text!tpl/things/show/description.html","helpers/text"],function(e){var t=e("text!tpl/things/show/description.html"),n=e("helpers/text");return Backbone.View.extend({id:"desc",template:_.template(t),events:{"click .btn-cancel":"_closeFrom","submit form":"_onFormSubmit"},navigation:"Description",initialize:function(){this.$el=$("#"+this.id),this.el=this.$el[0],this.$el.on("edit",$.proxy(this._toggleEditForm,this)),this._parent=this.options.parent,this._thing=this.options.thing},render:function(){var e={thing:this._thing};_.extend(e,n),this.$el.html(this.template(e)),this.$form=$("form",this.$el),this.form=this.$form[0]},_toggleEditForm:function(e,t){if(t){var r=$(".desc-content").height();$(".desc-content p",this.$el).remove(),$(".desc-content",this.$el).prepend("<textarea style='height:"+r+"px;'>"+this._thing.get("description")+"</textarea>")}else $(".desc-content textarea",this.$el).remove(),$(".desc-content",this.$el).prepend("<p>"+n.nl2br(this._thing.get("description"))+"</p>")},_onFormSubmit:function(){return this._parent.updateThingle({description:_.escape(this.$form.find(".desc-content textarea").val())}),this._closeFrom(),!1},_closeFrom:function(){this._toggleEditForm(null,!1),this.$el.removeClass("edited")}})}),define("text!tpl/things/show/tags.html",[],function(){return'<h2><span><%= title %></span></h2>\n<a href="javascript:void(0);" class="details-edit">p</a>\n<div class="details-tags bg1">\n    <div class="inner">\n        <form action="#" method="">\n            <div class="control-group">\n                <input name="tags" type="text" placeholder="Add your tags">\n                <button class="btn btn-add" type="submit">Add tags</button>\n            </div>\n        </form>\n    </div>\n</div>\n<div class="tags-list">\n    <% _.each(thing.get(\'tags\'), function(tag, i) { %>\n        <div class="tag" data-tag="<%= tag %>"><a href="#?q=<%= encodeURIComponent(tag) %>" target="_blank"><%= tag %></a><a href="javascript:void(0);" class="remove">*</a></div>\n    <% }); %>\n</div>'}),define("views/things/show/tags",["require","text!tpl/things/show/tags.html"],function(e){var t=e("text!tpl/things/show/tags.html");return Backbone.View.extend({id:"tags",template:_.template(t),events:{"click .tags-list .tag. .remove":"_onTagRemove","submit form":"_onFormSubmit"},navigation:"Tags",initialize:function(){this.$el=$("#"+this.id),this.el=this.$el[0],this._parent=this.options.parent,this._thing=this.options.thing,App.on("addToDeck",this._onAddToDeck,this)},render:function(){this.$el.html(this.template({title:this.navigation,thing:this._thing})),this.$form=$("form",this.$el),this.form=this.$form[0]},_onAddToDeck:function(){},_onTagRemove:function(e){var t=$(e.target).parents(".tag");t.remove();var n=this._thing.get("tags"),r=n.indexOf(t.data("tag"));r>=0&&(n.splice(r,1),this._thing.set("tags",n),this._parent.updateThingle())},_onFormSubmit:function(){var e=this.$form.find("[name='tags']").val();return e&&(e=e.replace(/(\s*,\s*)+/g,",").split(","),e=e.concat(this._thing.get("tags")),this._thing.set("tags",$.unique(e)),this._parent.updateThingle(),this.render()),!1}})}),define("text!tpl/things/show/editors.html",[],function(){return'<h2><span><%= title %></span></h2>\n<div class="editors">\n    <div class="scroll-pane horizontal">\n        <ul class="list-names">\n            <% _.each(editions, function(edition) { %>\n                <% var author = users[edition.author]; %>\n                <li class="<%= curatorId == edition.author ? \'curator\' : \'\' %>">\n                    <% if (edition.revision) { %>\n                        <a href="javascript:void(0);" class="revert" data-revision="<%= edition.revision %>">revert to this edit</a>\n                    <% } %>\n                    <a href="#!users/<%= author.get("_id") %>" class="img"><span class="avatar" style="background-image:url(<%= author.get("picture").medium %>);"></span></a>\n                    <div class="info">\n                        <div class="username"><a href="#!users/<%= author.get("_id") %>"><%= author.get("firstName") %> <%= author.get("lastName") %></a></div>\n                        <div class="date"><%= DateHelper.format(edition.createdAt) %></div>\n                    </div>\n                </li>\n            <% }); %>\n        </ul>\n    </div>\n</div>'}),define("views/things/show/editors",["require","text!tpl/things/show/editors.html","helpers/date"],function(e){var t=e("text!tpl/things/show/editors.html"),n=e("helpers/date"),r=App.Collections.Users;return Backbone.View.extend({id:"editors",template:_.template(t),events:{"click .revert":"_revert"},navigation:"Editors",initialize:function(){this.$el=$("#"+this.id),this.el=this.$el[0],this._parent=this.options.parent;var e=this;this._parent.on("saveThingle",this.render,this),this._thing=this.options.thing},render:function(){var e=this,t=new r;t.fetch({data:{ids:this._getEditorsIds().join(",")},success:function(t){var r=[{author:e._thing.get("updatedUser")?e._thing.get("updatedUser")._id:e._thing.get("createdUser")._id,createdAt:e._thing.get("updatedAt")}];r=e._thing.get("editions").concat(r).reverse();var i={title:e.navigation,curatorId:e._thing.get("createdUser")._id,editions:r,users:e._getUsersByIdsMap(t.models),DateHelper:n};e.$el.html(e.template(i)),$(".scroll-pane",this.$el).jScrollPane()}})},_getEditorsIds:function(){var e=[this._thing.get("updatedUser")?this._thing.get("updatedUser")._id:this._thing.get("createdUser")._id],t=this._thing.get("editions");for(var n=0;n<t.length;++n)e.push(t[n].author);return e},_getUsersByIdsMap:function(e){var t={};for(var n=0;n<e.length;++n)t[e[n].get("_id")]=e[n];return t},_revert:function(e){var t=this,n=$(e.target).data("revision");return $.ajax({url:"/api/things/"+this._thing.get("_id")+"/revisions/"+n+"/revert",success:function(){t._parent.render()}}),!1}})}),define("text!tpl/things/show/collectors.html",[],function(){return'<h2><span><%= title %></span></h2>\n<div class="editors">\n    <div class="scroll-pane horizontal">\n        <ul class="list-names">\n            <% _.each(collectors, function(collector) { %>\n            <li>\n                <a href="#!users/<%= collector.get("_id") %>" class="img"><span class="avatar" style="background-image:url(<%= collector.get("picture").medium %>);"></span></a>\n                <div class="info">\n                    <div class="username"><a href="#!users/<%= collector.get("_id") %>"><%= collector.get("firstName") %> <%= collector.get("lastName") %></a></div>\n                </div>\n            </li>\n            <% }); %>\n        </ul>\n    </div>\n</div>'}),define("views/things/show/collectors",["require","text!tpl/things/show/collectors.html"],function(e){var t=e("text!tpl/things/show/collectors.html"),n=App.Collections.Users;return Backbone.View.extend({limit:5,id:"collectors",template:_.template(t),events:{},navigation:"Collectors",initialize:function(){this.$el=$("#"+this.id),this.el=this.$el[0],this._parent=this.options.parent,this._thing=this.options.thing,this._usersMap={};var e=this;App.currentUser.checkAuth(function(){e._usersMap[App.currentUser.get("_id")]=App.currentUser}),App.on("afterRepost",this._onRepost,this)},render:function(){var e=this,t=this._getUniqueCollectors(this._thing.get("collectors")),r=new n;t.length>0?r.fetch({data:{ids:t},success:function(n){e._addUsersInMap(n.models),e._showBlock(t)}}):e._showBlock(t)},_showBlock:function(e){for(var t=0;t<e.length;++t)e[t]=this._usersMap[e[t]];this.$el.html(this.template({title:this.navigation,collectors:e})),e.length==0?($("a[target='#"+this.id+"']").parent("li").hide(),this.$el.hide()):($("a[target='#"+this.id+"']").parent("li").show(),this.$el.show())},_addUsersInMap:function(e){for(var t=0;t<e.length;++t)this._usersMap[e[t].get("_id")]=e[t]},_onRepost:function(e){if(e.thingle_id==this._thing.get("_id")){var t=this._thing.get("collectors");t.push(App.currentUser.get("_id")),this._showBlock(this._getUniqueCollectors(t))}},_getUniqueCollectors:function(e){return $.unique([].concat(e).reverse()).slice(this.limit*-1).reverse()}})}),define("text!tpl/things/show/likers.html",[],function(){return'<h2><span><%= title %></span></h2>\n<div class="editors">\n    <div class="scroll-pane horizontal">\n        <ul class="list-names">\n            <% _.each(likers, function(liker) { %>\n            <% if (!liker) return;%>\n            <li>\n                <a href="#!users/<%= liker.get("_id") %>" class="img"><span class="avatar" style="background-image:url(<%= liker.get("picture").medium %>);"></span></a>\n                <div class="info">\n                    <div class="username"><a href="#!users/<%= liker.get("_id") %>"><%= liker.get("firstName") %> <%= liker.get("lastName") %></a></div>\n                </div>\n            </li>\n            <% }); %>\n        </ul>\n    </div>\n</div>'}),define("views/things/show/likers",["require","text!tpl/things/show/likers.html"],function(e){var t=e("text!tpl/things/show/likers.html"),n=App.Collections.Users;return Backbone.View.extend({limit:5,id:"likers",template:_.template(t),events:{},navigation:"Lovers",initialize:function(){this.$el=$("#"+this.id),this.el=this.$el[0],this._parent=this.options.parent,this._thing=this.options.thing,App.on("onLikeSuccess",this._onLike,this)},render:function(){var e=this,t=this._thing.get("likers"),r=new n;t=t?t.slice(this.limit*-1).reverse():[],t.length>0?r.fetch({data:{ids:t.join(",")},success:function(n){var r=e._getUsersByIdsMap(n.models);for(var i=0;i<t.length;++i)t[i]=r[t[i]];e._showBlock(t)}}):e._showBlock(t)},_showBlock:function(e){this.$el.html(this.template({title:this.navigation,likers:e})),e.length==0?($("a[target='#"+this.id+"']").parent("li").hide(),this.$el.hide()):($("a[target='#"+this.id+"']").parent("li").show(),this.$el.show())},_onLike:function(e){e.thingId==this._thing.get("_id")&&this.render()},_getUsersByIdsMap:function(e){var t={};for(var n=0;n<e.length;++n)t[e[n].get("_id")]=e[n];return t}})}),define("maps",[],function(){var e=$.Deferred(),t=App.Config.get("gmaps"),n=document.createElement("script");return n.type="text/javascript",n.src="http://maps.googleapis.com/maps/api/js?"+(t?"key="+t+"&":"")+"callback=gMapsApiCB&sensor=false&libraries=places",window.gMapsApiCB=function(){e.resolve()},document.body.appendChild(n),e}),define("text!tpl/things/show/map.html",[],function(){return'<h2><span>Map</span></h2>\n<div class="b-map<% if (locations.length == 0) { %> expanded<% } %>">\n    <div class="inner">\n        <div class="map-title">\n            <div class="locations-count"><span>@</span> <%= locations.length %> locations mapped</div>\n            <a href="javascript:void(0)" class="btn btn-black edit">Add Location</a>\n        </div>\n        <div class="map-right">\n            <div class="map-description">â Select a row to view on map</div>\n            <div class="scroll-pane">\n                <ul class="users">\n					<% _.each(locations, function(location, index) { %>\n                    <li>\n                        <figure>\n                            <a href="#!users/<%= location.author._id %>" class="userpic">\n                                <span class="avatar" style="background-image:url(<%= location.author.picture.small %>);"></span>\n                            </a>\n                            <figcaption><%= index + 1 %></figcaption>\n                        </figure>\n                        <div class="info show" data-index="<%= index %>">\n                            <div class="title"><%= location.name %></div>\n                            <div class="location"><%= location.address %></div>\n                        </div>\n                    </li>\n					<% }); %>\n                </ul>\n            </div>\n        </div>\n        <div class="map-left">\n            <div class="map-description">â Select a map label to view details</div>\n            <div class="map block"></div>\n            <a href="#" class="map-resize expand"></a>\n        </div>\n    </div>\n\n    <div id="add-location" class="block map-edit" />\n    <div id="details-location" class="block map-info" />\n    \n</div>'}),define("text!tpl/things/show/map/info.html",[],function(){return'<div class="modal-header">\n    <button class="close"></button>\n    <div class="comments">\n        <div class="count">1</div>\n        <div class="icon">w</div>\n    </div>\n    <button class="btn btn-primary edit" data-index="<%= index %>" >Edit Location</button>\n</div>\n<div class="modal-body bg1">\n    <div class="location-info">\n        <div class="img block"><img src="<%= location.author.picture.medium %>" alt="<%= location.author.firstName + " " + location.author.lastName %>"></div>\n        <div class="info">\n            <div class="found"><%= location.author.firstName + " " + location.author.lastName %> found</div>\n            <div class="title"><%= location.name %></div>\n            <div class="location"><%= location.address %></div>\n        </div>\n    </div>\n	<% if (location.notes && location.notes.length > 0) {  %>\n    <div class="message corner-top">\n        <p><%= location.notes %></p>\n    </div>\n	<% } %>\n</div>\n<div class="modal-footer">\n    <a href="javascript:void(0)" class="action-link delete" data-index="<%= index %>" >Delete location</a>\n</div>'}),define("text!tpl/things/show/map/edit.html",[],function(){return'<div class="modal-header">\n    <button class="close" />\n    <h3>Add a location</h3>\n    <h4>You can enter the full addresses for the location.</h4>\n</div>\n<form action="javascript:void(0)" method="">\n    <div class="modal-body">\n        <aside class="location-left">\n            <div class="control-group location_address">\n                <label class="control-label">\n                    Location address\n                </label>\n                <div class="controls">\n                    <input type="text" name="location_address" value="<%= location.address %>" />\n                </div>\n            </div>\n        </aside>\n        <aside class="location-right">\n            <div class="control-group">\n                <label class="control-label">\n                    Location name (optional)\n                </label>\n                <div class="controls">\n                    <input type="text" name="location_name" value="<%= location.name %>"/>\n                </div>\n            </div>\n            <div class="control-group">\n                <label class="control-label">\n                    Notes (optional)\n                </label>\n                <div class="controls">\n                    <textarea name="location_notes" cols="30" rows="8"><%= location.notes %></textarea>\n                </div>\n            </div>\n        </aside>\n    </div>\n    <div class="modal-footer">\n        <button type="submit" class="btn btn-add save" data-index="<%= index %>">\n        	<% if (index) {%>Save<% } else {%>Add location<% }%>\n        </button>\n    </div>\n</form>\n'}),define("views/things/show/map",["maps","text!tpl/things/show/map.html","text!tpl/things/show/map/info.html","text!tpl/things/show/map/edit.html"],function(e,t,n,r){var i="http://chart.googleapis.com/chart?chst=d_map_pin_letter_withshadow&chld={}|2A80C5|000000",s="http://chart.googleapis.com/chart?chst=d_map_pin_letter_withshadow&chld={}|FF0000|000000",o={address:"",name:"",notes:""};return Backbone.View.extend({id:"map",events:{"click .edit":"_openEdit","click .close":"_close","click .map-resize":"_resizeMap","click .show":"_showOnMap","click .delete":"_deleteLocation","click .save":"_saveLocation"},template:_.template(t),infoTemplate:_.template(n),editTemplate:_.template(r),navigation:"Map",initialize:function(){this.$el=$("#"+this.id),this.el=this.$el[0],this._parent=this.options.parent,this._thing=this.options.thing,this._markers=new Array},render:function(){var t=this;$.when(e,this._loadLocations()).done(function(){t.$el.html(t.template({locations:t._locations})),t.$el.find(".scroll-pane").jScrollPane();var e=t._renderMap();t._renderMarkers(e,t._locations)})},_loadLocations:function(){var e=this,t=$.Deferred();return this._thing.fetch({success:function(n){e._locations=n.get("locations")||new Array,t.resolve()}}),t},_renderMap:function(e){var t=this,n=new google.maps.LatLng(40.7396534,-74.00642260000001);this._map=new google.maps.Map($(".map",this.$el)[0],{scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,center:n,zoom:12});var r=new google.maps.Marker({position:n,map:this._map}),i=new google.maps.InfoWindow({content:"<h1>Thingle Inc</h1><p>1 Little West 12th Street, Suite 512<br>New York, NY 10014<br>US</p>"});return google.maps.event.addListener(r,"click",function(){i.open(t._map,r)}),this._map},_renderMarkers:function(e,t){var n=this,r=new google.maps.LatLngBounds;for(var s=0;s<t.length;s++){var o=t[s],u=new google.maps.LatLng(o.latLng[0],o.latLng[1]),a=new google.maps.Marker({position:u,map:e,title:o.name,icon:i.replace("{}",s+1)});r.extend(u),n._addListenerInScope(a,s),this._markers[s]=a}t.length==1?(e.setCenter(r.getCenter()),e.setZoom(12)):t.length>1&&e.fitBounds(r)},_addListenerInScope:function(e,t){var n=this;google.maps.event.addListener(e,"click",function(){n._openInfo(t)})},_openInfo:function(e){this._close();var t=this._locations[e];$(".map-info",this.$el).html(this.infoTemplate({location:t,index:e})).show()},_openEdit:function(e){this._close();var t=this,n=$(e.target).attr("data-index")||"",r=this._locations[n]||o;return App.currentUser.checkAuth(function(){var e=$(".map-edit",t.$el);e.html(t.editTemplate({location:r,index:n})).show();var i=e.find("[name=location_address]");t._autocomplete=new google.maps.places.Autocomplete(i[0]),i.focus(),google.maps.event.addDomListener(i[0],"keydown",function(n){n.keyCode==13&&n.preventDefault&&n.preventDefault(),t._displayErrors(e)})},!0),!1},_close:function(e){return $(".map-edit",this.$el).empty().hide(),$(".map-info",this.$el).empty().hide(),!1},_resizeMap:function(e){e.preventDefault(),$(".b-map").toggleClass("expanded")},_showOnMap:function(e){if(this._selection!=undefined){var t=this._markers[this._selection];t.setIcon(i.replace("{}",this._selection+1))}this._selection=parseInt($(e.target).attr("data-index")||$(e.target.parentElement).attr("data-index"));var n=this._markers[this._selection];n.setIcon(s.replace("{}",this._selection+1)),this._map.panTo(n.getPosition())},_saveLocation:function(e){var t=this,n=$(e.target).attr("data-index"),r=this._autocomplete.getPlace();if(!r&&!n)return t._displayErrors(i,{location_address:"Invalide address"}),!1;r||(r={formatted_address:t._locations[n].address,geometry:{location:{Xa:t._locations[n].latLng[0],Ya:t._locations[n].latLng[1]}}});var i=$(".map-edit",this.$el),s=$("[name=location_name]",i).val(),o=$("[name=location_notes]",i).val(),u=r.formatted_address;u.substring(0,r.name.length)!=r.name&&(u=r.name+". "+u);var a={name:s,notes:o,address:u,latLng:[r.geometry.location.Xa,r.geometry.location.Ya]},f=new Array;for(var l=0;l<t._locations.length;l++)f.push({_id:t._locations[l]._id});return n?$.extend(f[n],a):f.push(a),t._thing.set("locations",f),t._thing.save(null,{success:function(){t._close(),t.render()}}),!1},_displayErrors:function(e,t){$(".control-group",e).removeClass("error"),$(".control-group span",e).empty();if(t)for(input in t)$(".control-group."+input,e).addClass("error"),$(".control-group."+input+" span",e).html(t[input])},_deleteLocation:function(e){var t=this,n=$(e.target).attr("data-index"),r=new Array;for(var i=0;i<t._locations.length;i++)r.push({_id:t._locations[i]._id});return r.splice(n,1),t._thing.set("locations",r),t._thing.save(null,{success:function(){t._close(),t.render()}}),!1},_geocode:function(e){var t=$.Deferred(),n=new google.maps.Geocoder;return n.geocode({address:e},function(e,n){n==google.maps.GeocoderStatus.OK?t.resolve({latLng:[e[0].geometry.location.Xa,e[0].geometry.location.Ya],address:e[0].formatted_address}):t.reject()}),t}})}),function(e){function t(e,t){var n=parseInt(e.css(t),10);if(n)return n;var r=e[0].currentStyle;return r&&r.width&&parseInt(r.width,10)}function n(t,n){var r=e(n);return r.length<2?r:t.parent().find(n)}function i(t,i){var s=this,o=t.add(s),u=t.children(),f=0,l=i.vertical;r||(r=s),u.length>1&&(u=e(i.items,t)),i.size>1&&(i.circular=!1),e.extend(s,{getConf:function(){return i},getIndex:function(){return f},getSize:function(){return s.getItems().size()},getNaviButtons:function(){return m.add(g)},getRoot:function(){return t},getItemWrap:function(){return u},getItems:function(){return u.find(i.item).not("."+i.clonedClass)},move:function(e,t){return s.seekTo(f+e,t)},next:function(e){return s.move(i.size,e)},prev:function(e){return s.move(-i.size,e)},begin:function(e){return s.seekTo(0,e)},end:function(e){return s.seekTo(s.getSize()-1,e)},focus:function(){return r=s,s},addItem:function(t){return t=e(t),i.circular?(u.children().last().before(t),u.children().first().replaceWith(t.clone().addClass(i.clonedClass))):(u.append(t),g.removeClass("disabled")),o.trigger("onAddItem",[t]),s},seekTo:function(t,n,c){t.jquery||(t*=1);if(i.circular&&t===0&&f==-1&&n!==0)return s;if(!i.circular&&t<0||t>s.getSize()||t<-1)return s;var h=t;t.jquery?t=s.getItems().index(t):h=s.getItems().eq(t);var p=e.Event("onBeforeSeek");if(!c){o.trigger(p,[t,n]);if(p.isDefaultPrevented()||!h.length)return s}var v=l?{top:-h.position().top}:{left:-h.position().left};return f=t,r=s,n===undefined&&(n=i.speed),u.animate(v,n,i.easing,c||function(){o.trigger("onSeek",[t])}),s}}),e.each(["onBeforeSeek","onSeek","onAddItem"],function(t,n){e.isFunction(i[n])&&e(s).on(n,i[n]),s[n]=function(t){return t&&e(s).on(n,t),s}});if(i.circular){var h=s.getItems().slice(-1).clone().prependTo(u),p=s.getItems().eq(1).clone().appendTo(u);h.add(p).addClass(i.clonedClass),s.onBeforeSeek(function(e,t,n){if(!e.isDefaultPrevented()){if(t==-1)return s.seekTo(h,n,function(){s.end(0)}),e.preventDefault();t==s.getSize()&&s.seekTo(p,n,function(){s.begin(0)})}});var v=t.parents().add(t).filter(function(){if(e(this).css("display")==="none")return!0});v.length?(v.show(),s.seekTo(0,0,function(){}),v.hide()):s.seekTo(0,0,function(){})}var m=n(t,i.prev).click(function(e){e.stopPropagation(),s.prev()}),g=n(t,i.next).click(function(e){e.stopPropagation(),s.next()});i.circular||(s.onBeforeSeek(function(e,t){setTimeout(function(){e.isDefaultPrevented()||(m.toggleClass(i.disabledClass,t<=0),g.toggleClass(i.disabledClass,t>=s.getSize()-1))},1)}),i.initialIndex||m.addClass(i.disabledClass)),s.getSize()<2&&m.add(g).addClass(i.disabledClass),i.mousewheel&&e.fn.mousewheel&&t.mousewheel(function(e,t){if(i.mousewheel)return s.move(t<0?1:-1,i.wheelSpeed||50),!1});if(i.touch){var y={};u[0].ontouchstart=function(e){var t=e.touches[0];y.x=t.clientX,y.y=t.clientY},u[0].ontouchmove=function(e){if(e.touches.length==1&&!u.is(":animated")){var t=e.touches[0],n=y.x-t.clientX,r=y.y-t.clientY;s[l&&r>0||!l&&n>0?"next":"prev"](),e.preventDefault()}}}i.keyboard&&e(document).on("keydown.scrollable",function(t){if(!(!i.keyboard||t.altKey||t.ctrlKey||t.metaKey||e(t.target).is(":input"))){if(i.keyboard!="static"&&r!=s)return;var n=t.keyCode;if(!(!l||n!=38&&n!=40))return s.move(n==38?-1:1),t.preventDefault();if(!l&&(n==37||n==39))return s.move(n==37?-1:1),t.preventDefault()}}),i.initialIndex&&s.seekTo(i.initialIndex,0,function(){})}e.tools=e.tools||{version:"v1.2.7"},e.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}};var r;e.fn.scrollable=function(t){var n=this.data("scrollable");return n?n:(t=e.extend({},e.tools.scrollable.conf,t),this.each(function(){n=new i(e(this),t),e(this).data("scrollable",n)}),t.api?n:this)}}(jQuery),function(e){var t=e.tools.scrollable;t.autoscroll={conf:{autoplay:!0,interval:3e3,autopause:!0}},e.fn.autoscroll=function(n){typeof n=="number"&&(n={interval:n});var r=e.extend({},t.autoscroll.conf,n),i;return this.each(function(){function u(){s&&clearTimeout(s),s=setTimeout(function(){t.next()},r.interval)}var t=e(this).data("scrollable"),n=t.getRoot(),s,o=!1;t&&(i=t),t.play=function(){s||(o=!1,n.on("onSeek",u),u())},t.pause=function(){s=clearTimeout(s),n.off("onSeek",u)},t.resume=function(){o||t.play()},t.stop=function(){o=!0,t.pause()},r.autopause&&n.add(t.getNaviButtons()).hover(t.pause,t.resume),r.autoplay&&t.play()}),r.api?i:this}}(jQuery),function(e){function n(t,n){var r=e(n);return r.length<2?r:t.parent().find(n)}var t=e.tools.scrollable;t.navigator={conf:{navi:".navi",naviItem:null,activeClass:"active",indexed:!1,idPrefix:null,history:!1}},e.fn.navigator=function(r){typeof r=="string"&&(r={navi:r}),r=e.extend({},t.navigator.conf,r);var i;return this.each(function(){function h(e,n,r){t.seekTo(n),r.preventDefault(),f&&history.pushState({i:n},"")}function p(){return s.find(r.naviItem||"> *")}function v(t){var n=e("<"+(r.naviItem||"a")+"/>").click(function(n){h(e(this),t,n)});return t===0&&n.addClass(u),r.indexed&&n.text(t+1),r.idPrefix&&n.attr("id",r.idPrefix+t),n.appendTo(s)}var t=e(this).data("scrollable"),s=r.navi.jquery?r.navi:n(t.getRoot(),r.navi),o=t.getNaviButtons(),u=r.activeClass,f=r.history&&history.pushState,l=t.getConf().size;t&&(i=t),t.getNaviButtons=function(){return o.add(s)},f&&(history.pushState({i:0},""),e(window).on("popstate",function(e){var n=e.originalEvent.state;n&&t.seekTo(n.i)})),p().length?p().each(function(t){e(this).click(function(n){h(e(this),t,n)})}):e.each(t.getItems(),function(e){e%l==0&&v(e)}),t.onBeforeSeek(function(e,t){setTimeout(function(){if(!e.isDefaultPrevented()){var n=t/l,r=p().eq(n);r.length&&p().removeClass(u).eq(n).addClass(u)}},1)}),t.onAddItem(function(e,n){var r=t.getItems().index(n);r%l==0&&v(r)})}),r.api?i:this}}(jQuery),define("lib/jquery.tools.min",function(){}),define("views/things/show",["require","text!tpl/things/show.html","views/things/show/title","views/things/show/gallery","views/things/show/comments","views/things/show/description","views/things/show/tags","views/things/show/editors","views/things/show/collectors","views/things/show/likers","views/things/show/map","lib/jquery.tools.min"],function(e){var t=e("text!tpl/things/show.html"),n=e("views/things/show/title"),r=e("views/things/show/gallery"),i=e("views/things/show/comments"),s=e("views/things/show/description"),o=e("views/things/show/tags"),u=e("views/things/show/editors"),a=e("views/things/show/collectors"),f=e("views/things/show/likers"),l=e("views/things/show/map");return e("lib/jquery.tools.min"),Backbone.View.extend({id:"thingle-details",template:_.template(t),events:{"click .details-nav .pages-settings > a":"_openPageBuilder","click .details-nav .add-page > a":"_openThinglePopup","click .details-nav li > a":"_navigate","click .btn-follow":"_follow","click .btn-unfollow":"_unfollow","click .details-edit":"_toggleEditForm"},initialize:function(){App.on("afterRepost",this._onRepost,this),this._thing=new App.Models.Thing({_id:this.options.thingId||this.options[0]}),$(".details-editable",this.$el).on("edit",$.proxy(this._toggleEditForm,this))},render:function(){var e=this;this._thing.fetch({success:function(t){var c=e._user=new App.Models.User(t.get("createdUser")),h=e._deck=new App.Models.Deck(t.get("createdDeck")),p={thing:t,deck:h,user:c};$(e.el).html(e.template(p)),e.$(".scrollable .item:first").addClass("active"),e._switchProfileBtn(),e._renderDetailsBlock(n),e._renderDetailsBlock(r),e._renderDetailsBlock(s),t.get("settings")&&t.get("settings").map&&e._renderDetailsBlock(l),e._renderDetailsBlock(i),e._renderDetailsBlock(a),e._renderDetailsBlock(f),e._renderDetailsBlock(o),e._renderDetailsBlock(u),e._renderDetailsScroll(),$(".details-nav ul").append('<li class="pages-settings"><a href="#">x</a></li>'),App.trigger("meta:change",{title:t.get("title"),description:t.get("description"),keywords:t.get("tags")})}})},updateThingle:function(e){var t=this;if(e)for(var n in e)this._thing.set(n,e[n]);this._thing.save(null,{success:function(){t.trigger("saveThingle")}})},_renderDetailsScroll:function(){var e=this.options.modal?"absolute":"fixed",t=this.options.modal?function(e){return e.scrollTop-1}:$("header").outerHeight()-1,n=this.options.modal||window,r=$(".scrollable-outer"),i=$(".details-title");$(n).scroll(function(){var n=$(this),s=r.outerHeight(),o=$(".details-nav");n.scrollTop()>=s?o.css({position:e,right:$("#shelf").hasClass("opened")?221:0,top:i.outerHeight()+(typeof t=="function"?t(this):t)}):o.css({position:"absolute",right:0,top:0}),i.css({top:typeof t=="function"?t(this):t}),r.css({top:i.outerHeight()+(typeof t=="function"?t(this):t)})})},_renderDetailsBlock:function(e){var t=new e({parent:this,thing:this._thing});t.navigation&&this._putLinkToNav(t.navigation,t.id),t.render()},_onRepost:function(e){if(e.thingle_id==this._thing.get("_id")){var t=this;this._thing.fetch({success:function(){t._renderDetailsBlock(o)}})}},_putLinkToNav:function(e,t){$(".details-nav li a[target='#"+t+"']").length==0&&$(".details-nav ul").append("<li><a target='#"+t+"'>"+e+"</a></li>"),$(".details-nav li.active").length==0&&$(".details-nav li:first").addClass("active")},_switchProfileBtn:function(){var e=this,t=e.$(".btn-follow"),n=e.$(".btn-unfollow"),r=e.$(".btn-editprofile");r.hide(),n.hide(),App.currentUser.checkAuth(function(){t.hide();if(e._user.get("_id")==App.currentUser.get("_id"))return r.show();if(App.currentUser.get("followings").indexOf(e._user.get("_id"))==-1)return t.show();n.show()})},_navigate:function(e){var t=$(this.options.modal||"body"),n=$(".details-nav"),r=$(".details-title"),i=$("#carousel"),s=$(e.target).prop("target");s=="#carousel"?id_top=0:id_top=$(s).position().top+i.outerHeight()+20,$(".details-nav li").removeClass("active"),$(e.target).parent().addClass("active"),t.animate({scrollTop:id_top},"normal")},_follow:function(){var e=this;this._user.follow(function(){e._switchProfileBtn()})},_unfollow:function(){var e=this;this._user.unfollow(function(){e._switchProfileBtn()})},_toggleEditForm:function(e){var t=function(){var t=$(e.target).parents(".details-editable");t.trigger("edit",[!t.hasClass("edited")]),t.toggleClass("edited")};App.currentUser.checkAuth(t,!0)},_openPageBuilder:function(e){return App.popup("page-builder",{thing:this._thing,thingView:this}),!1},_openThinglePopup:function(){var e=this;App.popup("thingles/new-popup-2",{thingle:this._thing,onSubmit:function(){e.render()}})}})}),define("views/decks/index",["require"],function(e){var t=App.Models.Deck;return Backbone.View.extend({render:function(){var e=this;(new t).fetch({url:"/api/decks/"+e.options[0],success:function(t){var n=$("<div></div>");$(e.el).append(n);var r=t.get("user")._id||t.get("user");App.view("things/things-list",{el:n,url:"/api/decks/"+e.options[0]+"/things",deckOwnerId:r,showDeleteButton:r==App.currentUser.get("_id"),title:t.get("name"),category:"collections"});var i=$('<div class="profile-container" />');$(n).prepend(i);var s=new App.Models.User({_id:t.get("user")._id});App.view("profile",{el:i,user:s}),s.fetch({success:function(e){App.trigger("meta:change",{title:t.get("name"),description:"'"+t.get("name")+"' by "+e.get("firstName")+" "+e.get("lastName"),keywords:t.get("tags")})}}),$(n).on("onItemRemove",$.proxy(e,"onItemRemove"))}})},onItemRemove:function(e,t){$.ajax({type:"DELETE",url:"/api/decks/"+this.options[0]+"/things/"+t})}})}),define("text!tpl/activity_stream.html",[],function(){return'<div class="b-activity-stream">\n    <aside class="notifications block">\n        <div class="block-title">\n            <h3><a href="javascript:void(0);" class="notifications-panel-toggle">configure notifications</a></h3>\n        </div>\n\n        <div class="block-inner">\n            <div class="scrollable">\n                <div class="items">\n                    <div>\n                        <ul>\n                            <% var inc = 0; %>\n                            <% _.each(models, function(n) { %>\n                                <%\n                                if (inc >= 9) {\n                                    inc = 0;\n                                    %>\n                                        </ul></div><div><ul>\n                                    <%\n                                }\n                                inc++;\n                                %>\n                                <li class="notification" data-id="<%= n.get("_id") %>">\n                                    <div>\n                                        <a href="#!users/<%= n.get("sender")._id %>" class="avatar" style="background-image:url(\'<%= n.get("sender").picture.small %>\')"></a>\n                                        <span class="info">\n                                            <span><%= n.get("text") %></span>\n                                        </span>\n                                        <span class="date"><%= DateHelper.format(n.get("createdAt"), "%J") %></span>\n                                    </div>\n                                </li>\n                            <% }); %>\n                        </ul>\n                    </div>\n                </div>\n                <a class="prev"></a>\n                <a class="next"></a>\n                <div class="navi"></div>\n            </div>\n        </div>\n    </aside>\n\n    <section id="notification-content" class="stream block bg1" style="display: none;"></section>\n</div>'}),define("text!tpl/activity_stream/_details.html",[],function(){return'<div class="stream-header block-title">\n    <a  href="#!users/<%= notification.get("sender")._id %>">\n        <div class="avatar" style="background-image:url(\'<%= notification.get("sender").picture.small %>\')"></div>\n    </a>\n    <div class="info">\n        <div class="title"><%= notification.get("text") %></div>\n        <div class="date"><%= DateHelper.format(notification.get("createdAt"), "%J") %></div>\n    </div>\n    <a href="#!users/<%= notification.get("sender")._id %>" class="user-profile">U</a>\n</div>\n<div class="stream-content">\n    <div class="stream-figure">\n        <figure>\n            <figcaption>\n                <img src=\'data:image/gif;base64,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\'/>\n            </figcaption>\n        </figure>\n    </div>\n</div>'}),define("text!tpl/activity_stream/thingle_event.html",[],function(){return'<div class="message corner-bottom">\n    <p><%= TextHelper.nl2br(thing.get("description")) %></p>\n</div>\n\n<div class="stream-figure">\n    <figure>\n        <div class="img block">\n            <a href="#!things/<%= thing.get("id") %>">\n                <img draggable="false" class="" src="<%= thing.get("pictures")[0].sizes[0].url %>">\n            </a>\n        </div>\n        <figcaption>\n            <a href="#!things/<%= thing.get("id") %>">\n                <%= thing.get("title") %>\n            </a>\n        </figcaption>\n    </figure>\n</div>'}),define("views/activity_stream/thingle_event",["require","text!tpl/activity_stream/thingle_event.html","helpers/date","helpers/text"],function(e){var t=e("text!tpl/activity_stream/thingle_event.html"),n=e("helpers/date"),r=e("helpers/text"),i=App.Models.Thing;return Backbone.View.extend({template:_.template(t),events:{},render:function(){var e=this,t={DateHelper:n,TextHelper:r,notification:this.options.notification},s=new i;s.set("_id",this.options.notification.get("objects").thing),s.fetch({success:function(n){t.thing=n,$(e.el).html(e.template(t)),$(e.el).show()}})}})}),define("text!tpl/activity_stream/comment_event.html",[],function(){return'<div class="message corner-bottom">\n    <p><%= TextHelper.nl2br(comment.get("text")) %></p>\n</div>\n\n<div class="stream-figure">\n    <figure>\n        <div class="img block">\n            <a href="#!things/<%= thing.get("id") %>">\n                <img draggable="false" class="" src="<%= thing.get("pictures")[0].sizes[0].url %>">\n            </a>\n        </div>\n        <figcaption>\n            <a href="#!things/<%= thing.get("id") %>">\n                <%= thing.get("title") %>\n            </a>\n        </figcaption>\n    </figure>\n</div>'}),define("views/activity_stream/comment_event",["require","text!tpl/activity_stream/comment_event.html","helpers/date","helpers/text"],function(e){var t=e("text!tpl/activity_stream/comment_event.html"),n=e("helpers/date"),r=e("helpers/text"),i=App.Models.Thing,s=App.Models.Comment;return Backbone.View.extend({template:_.template(t),_requests:0,events:{},data:{DateHelper:n,TextHelper:r},_initialize:function(){this.data.notification=this.options.notification},_putContent:function(){this._requests--,this._requests==0&&$(this.el).html(this.template(this.data))},render:function(){var e=this;this._requests=2;var t=new i;t.set("_id",this.options.notification.get("objects").thing),t.fetch({success:function(t){e.data.thing=t,e._putContent()}});var n=new s({thing:this.options.notification.get("objects").thing});n.set("_id",this.options.notification.get("objects").comment),n.fetch({success:function(t){e.data.comment=t,e._putContent()}})}})}),define("text!tpl/activity_stream/user_event.html",[],function(){return'<div class="stream-figure">\n    <figure>\n        <div class="block">\n            <a href="#!users/<%= sender._id %>">\n                <img draggable="false" class="" src="<%= sender.picture.large %>">\n            </a>\n        </div>\n        <figcaption>\n            <a href="#!users/<%= sender._id %>">\n                <%= sender.firstName %> <%= sender.lastName %>\n            </a>\n        </figcaption>\n    </figure>\n</div>'}),define("views/activity_stream/user_event",["require","text!tpl/activity_stream/user_event.html","helpers/date","helpers/text"],function(e){var t=e("text!tpl/activity_stream/user_event.html"),n=e("helpers/date"),r=e("helpers/text");return Backbone.View.extend({template:_.template(t),events:{},render:function(){var e=this,t={DateHelper:n,TextHelper:r,notification:this.options.notification,sender:this.options.notification.get("sender")};$(e.el).html(e.template(t)),$(e.el).show()}})}),define("views/activity_stream",["require","text!tpl/activity_stream.html","helpers/date","text!tpl/activity_stream/_details.html","views/activity_stream/thingle_event","views/activity_stream/comment_event","views/activity_stream/user_event","lib/jquery.tools.min"],function(e){var t=e("text!tpl/activity_stream.html"),n=e("helpers/date"),r=new App.Collections.Notifications,i=App.Models.Notification,s=_.template(e("text!tpl/activity_stream/_details.html")),o=e("views/activity_stream/thingle_event"),u=e("views/activity_stream/comment_event"),a=e("views/activity_stream/user_event"),f={thing_like:o,thing_comment:u,thing_collect:o,thing_change:o,thing_share:o,friend_join:a,user_follow:a};return e("lib/jquery.tools.min"),Backbone.View.extend({auth:!0,title:"Activity Stream",category:n.format(new Date,"%l, %F %j%S, %Y"),template:_.template(t),events:{"click .notification":"_onNotificationClick"},_onNotificationClick:function(e){this._openNotification(e.currentTarget)},_openNotification:function(e){var t=this;$(".notification",this.el).removeClass("active"),$(e).addClass("active"),$("section",t.el).fadeOut(100);var r=new i;r.set("_id",$(e).data("id")),r.fetch({success:function(e){$("section",t.el).html(s({notification:e,DateHelper:n})),$("section",t.el).fadeIn(100);var r=new(f[e.get("type")])({notification:e,el:$("section .stream-content",t.el)[0]});r.render()}})},render:function(){var e=this;r.fetch({data:{limit:63},success:function(t){$(e.el).html(e.template({DateHelper:n,models:t.models})),$(".scrollable",this.el).scrollable().navigator(),e._openNotification($(".notification:first",$(e.el)))}})}})}),define("text!tpl/bookmarklet/index.html",[],function(){return'<div class="modal thingle-modal bookmarklet-modal">\n    <form id="thing-form">\n        <div class="modal-inner">\n            <div class="img">\n                <img src="<%= url %>">\n            </div>\n            <div class="info">\n                <div class="control-group">\n                    <label>Thingle title:</label>\n                    <input type="text" name="title" class="span5">\n                </div>\n                <div class="control-group">\n                    <label>Description:</label>\n                    <textarea cols="30" rows="10" name="description"></textarea>\n                </div>\n                <div class="control-group">\n                    <label>Tags (comma separated values):</label>\n                    <input type="text" name="tags" class="span5"/>\n                </div>\n                <div class="control-group">\n                    <label>Collection:</label>\n                    <select name="deck">\n                        <% _.each(decks, function(deck) { %>\n                        <% var selected = deck.get(\'_id\') == lastSelectedCollection ? "selected=\'selected\'" : \'\'; %>\n                        <option value="<%= deck.get(\'_id\') %>" <%= selected  %> >\n                            <%= deck.get(\'name\') ? deck.get(\'name\') : "" %>\n                        </option>\n                        <% }); %>\n                    </select>\n                </div>\n				<div class="control-group">\n                	<label for="post-facebook" class="checkbox inline">\n                    	<input type="checkbox" name="share" id="post-facebook" checked="checked"/>Post to Facebook\n                    </label>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <a href="javascript:void(0)" class="submit-btn btn btn-primary">Save</a>\n        </div>\n    </form>\n</div>\n'}),define("views/bookmarklet/index",["require","lib/jquery.form","text!tpl/bookmarklet/index.html","helpers/html","helpers/cookie","helpers/select"],function(e){e("lib/jquery.form");var t=e("text!tpl/bookmarklet/index.html"),n=e("helpers/html");return CookieHelper=e("helpers/cookie"),SelectHelper=e("helpers/select"),Backbone.View.extend({auth:!0,id:"bookmarklet",template:_.template(t),events:{"click a.submit-btn":"save"},initialize:function(){this.thing=new App.Models.Thing,this.thing.set("sourceURL",this.options.source),this.options.image=this.options.image instanceof Array?this.options.image:[this.options.image];var e=new Array;for(var t=0;t<this.options.image.length;t++)e.push({sourceURL:this.options.source,url:this.options.image[t]});this.thing.set("pictures",e)},save:function(){var e=this,t=$("[name=deck] :selected").val(),r=e.$("[name=share]").attr("checked")?!0:!1;CookieHelper.setCookie("lastSelectedCollection",t);var i=$("[name=tags]").val();i=i?i.replace(/(^[\s,]+|[\s,]+$)/,"").replace(/(\s*,\s*)+/g,",").split(","):[],this.thing.set({title:$("[name=title]").val().replace(/(^\s+|\s+$)/,""),description:$("[name=description]").val().replace(/(^\s+|\s+$)/,""),createdDeck:t,tags:i,share:r});var s=n.showPreloader($(".submit-btn"));s.css("padding","2px 25px 3px 0"),this.thing.save({},{success:function(e,t){App.popup("success",{src:e.get("pictures")[0].url||e.get("pictures")[0].imageSourceURL,thing:e,onForward:function(e){var t=(document.location.protocol+"//"+document.location.host+"/").replace(/\/\/$/,"/")+e;window.open(t,"_blank")},beforeHide:function(){window.close()}})}})},render:function(){var e=this,t=Backbone.Collection.extend({model:App.Models.Deck,url:"/api/users/"+App.currentUser.get("_id")+"/decks"});e.decks=new t,e.decks.fetch({success:function(t){$(e.el).html(e.template({lastSelectedCollection:CookieHelper.getCookie("lastSelectedCollection"),url:e.thing.get("pictures")[0].url,decks:t.models})),SelectHelper.customize(e.el),console.log("sel",$("select",$(e.el)))}})}})}),define("text!tpl/profile/decks.html",[],function(){return'<div class="profile-container"></div>\n\n<% _.each(decks.models, function(deck) { %>\n<figure data-id="<%= deck.id %>" class="item deck">\n    <a href="#!decks/<%= deck.id %>" class="img avatar" title="View <%= deck.get(\'name\') %> Collection" style="background-image:url(<%= (things.get(deck.thing_ids[0]) && things.get(deck.thing_ids[0]).getCoverPicture(\'medium\').url) || \'\' %>)">\n         <% if (isMyProfile){ %> \n          <span class="delete-deck">#</span>\n        <% } %>\n        <span class="deck-name">\n            <%= deck.get(\'name\') %>\n        </span>\n    </a>\n    <figcaption>\n        <ul>\n            <li><a href="#!<%= (things.get(deck.thing_ids[1]) && \'things/\' + deck.thing_ids[1]) || \'\' %>" class="avatar" style="background-image:url(<%= (things.get(deck.thing_ids[1]) && things.get(deck.thing_ids[1]).getCoverPicture(\'small\').url) || \'\' %>)"></a></li>\n            <li><a href="#!<%= (things.get(deck.thing_ids[2]) && \'things/\' + deck.thing_ids[2]) || \'\' %>" class="avatar" style="background-image:url(<%= (things.get(deck.thing_ids[2]) && things.get(deck.thing_ids[2]).getCoverPicture(\'small\').url) || \'\' %>)"></a></li>\n            <li><a href="#!<%= (things.get(deck.thing_ids[3]) && \'things/\' + deck.thing_ids[3]) || \'\' %>" class="avatar" style="background-image:url(<%= (things.get(deck.thing_ids[3]) && things.get(deck.thing_ids[3]).getCoverPicture(\'small\').url) || \'\' %>)"></a></li>\n        </ul>\n    </figcaption>\n</figure>\n<% }); %>'}),define("views/profile/decks",["require","text!tpl/profile/decks.html","views/title"],function(e){var t=e("text!tpl/profile/decks.html"),n=Backbone.Collection.extend({model:App.Models.Deck,initialize:function(e){this.url="/api/users/"+e+"/decks"}}),r=Backbone.Collection.extend({model:App.Models.Thing,url:"/api/things"}),i=e("views/title");return Backbone.View.extend({id:"decks-list",template:_.template(t),events:{"click .delete-deck":"deleteDeck"},initialize:function(){this.options.userId=this.options.userId||this.options[0],App.on("Deck:Removed",this.removeDeck,this)},deleteDeck:function(e){e.preventDefault(),console.log(e);var t=$(e.target).parents(".item.deck"),n=t.data("id"),r=new App.Models.Deck({id:n,_id:n});r.destroy({url:r.url+"/"+n,wait:!0,success:function(e,t){console.log("Delete Success"),console.log(e),console.log(t),alert("Replace me with a nicer popup\n"+t.msg),App.trigger("Deck:Removed",t.data)},error:function(e,t){console.log("Delete Error"),console.log(e),console.log(t),alert("Replace me with a nicer popup\n"+t.responseText)}})},render:function(){function t(){e._isMyProfile=!1;var t="User's collections";e._isMyProfile=App.currentUser&&App.currentUser.get("_id")==e.options.userId,e._isMyProfile&&(t="Your Collections");var n=new i({title:t,subtitle:"/profile/"});n.render(),$(e.el).html(e.template({things:e.things,decks:e.decks,isMyProfile:e._isMyProfile})).prepend(n.el);var r=new App.Models.User({_id:e.options.userId});App.view("profile",{el:$(".profile-container",e.el),user:r}),r.fetch({success:function(e){App.trigger("meta:change",{title:e.get("firstName")+" "+e.get("lastName"),description:e.get("firstName")+" "+e.get("lastName")+"'s profile on Thingle"})}})}var e=this;e.getDecks(function(n,r){e.decks=n,e.things=r,t()}),typeof App.currentUser.get("_id")=="undefined"&&App.currentUser.checkAuth(t)},_applyCurrentUser:function(){},removeDeck:function(e){console.log("profile/decks.removeDeck"),console.log(e);var t=this.$el.find('.item.deck[data-id="'+e.deck.id+'"]'),n=$(".stats-collections");t.fadeOut(),n.text(parseInt(n.text(),10)-1||1)},getDecks:function(e){var t=this,i=new n(t.options.userId),s=[],o=new r;i.fetch({success:function(t){console.log(t);if(t.length==0){typeof e=="function"&&e(t,o);return}_.each(t.models,function(e){e.thing_ids=e.get("things").slice(-4).reverse(),s=_.union(s,e.thing_ids)}),o.fetch({data:{ids:s.join(",")},success:function(n){typeof e=="function"&&e(t,n)}})}})}})}),define("views/profile/best_things",["require","views/things/things-list"],function(e){var t=e("views/things/things-list");return Backbone.View.extend({auth:!0,id:"best-things",title:"Your most popular thingles:",category:"filter by",initialize:function(){this.options.userId=this.options.userId||this.options[0],this._thingsView=new t({el:this.el,url:"/api/users/"+this.options.userId+"/things/?order=likes",showDeleteButton:!0})},render:function(){this._thingsView.render()},undelegateEvents:function(){return typeof this._thingsView.undelegateEvents=="function"&&this._thingsView.undelegateEvents(),this},delegateEvents:function(){return typeof this._thingsView.delegateEvents=="function"&&this._thingsView.delegateEvents(),this}})}),define("views/profile/friends_things",["require","views/things/things-list"],function(e){var t=e("views/things/things-list");return Backbone.View.extend({auth:!0,id:"friends-things",title:"All your friends",category:"filter by",initialize:function(){this._thingsView=new t({el:this.el,url:"/api/profile/friends/things",showDeleteButton:!0})},render:function(){this._thingsView.render()},undelegateEvents:function(){return typeof this._thingsView.undelegateEvents=="function"&&this._thingsView.undelegateEvents(),this},delegateEvents:function(){return typeof this._thingsView.delegateEvents=="function"&&this._thingsView.delegateEvents(),this}})}),define("views/followings/things",["require","views/things/things-list"],function(e){var t=e("views/things/things-list");return Backbone.View.extend({auth:!0,title:"People you follow",category:"filter by",render:function(){var e=this;App.currentUser.checkAuth(function(){e._thingsView=new t({el:e.el,url:"/api/users/"+App.currentUser.get("_id")+"/followings/things",showDeleteButton:!0}),e._thingsView.render()})},undelegateEvents:function(){return this._thingsView&&typeof this._thingsView.undelegateEvents=="function"&&this._thingsView.undelegateEvents(),this},delegateEvents:function(){return this._thingsView&&typeof this._thingsView.delegateEvents=="function"&&this._thingsView.delegateEvents(),this}})}),function(){function e(e){var t=Backbone.history.getHash(),n=t.split("/");n.length==1&&(t+="/index");var r="text!tpl/statics/"+n[0]+".html",i="text!tpl/statics/"+t+".html";require([r,i],e)}define("views/static",["helpers/html"],function(t){return Backbone.View.extend({id:"static",render:function(){var n=this,r=Backbone.history.getHash()[0];e(function(e,i){r!=n.basePage&&(n.baseTpl=_.template(e),$(n.el).html(n.baseTpl()),n.basePage=r),n.contentTpl=_.template(i);var s=n.$(".static-content").html(n.contentTpl()).find("a#bookmarklet-button");t.addBookmarklet(s),n.$('.static-leftside a[href="#!'+Backbone.history.getHash()+'"]').parents("li").addClass("active")})}})})}(),define("text!tpl/mingle/mingle.html",[],function(){return'<!-- Nasty inline style for prototyping only -->\n<!--<style>\n\n</style>\n-->\n<!--<div id="fb-root"></div>-->\n  <div class="mingle-page static-page">\n      <h1>Mingle on Thingle</h1>\n      <aside class="static-leftside">\n          <nav>\n              <ul id="mingle-nav" class="nav nav-list">\n              <!-- This is meant to be generated from capabilities indicated by\n                  the Mingle object -->\n                  <!--<li><a href="#mingle/thingle/index">Thingle</a></li>-->\n                  <li><a href="#mingle/facebook/invite">Facebook</a></li>\n              </ul>\n          </nav>\n      </aside>\n\n      <section class="page-content static-content">\n          <h2>Meet and Greet - Discover and Share.</h2>\n          Thingle, a place to create, discover, organize and and share your favorite things.\n      </section>\n\n  </div>\n\n'}),define("views/mingle/mingle-root",["require","text!tpl/mingle/mingle.html","views/title"],function(e){var t=e("text!tpl/mingle/mingle.html"),n=new(e("views/title"));return Backbone.View.extend({auth:!0,template:_.template(t),renderQ:[],viewStack:[],title_txt:"Mingle on Thingle",currentSubPath:null,events:{"click nav a":"_navigate"},initialize:function(e){var t=this;console.log(e),e&&e.path&&t.renderQ.push(e)},undelegateEvents:function(){return this.invokeViews("undelegateEvents")},delegateEvents:function(){return this.invokeViews("delegateEvents")},destroy:function(){return this.invokeViews("destroy")},invokeViews:function(e,t){return _.each(this.viewStack,function(n){n&&_.isFunction(n[e])&&n[e](t)}),this},render:function(){var e=this,t;this.$el.append(this.template()),App.currentView=e,n.render(e.title_txt);while(t=e.renderQ.shift())e.currentSubPath=e._renderSubPath(t);return this},_renderSubPath:function(e){if(!e||!e.path)return!1;var t=this;return console.log("Render subPath"),console.log(e),e.el=e.el||t.$el.find(".page-content"),e.parentView=t,App.view(e.path,e)},_navigate:function(e){var t=$("#content"),n=$("#mingle-nav"),r=$(e.target).prop("hash").replace("#","");console.log(e),n.find("li").removeClass("active"),$(e.target).parent().addClass("active"),this._renderSubPath({path:r,el:this.$el.find(".page-content")})},highlight:function(e){e.css("background-color","#63A2D5"),e.animate({opacity:0},1e3,function(){e.removeAttr("style")})}})}),!function(e){function r(){i(e(t)).removeClass("open")}function i(t){var n=t.attr("data-target"),r;return n||(n=t.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),r=e(n),r.length||(r=t.parent()),r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;return s=i(n),o=s.hasClass("open"),r(),o||(s.toggleClass("open"),n.focus()),!1},keydown:function(t){var n,r,s,o,u,a;if(!/(38|40|27)/.test(t.keyCode))return;n=e(this),t.preventDefault(),t.stopPropagation();if(n.is(".disabled, :disabled"))return;o=i(n),u=o.hasClass("open");if(!u||u&&t.keyCode==27)return n.click();r=e("[role=menu] li:not(.divider) a",o);if(!r.length)return;a=r.index(r.filter(":focus")),t.keyCode==38&&a>0&&a--,t.keyCode==40&&a<r.length-1&&a++,~a||(a=0),r.eq(a).focus()}},e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.dropdown.Constructor=n,e(function(){e("html").on("click.dropdown.data-api touchstart.dropdown.data-api",r),e("body").on("click.dropdown touchstart.dropdown.data-api",".dropdown",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)})}(window.jQuery),define("lib/bootstrap/bootstrap-dropdown",function(){}),define("text!tpl/mingle/fb_friends.html",[],function(){return'<style>\n\n</style>\n<section class="page-content static-content">\n    <h2>Invite, Follow and Mingle.\n        <input placeholder="Oh! and Filter" autofocus=true class="typefilter" data-src_sel="ul.list li.user .username"/>\n\n       <span class="btn-group act_on_selected hide">\n          <button class="btn send_invites ">Send Invites!</button>\n          <button class="btn dropdown-toggle" data-toggle="dropdown">\n              <span class="caret"></span>\n          </button>\n          <ul class="dropdown-menu">\n              <li><a href="#" class="send_invites_and_message">+Personal message</a></li>\n          </ul>\n        </span>\n    </h2>\n\n    <div class="scroll-pane friends">\n        <ul class="friends list">\n\n        </ul>\n    </div>\n</section>\n\n\n'}),define("text!tpl/mingle/user_item.html",[],function(){return'<li class="user" <%= user._id ? "data-u_id=\'" + user._id + "\'" :"" %> data-fbid="<%= user.fbid %>">\n    <a href="<%= user._id ? "#!users/" + user._id : "javascript:void(0);" %>" class="link-profile <%= user._id ? "invited" : \'\' %>">\n        <span class="img avatar" style="background-image:url(<%= user.pic_square%>)"></span>\n        <span class="username"><%= user.name %></span>\n    </a>\n    <span href="#" class="btn <%= deco[user.state].btnClass %>">\n        <%= deco[user.state].btnTxt %>\n    </span>\n</li>'}),define("views/mingle/facebook/invite",["require","lib/jquery.mousewheel","lib/bootstrap/bootstrap-dropdown","text!tpl/mingle/fb_friends.html","text!tpl/mingle/user_item.html","views/title"],function(e){e("lib/jquery.mousewheel"),e("lib/bootstrap/bootstrap-dropdown");var t=e("text!tpl/mingle/fb_friends.html"),n=e("text!tpl/mingle/user_item.html"),r=new(e("views/title")),i=window.location.protocol+"//"+(window.location.host.match("localhost")?"thingle.com":window.location.host);return Backbone.View.extend({template:_.template(t),user_tmpl:_.template(n),inviteCfg:{description:_.template('<%= u.get("firstName") %> invited you to Thingle, a place to create, discover, organize and share your favorite things.'),link:_.template(i),name:"Thingle - Be Passionate.",picture:i+"/images/thingle-fb-icon_3.png"},listDeco:{app_user:{btnClass:" btn-primary not_followed",btnTxt:"Follow!"},following:{btnClass:"btn-primary followed",btnTxt:"Unfollow"},not_user:{btnClass:" btn-primary invite ",btnTxt:"Add to invite list"},inviting:{btnClass:"btn-primary uninvite",btnTxt:"Remove from invite list"},invited:{btnClass:"btn-primary noop",btnTxt:"Invite Sent!"}},invite_title:"Invite Friends",already_invited:[],appUsers:[],fbInvite_method:"apprequest",events:{"click li.user .invite":"invite","click li.user .uninvite":"uninvite","click li.user[data-u_id] .not_followed":"follow","click li.user[data-u_id] .followed":"unfollow","click .send_invites":"send_fb_invites","click .send_invites_and_message":"send_fb_invites_and_message","click .btn.alert-sucess":"close_success_alert","keyup .typefilter":"responsiveFilter"},initialize:function(){this.parentView=this.options.parentView,this.parentView.viewStack.push(this)},delegateEvents:function(){var e=this;Backbone.View.prototype.delegateEvents.apply(this,arguments),$(window).bind("resize.userList",function(){e._reinitScrollPanels()})},undelegateEvents:function(){return Backbone.View.prototype.undelegateEvents.apply(this,arguments),$(window).unbind("resize.main"),this},_reinitScrollPanels:function(){var e=$(window).height(),t=20,n=e-t;this.$el.find(".scroll-pane").each(function(){var e=$(this),t=e.data("jsp");e.height(n-e.offset().top),t?t.reinitialise():e.jScrollPane()})},render:function(){var e=this;App.inviteView=e,r.render(e.invite_title),$(e.el).html(e.template()),$.get("/api/users/"+App.currentUser.get("_id")+"/followings",function(t){e.appUsers=e.appUsers.concat(t);var n=_.map(e.appUsers,function(e){return""+e.fbId});e.fbGetUsers(n)})},render_users:function(e){var t=this,n=_.map(_.sortBy(e,function(e){return e.name}),function(e){return t.user_tmpl({deco:t.listDeco,user:e})});$(t.el).find("ul.friends.list").html(n.join("")),t._reinitScrollPanels(),_.each(t.already_invited,function(e){$(".friends.list li[data-fbid="+e+"]").find(".btn").text("Sent!").addClass("btn-info")})},massageUsers:function(e){var t=this,n=App.currentUser.get("followings"),r=_.pluck(e,"uid");$.ajax({url:"/api/profile/friends",data:{fbids:r},success:function(e){t.appUsers=e.concat(t.appUsers)},complete:function(){_.each(e,function(e){e.fbid=e.uid,e.state=e.is_app_user?"app_user":"not_user",_.extend(e,_.find(t.appUsers,function(t){if(t.fbId==e.fbid)return e.state=n.indexOf(t._id)!=-1?"following":"app_user",!0}))}),t.users=e,t.render_users(e)}})},getUserFromDom:function(e){var t=$(e),n=this,r={fbid:t.data("fbid"),_id:t.data("u_id")||null},i=_.find(n.users,function(e){return r.fbid==e.fbid||r._id&&r._id==e._id});return i},renderUserEl:function(e){var t=this,n=t.user_tmpl({deco:t.listDeco,user:e});return n},navToProfile:function(e){var t=$(e.target).parents("li"),n=this,r=this.getUserFromDom(t);App.router.navigate("users/"+r._id,{trigger:!0})},invite:function(e){var t=$(e.target).parents("li"),n=this,r=n.getUserFromDom(t),i=$(".act_on_selected");r.state="inviting",t.replaceWith(n.renderUserEl(r)),i.removeClass("hide")},uninvite:function(e){var t=$(e.target).parents("li"),n=this,r=n.getUserFromDom(t),i=$(".act_on_selected");r.state="not_user",t.replaceWith(n.renderUserEl(r)),t.parents("ul").find("li.user .remove_invite").size()||i.addClass("hide")},follow:function(e){var t=$(e.target).parents("li"),n=this,r=n.getUserFromDom(t),i=new App.Models.User({_id:r._id});i.follow(function(){r.state="following",t.replaceWith(n.renderUserEl(r))})},unfollow:function(e){var t=$(e.target).parents("li"),n=this,r=n.getUserFromDom(t),i=new App.Models.User({_id:r._id});i.unfollow(function(){r.state="app_user",t.replaceWith(n.renderUserEl(r))})},invite_success:function(e){var t=this,n,r,i=$(".act_on_selected").addClass("hide"),s=$('<span onclick="$(this).remove();" class="btn alert-success">Invitations Sent!</span>');i.after(s),s.fadeOut(4e3,function(){}),$("li.user .uninvite").each(function(e,i){n=$(i).parents("li"),r=t.getUserFromDom(n),r.state="invited",n.replaceWith(t.renderUserEl(r))})},fbGetUsers:function(e){console.log(e);var t=this,n=encodeURIComponent("/fql&q=SELECT uid, name, is_app_user, pic_square FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me())");e&&e.length&&(n+=encodeURIComponent(" OR uid IN ("+e.join(",")+") ")),t.fb_helper(function(){FB.api(n,{access_token:FB.getAccessToken()},function(e){t.massageUsers(e.data)})})},send_fb_invites_and_message:function(e){return this.send_fb_invites(e,!0),!1},send_fb_invites:function(e,t){var n=this,r=_.map($(".list > li.user .uninvite"),function(e){return $(e).parents("li.user").attr("data-fbid")});n["send_fb_invites_via_"+n.fbInvite_method](r,t)},send_fb_invites_via_apprequest:function(e,t){var n=this;FB.ui(_.defaults({method:"apprequests",access_token:FB.getAccessToken(),to:e.join(","),message:n.inviteCfg.description({u:App.currentUser}),data:JSON.stringify({type:"invite",from:App.currentUser.get("_id")})},{}),function(r){console.log(r);if(r.success||r.request)n.invite_success(),t&&n.send_fb_invites_via_message(e);r.request&&$.ajax({type:"POST",url:"/api/users/"+App.currentUser.get("_id")+"/fbinvites",data:{fbResp:r},dataType:"json",success:function(e){console.log("Invitations saved"),console.log(e)}})})},send_fb_invites_via_message:function(e){var t=this;FB.ui(_.defaults({method:"send",access_token:FB.getAccessToken(),to:e.join(","),link:t.inviteCfg.link({u:App.currentUser})},t.inviteCfg),function(e){console.log(e),e.success&&(console.log("Message Sent"),t.invite_success()),e.request&&$.ajax({type:"POST",url:"/api/users/"+App.currentUser.get("_id")+"/fbinvites",data:{fbResp:e},dataType:"json",success:function(e){console.log("Invitations saved"),console.log(e)}})})},fbUI_invite:function(){var e=this,t=function(){FB.ui({method:"apprequests",message:e.inviteCfg.description({u:App.currentUser}),title:e.inviteCfg.name},function(e){console.log(e)})}},fb_helper:function(e){typeof FB=="undefined"?App.on("fb-loaded",function(){console.log("triggered on fb-loaded"),App.on("fb-authed",function(){console.log("triggered on fb-authed"),e()})}):e()},responsiveFilter:function(e){var t=$(e.target),n=t.val().toLowerCase(),r=$(t.data("src_sel"));r.each(function(){var e=$(this),t=e.parents("li.user");e.text().toLowerCase().match(n)?t.removeClass("hide"):t.addClass("hide")}),this._reinitScrollPanels()},highlight:function(e){e.css("background-color","#63A2D5"),e.animate({opacity:0},1e3,function(){e.removeAttr("style")})},close_success_alert:function(e){$(e.target).remove()}})}),define("text!tpl/popups/addnew.html",[],function(){return'<div class="modal-inner">\n    <div class="modal-header">\n        <button class="close" data-dismiss="modal"></button>\n        <h3>Create</h3>\n    </div>\n    <div class="modal-body">\n        <aside class="new-thing"><a href="#popup-thingles/new-popup-1" data-toggle="modal" data-dismiss="modal">Create a Thingle</a></aside>\n        <aside class="new-deck"><a href="#popup-decks-new" data-toggle="modal" data-dismiss="modal">Create a Collection</a></aside>\n    </div>\n    <div class="modal-footer">\n        <a href="#!about/bookmarklet-tutorial" class="grab-area">Grab things from anywhere on the web with the +thingle tool!</a>\n    </div>\n</div>'}),define("views/popups/addnew",["require","text!tpl/popups/addnew.html"],function(e){var t=e("text!tpl/popups/addnew.html");return Backbone.View.extend({auth:!0,template:_.template(t),events:{},initialize:function(){},render:function(){$(this.el).html(this.template({}))}})}),define("text!tpl/popups/decks-new.html",[],function(){return'<div class="modal-inner">\n    <div class="modal-header">\n        <button class="close" data-dismiss="modal"></button>\n        <h3>Create a Collection</h3>\n    </div>\n    <form id="create-deck-form" class="form-horizontal">\n        <div class="modal-body">\n            <fieldset>\n                <div class="control-group">\n                    <label class="control-label">Collection Name</label>\n\n                    <div class="controls">\n                        <input type="text" class="span5" name="name"/>\n                    </div>\n                </div>\n\n                <div class="control-group">\n                    <label class="control-label">Tags (coma separated values)</label>\n\n                    <div class="controls">\n                        <input type="text" class="span5" name="tags"/>\n                    </div>\n                </div>\n\n                <div class="control-group">\n                    <label class="control-label">Collection Category</label>\n\n                    <div class="controls">\n                        <select name="category">\n                            <option value="" selected="selected">Select a Category</option>\n                            <% _.each(categories, function(category) { %>\n                                <option value="<%= category.get(\'_id\') %>" data-name="<%= category.get(\'name\') %>"><%= category.get(\'name\') %></option>\n                            <% }); %>\n                        </select>\n                    </div>\n                </div>\n            </fieldset>\n        </div>\n        <div class="modal-footer">\n            <button type="submit" class="btn btn-primary">Create Collection</button>\n        </div>\n    </form>\n</div>'}),define("views/popups/decks-new",["require","text!tpl/popups/decks-new.html","helpers/select"],function(e){var t=App.Models.Deck,n=App.Models.Category,r=Backbone.Collection.extend({model:n,url:"/api/categories"}),i=e("text!tpl/popups/decks-new.html"),s=e("helpers/select");return Backbone.View.extend({auth:!0,events:{"submit form#create-deck-form":"_onFormSubmit"},template:_.template(i),initialize:function(){var e=this;this.categories=new r,$(this.el).on("hidden",function(){e._resetForm()})},_onFormSubmit:function(e){var t=$("input[name='name']",$(e.target)).val();category_id=$("select[name='category'] option:selected",$(e.target)).val(),category=$("select[name='category'] option:selected",$(e.target)).data("name"),tags=category+","+$("input[name=tags]",$(e.target)).val(),tags=tags.replace(/(^[\s,]*|[\s,]*$)/g,"").replace(/(\s*,\s*)+/g,",").split(",");var n=[];return t||n.push("Name can't be blank"),category_id||n.push("Category can't be blank"),n.length>0?alert(n.join("\n")):this._saveDeck({name:t,tags:tags,category:category_id}),!1},_saveDeck:function(e){var n=this,r=e.category;delete e.category;var i=new t;i.set(e),i.save({},{success:function(e,t){$(n.el).modal("hide"),$(n.el).trigger("deckCreationComplete",[e]),App.trigger("deckCreated",{deck_id:e.get("_id")})}})},_resetForm:function(){$("form#create-deck-form",$(this.el))[0].reset()},render:function(){var e=this;this.categories.fetch({success:function(t){$(e.el).html(e.template({categories:t.models})),s.customize(e.el),e.options.deckName&&e.$("input[name=name]").val(e.options.deckName)}})}})}),define("text!tpl/popups/login.html",[],function(){return'<div class="modal-inner">\n    <div class="modal-header">\n        <h3>Log In</h3>\n    </div>\n    <div class="modal-body">\n        <a href="javascript:void(0)" class="but-facebook fb-login"></a>\n    </div>\n</div>'}),define("views/popups/login",["require","text!tpl/popups/login.html"],function(e){var t=e("text!tpl/popups/login.html");return Backbone.View.extend({template:_.template(t),events:{"click .fb-login":"fb_login"},initialize:function(){var e=this;App.on("auth auth-failed",function(){$(e.el).modal("hide")})},render:function(){$(this.el).removeClass("thingle-modal").html(this.template({}))},fb_login:function(){App.trigger("fb-login")}})}),define("text!tpl/popups/repost.html",[],function(){return'<div class="modal-inner">\n    <div class="modal-inner">\n        <div class="modal-header">\n            <button class="close" data-dismiss="modal"></button>\n            <h3>Add To Collection</h3>\n        </div>\n        <div class="modal-body">\n            <div class="modal-top">\n                <div class="modal-top-inner">\n                    <div class="img">\n                        <img src="<%= thing.getCoverPicture(\'small\').url %>" alt=""/>\n                    </div>\n                    <div class="info">\n                        <div class="control-group">\n                            <select name="deck">\n                                <% _.each(decks, function(deck) { %>\n                                <option value="<%= deck.get(\'_id\') %>"><%= deck.get("name") %></option>\n                                <% }); %>\n                            </select>\n                        </div>\n                        <div class="control-group">\n                            <label for="post-facebook" class="checkbox inline">\n                            	<input name="share" type="checkbox" id="post-facebook" checked="checked"/>Post to Facebook\n							</label>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <button id="repost-button" type="submit" class="btn btn-primary">Collect</button>\n        </div>\n    </div>\n</div>'}),define("views/popups/repost",["require","text!tpl/popups/repost.html","helpers/select"],function(e){var t=e("text!tpl/popups/repost.html"),n=App.Models.Thing,r=e("helpers/select");return Backbone.View.extend({auth:!0,events:{"click #repost-button":"_onFormSubmit"},template:_.template(t),render:function(){var e=this;this._thing_id=this.options.thingId,this._loadThing(function(t){e._loadDecks(function(n){e._renderPopupAndShow(t,n)})})},_loadThing:function(e){var t=this,r=new n;r.fetch({url:"/api/things/"+this._thing_id,success:function(n){t._thing=n,e(n)}})},_loadDecks:function(e){var t=Backbone.Collection.extend({model:App.Models.Deck,url:"/api/users/"+App.currentUser.get("_id")+"/decks"}),n=new t;n.fetch({success:function(t){e(t.models)}})},_renderPopupAndShow:function(e,t){var n=this.template({thing:e,decks:t});$(this.el).html(n),r.customize(this.el),$(this.el).modal("show")},_onFormSubmit:function(){var e=this,t=$('select[name="deck"]',$(this.el)).val(),n=e.$("[name=share]").attr("checked")?!0:!1;$.ajax({type:"POST",url:"/api/decks/"+t+"/things",data:{thingId:this._thing.get("_id"),share:n},dataType:"json",success:function(){App.trigger("afterRepost",{collection_id:t,thingle_id:e._thing.get("_id")})}}),$(this.el).modal("hide"),$("#post-facebook",$(this.el)).attr("checked")&&this._postToFaceBook(),App.popup("success",{thing:this._thing,title:"Congrats! Thingle is reposted"}),typeof this.options.onSubmit=="function"&&this.options.onSubmit()},_postToFaceBook:function(){console.log("TODO: - Post to Facebook")}})}),define("text!tpl/popups/success.html",[],function(){return'<div class="modal-inner">\n    <div class="modal-header">\n        <button class="close" data-dismiss="modal"></button>\n        <h3><%= title %></h3>\n    </div>\n    <div class="modal-body">\n        <div class="modal-top">\n            <div class="modal-top-inner">\n                <div class="img-outer">\n                    <div class="img"><img src="<%= src || thing.getCoverPicture(\'small\').url %>" alt=""></div>\n                </div>\n                <div class="info">\n                    <div class="success">\n                        <strong>Success!</strong>\n                        <div class="btns">\n                            <a href="#!things/<%= thing.get(\'_id\') %>" id="thingle-link" class="btn btn-primary inner-link">Take me to it now</a>\n                            <a href="javascript:void(0)" class="btn btn-primary" data-dismiss="modal">Close and return</a>\n                        </div>\n                        <div class="more"><a href="javascript:void(0)" id="add-more-link">add more photos to this thingle</a></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="modal-footer">\n        <a href="#!about/bookmarklet-tutorial" class="grab-area inner-link">Grab things from anywhere on the web with the +thingle tool!</a>\n    </div>\n</div>'}),define("views/popups/success",["require","text!tpl/popups/success.html"],function(e){var t=e("text!tpl/popups/success.html");return Backbone.View.extend({template:_.template(t),events:{"click a.inner-link":"_forwardToLink","click #add-more-link":"_addMore"},initialize:function(){if(typeof this.options.beforeHide=="function"){var e=this;$(this.el).on("hide",function(){return e.options.beforeHide(),!0})}typeof this.options.afterHide=="function"&&$(this.el).on("hide",this.options.afterHide)},render:function(){var e=this.template({thing:this.options.thing,src:this.options.src,title:this.options.title||"Congrats! Your Thingle is live"});$(this.el).html(e)},_forwardToLink:function(e){typeof this.options.onForward=="function"&&typeof this.options.onForward($(e.target).attr("href")),$(this.el).modal("hide")},_addMore:function(){$(this.el).modal("hide"),App.popup("thingles/new-popup-2",{thingle:this.options.thing})}})}),define("text!tpl/popups/welcome.html",[],function(){return'<div class="modal-inner">\n    <script type="text/javascript" src="http://www.youtube.com/iframe_api.js"></script>\n    <div class="modal-body">\n        <div class="logo beta">Thingle</div>\n        <h1>Welcome to Thingle beta!</h1>\n        <p>Thingle lets you create, collect organize and share the things you <br>are passionate about. This is a beta version. We have a ton of new <br>features in the pipeline. Stay curious!</p>\n        <div class="video">\n            <iframe id="player" width="570" height="321" src="http://www.youtube.com/embed/B8-MSlHXxpE?rel=0&amp;autoplay=1" frameborder="0" allowfullscreen></iframe>\n        </div>\n        <div class="col">\n            <p>You can discover what people are  passionate about right now, by browsing without log in.</p>\n            <a href="javascript:void(0)" class="btn btn-success">Just browse.</a>\n        </div>\n        <div class="col">\n            <p>To become part of this exciting community and start creating your own Thingles you can log in here.</p>\n            <a href="#popup-login" class="btn btn-success" data-toggle="modal">Sign me up!</a>\n        </div>\n        <div class="description">By clicking the button above and entering the Site you agree to our <a href="#!legal/terms">Terms &amp; Conditions</a> and our <a href="#!legal/privacy">Privacy Policy</a>.</div>\n    </div>\n</div>'}),define("views/popups/welcome",["require","text!tpl/popups/welcome.html"],function(e){var t=e("text!tpl/popups/welcome.html");return Backbone.View.extend({template:_.template(t),events:{"click a":"_closePopup"},initialize:function(){var e=this;$(".modal-backdrop").live("click",function(){e._closePopup()})},render:function(){$(this.el).html(this.template({}))},_closePopup:function(){$(this.el).modal("hide"),$(this.el).remove()}})}),define("text!tpl/popups/thingles/drag-image.html",[],function(){return'<div class="modal-inner">\n    <div class="modal-header">\n        <button class="close" data-dismiss="modal"></button>\n        <h3>Uploading image...</h3>\n    </div>\n    <div class="modal-body">\n        <p>Please wait...</p>\n        <p><img width="100" src="<%= url %>"/></p>\n    </div>\n</div>'}),function(e,t){function a(e,t){e.style.width=t.width,e.style.height=t.height}function f(e,t){e.style.left=t.left,e.style.top=t.top}function l(e){var t=e.make({style:{type:"text/css"}}),n=o.join("\n").replace(/\.##/g,".a"+i);return t.styleSheet?t.styleSheet.cssText=n:t.appendChild(e.makeText(n)),t}function c(e){return"a"+i+e}function h(e){typeof XMLHttpRequest=="undefined"&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")});var t=new XMLHttpRequest;e.method=e.method||"GET",t.open(e.method,e.url),typeof e.contentType!="undefined"&&t.setRequestHeader("Content-Type",e.contentType),t.onreadystatechange=function(){switch(this.readyState){case 4:this.status==200&&e.success?e.success(this.responseText):this.status!=200&&e.error&&e.error(this.status,this.statusText)}};if(e.method=="GET")t.send(null);else{var n=JSON.stringify(e.data);t.send(n)}}function p(e){var t=this;t.elements={d:e.document,b:e.document.body,h:e.document.getElementsByTagName("HEAD")[0],w:e},t.support={isIe:e.navigator.userAgent.indexOf("MSIE ")>0},t.make=function(e){var n=new Array;for(var r in e){var i=e[r],s=t.elements.d.createElement(r);for(var o in i){var u=i[o];o=="class"&&t.support.isIe&&(o="className");if(o=="class"||o=="className")u=c(u);s.setAttribute(o,u)}n.push(s)}return n.length==1?n[0]:n},t.makeText=function(e){return t.elements.d.createTextNode(e)},t.attach=function(e,t){return t.appendChild(e),t},t.attachBody=function(e){return t.attach(e,t.elements.b)},t.attachHead=function(e){return t.attach(e,t.elements.h||t.elements.b)},t.detach=function(e,t){return t.removeChild(e),t},t.detachBody=function(e){return t.detach(e,t.elements.b)}}function d(){var e=this;e.visible=!1,e.builder=new p(window)}function v(e,t,n,r){var i=this;i.base.constructor.call(this,t),i.images=e,i.onSubmit=n;var o=i.getWindowSize(t);i.maskDiv=i.builder.make({div:{"class":"overlay-mask"}}),i.maskDiv.style.width=o.width,i.maskDiv.style.height=o.height,i.builder.attachBody(i.maskDiv);var u=o.width/1.5,a=o.height/1.5;i.formDiv=i.builder.make({div:{"class":"overlay-form"}}),i.builder.attachBody(i.formDiv);var f=i.builder.make({a:{href:"javascript:void(0);"}});f.onclick=function(){i.close(),r(i)},i.titleContainer=i.builder.make({span:{}}),i.headerContainer=i.builder.make({div:{"class":"header"}}),i.headerContainer.appendChild(i.titleContainer),i.headerContainer.appendChild(f),i.formDiv.appendChild(i.headerContainer),i.submitButton=i.builder.make({button:{"class":"btn"}}),i.submitButton.style.visibility="hidden";var l=i.builder.makeText("Submit");i.submitButton.appendChild(l),i.submitButton.onclick=function(){var e=new Array,t=i.selectionDiv.childNodes;for(var r=0;r<t.length;r++)t[r]instanceof HTMLDivElement&&t[r].__ref&&e.push(t[r].__ref);n(e)},i.selectionDiv=i.builder.make({div:{"class":"overlay-selection"}}),i.selectionDiv.appendChild(i.submitButton),i.formDiv.appendChild(i.selectionDiv),i.contentDiv=i.builder.make({div:{"class":"overlay-content"}}),i.formDiv.appendChild(i.contentDiv),i.onImageDeselected=function(e){var t=this;i.selectionDiv.removeChild(t),t.__ref.style.display="inline",i.selectionDiv.childNodes.length<2&&(i.submitButton.style.visibility="hidden")},i.onImageSelected=function(e){var t=this,n=i.cropImage(t,s.selectionBoxSize);i.selectionDiv.appendChild(n),n.__ref=t,n.onclick=i.onImageDeselected,t.style.display="none",i.submitButton.style.visibility="visible"};for(var c=0;c<i.images.length;c++){var h=i.images[c],p=i.builder.make({img:{src:h.src}});i.contentDiv.appendChild(p),p.onclick=i.onImageSelected}i.cropImage=function(e,t){var n=e.width/e.height,r=n>1?Math.round(t*n):t,s=n>1&&Math.round((t-r)/2),o=n<1?Math.round(t/n):t,u=n<1&&Math.round((t-o)/2),a=i.builder.make({img:{src:e.src,width:r+"px",height:o+"px",style:u&&"margin-top: "+u+"px"||s&&"margin-left: "+s+"px"}}),f=i.builder.make({div:{"class":"crop"}});return f.appendChild(a),f},i.show=function(){var e=this;e.maskDiv.style.display="block",e.formDiv.style.display="block",e.base.show.call(e)},i.close=function(){var e=this;e.maskDiv.style.display="none",e.formDiv.style.display="none",e.base.close.call(e)},i.destroy=function(){var e=this;e.builder.detachBody(e.maskDiv),e.builder.detachBody(e.formDiv)},i.setTitle=function(e){var t=this;t.empty(t.titleContainer);var n=t.builder.makeText(e);t.titleContainer.appendChild(n)}}function m(){function o(){var e=new Array,n=t.getElementsByTagName("img");for(var r=0;r<n.length;r++){var i=n[r];if(!/^data:image/.test(i.src)){var s=null;if(i.parentNode.tagName=="A"&&/\.(jpg|jpeg|gif|png|bmp)/i.test(i.parentNode.href)){var o=i.parentNode.href,u=new Image;u.src=o,s=a(u)}!s&&a(i)&&(s=a(i)),s&&e.push(s)}}return e}function a(e){if(e.width>=s.minWidth&&e.height>=s.minHeight)return e}var e=this;e.modal=null,e.builder=new p(window);var i=l(e.builder);e.builder.attachHead(i),e.callback=function(e,i){var s=t.location.protocol+"//"+Thingle.host+n+r;s+="?source="+encodeURIComponent(i);for(var o=0;o<e.length;o++)s+="&image="+encodeURIComponent(e[o]);window.open(s,"PIN","menubar=yes,resizable=yes,scrollbars=yes,status=yes,width=700,height=570")},Thingle.callback&&(e.callback=Thingle.callback),e.onImageSelected=function(n){e.modal.destroy(),e.modal=null;var r=new Array;for(var i=0;i<n.length;i++)r.push(n[i].getAttribute("src"));var s=t.location.href;e.callback(r,s)},e.onClose=function(){e.modal.destroy(),e.modal=null},e.run=function(){var t=o();t.length?(e.modal=new v(t,window,e.onImageSelected,e.onClose),e.modal.setTitle(u.selectorTitle),e.modal.show()):alert(u.imagesNotFound)}}var n="/bookmarklet.html",r="#bookmarklet",i=Math.floor(Math.random()*1e8+1),s={minWidth:220,minHeight:100,selectionBoxSize:70},o=[".##overlay { position: absolute; background-color: #ffffff; z-index: 9999;}",".##overlay-mask { position: fixed; background-color: #ffffff; z-index: 9999; left: 0px; top: 0px; display: none; opacity: 0.9; filter: alpha(opacity=90);  width: 100%;height: 100%;}",".##overlay-form {position: fixed;top: 40%;left: 50%;z-index: 10000;overflow: auto;width: 560px;margin: -250px 0 0 -280px;background-color: white;-webkit-box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);-moz-box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);-webkit-background-clip: padding-box;-moz-background-clip: padding-box;background-clip: padding-box;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;-ms-box-sizing: border-box;box-sizing: border-box;}",".##header { padding: 9px 22px;background: #63A2D5;border-style: solid;border-width: 1px;border-color: #3178B2 #3178B2 #2D597C #3178B2;color: white;font-family:arial,sans-serif;font-size: 20px;font-weight: normal;line-height: 34px; text-align: left !important;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;-ms-box-sizing: border-box;box-sizing: border-box;}",".##header a { width: 15px;height: 15px;margin: 10px -1px 0 0;padding: 0;cursor: pointer;float: right;background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFpJREFUeNpi+P///3sgTgBiBhIwSP17GOM/CQbA1WMIEKsRxMcpQUgjumZ8BmAVJ8YGnC4i5Lf5+LyCL3DmIxnAQIpmsm0m289khzbZ8Ux2CqMobZOdqwACDAC0w9GbaYoUiwAAAABJRU5ErkJggg==) no-repeat 0 0;}",".##overlay-selection { position: relative;min-height: 30px;overflow: hidden;padding: 20px 140px 10px 20px;border-style: solid;border-width: 0 1px 0 1px;border-color: #7a7a7a;}",".##overlay-selection .##btn {position: absolute;right: 40px;}",".##overlay-selection .##crop { width: 70px;height: 70px; overflow: hidden;float: left;margin:0 10px 10px 0}",".##overlay-content { overflow-x: hidden;overflow-y:auto;max-height: 550px;padding: 20px 10px 10px 20px;border-style: solid;border-width: 0 1px 1px;border-color: #7a7a7a;text-align: left;}",".##overlay-content img { max-width: 504px;margin:0 10px 10px 0}",".##overlay-content img:hover { cursor: pointer; }",".##wrapper { }",".##thingle { float: left; width: "+s.minWidth+"px; height"+s.minHeight+"px; }",".##thingle-image { width: "+s.minWidth+"px; height"+s.minHeight+"px; }",".##form { margin-left: "+(parseInt(s.minWidth)+20)+"px; }",".##form-item { padding-bottom: 10px; }",".##form-item span { display: block; padding-bottom: 5px; }",".##validator { color: red; display: inline-block;}",'.##btn {min-width: 120px;background: #3F3F3F;color: white;text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);padding: 10px 27px;border-color: #141414;font: italic bold 14px Asap,"Trebuchet MS",Tahoma,Arial,FreeSans,sans-serif;border-radius: 5px;}'],u={imagesNotFound:"No suitable images were found on this page",selectorTitle:"Choose image:"};typeof JSON=="undefined"&&(JSON={stringify:function(e){}}),Thingle.document&&(t=Thingle.document),d.prototype.empty=function(e){while(e.firstChild)e.removeChild(e.firstChild)},d.prototype.getWindowSize=function(e){var t={width:0,height:0};return typeof e.innerWidth=="number"?(t.width=e.innerWidth,t.height=e.innerHeight):e.document.documentElement&&(e.document.documentElement.clientWidth||e.document.documentElement.clientHeight)?(t.width=e.document.documentElement.clientWidth,t.height=e.document.documentElement.clientHeight):e.document.body&&(e.document.body.clientWidth||e.document.body.clientHeight)&&(t.width=e.document.body.clientWidth,t.height=e.document.body.clientHeight),t},d.prototype.show=function(){var e=this;e.visible=!0},d.prototype.close=function(){var e=this;e.visible=!1},d.prototype.get=function(e,t){return t=t||window.document,t.getElementById(e)},v.prototype=new d,v.prototype.constructor=v,v.prototype.base=d.prototype;if(!e.__pinEngine){var g=new m;e.__pinEngine=g}e.__pinEngine.run()}(window,document),define("bookmarklet/snippet",function(){}),define("helpers/image",{chooseFromURL:function(e,t,n){requirejs.undef("bookmarklet/snippet"),delete window.__pinEngine;var r=$("<iframe />"),i="/proxy?url="+encodeURIComponent(e);r.attr({src:i,width:0,height:0}).appendTo("body");var s=$("<img />");s.attr({src:e}),s.load(function(){r.remove(),window.__pinEngine&&(window.__pinEngine.onClose(),delete window.__pinEngine),typeof n=="function"&&n(),t(s.attr("src"))}),r.load(function(){typeof n=="function"&&n();var i=t;t=function(){r.remove(),typeof i=="function"&&i.apply(this,arguments)};var s=this.contentWindow.document;window.Thingle={document:s,callback:t};var o=e.match(/^\w+:\/\/[^\/]+/)[0];$('img:not([src^="http:"]):not([src^="https:"]):not([src^="data:"])',s).each(function(){var e=$(this).attr("src");$(this).attr("src",o+"/"+e)}),require(["bookmarklet/snippet"])})}}),define("views/popups/thingles/drag-image",["require","text!tpl/popups/thingles/drag-image.html","helpers/html","helpers/image"],function(e){var t=e("text!tpl/popups/thingles/drag-image.html"),n=e("helpers/html"),r=e("helpers/image");return Backbone.View.extend({mimetypes:["image/png","image/jpeg","image/jpg","image/gif"],template:_.template(t),initialize:function(){var e=this;$(this.el).on("show",function(){return e.mimetypes.indexOf(e.options.file.type)>=0}),this.thingle=new App.Models.Thing},render:function(){if(this.mimetypes.indexOf(this.options.file.type)>=0){var e=this;this._readFileAsDataUrl(function(t,n){$(e.el).html(e.template({url:t})),e._uploadFile(t,n)})}else alert("Wrong file type!")},_readFileAsDataUrl:function(e){var t=new FileReader,n=this.options.file;t.onloadend=function(r){typeof e=="function"&&e(t.result,n)},t.readAsDataURL(n)},_uploadFile:function(e,t){var n=this,r=e.replace(/^data:[\w/;]+base64,/,"");$.ajax({type:"POST",url:"/api/drag_proxy",data:{content:r,type:t.type,fileName:t.name},dataType:"text",success:function(t){n.thingle.set("pictures",[{fileName:t}]),$(n.el).modal("hide");var r=$("<img />").attr("src",e);r.error(function(){alert("There was error while uploading your image. Reload the page and try again.")}),r.load(function(){$(this).width()>170&&$(this).attr("width",170),App.popup("thingles/new-popup-2",{thingle:n.thingle,img:this,deckId:n.options.deckId})})}})}})}),function(e){function n(t){var n=this;this.options=_.defaults(t,{dropdownClass:"combo-list",param:"name",searchParam:"q"}),this.$input=e(this.options.input),this.$input.attr("autocomplete","off").bind({keydown:function(e){n._moveSel(e)},keyup:function(e){n._keyup(e)},blur:function(e){n._blur(e)}}),this.$dropdown=e('<ul class="'+this.options.dropdownClass+'" />');var r=this.$input.offset();this.$dropdown.hide().appendTo("body"),this._runningRequest=null,this.$dropdown.on("click mousedown","li",function(e){n._clickSelection(e)}).on("mouseover","li",function(){e(this).addClass("hover")}).on("mouseout","li",function(){e(this).removeClass("hover")})}var t={UP:38,DOWN:40,ENTER:13,UC_Z:90,DIGIT_0:48,BACKSPACE:8};n.prototype._keyup=function(e){e.preventDefault();if((e.which>t.UC_Z||e.which<t.DIGIT_0)&&e.which!=t.BACKSPACE)return;this.pull()},n.prototype._blur=function(e){this.$dropdown.hide()},n.prototype._moveSel=function(n){if(!this.$dropdown.is(":visible"))return;var r=n.which,i=e("li.hover",this.$dropdown),s=e();switch(r){case t.DOWN:n.preventDefault(),s=i.length==0?e("li:first",this.$dropdown):i.next();break;case t.UP:n.preventDefault(),s=i.prev();break;case t.ENTER:n.preventDefault(),i.click()}s.length>0&&(i.mouseout(),s.mouseover())},n.prototype._showDropdown=function(){var e=this.$input.offset();this.$dropdown.css({position:"absolute",width:this.$input.width()+parseInt(this.$input.css("padding-right"))+parseInt(this.$input.css("padding-left")),left:e.left,top:e.top+this.$input.height()+parseInt(this.$input.css("padding-bottom"))+parseInt(this.$input.css("padding-top"))}).show()},n.prototype._clickSelection=function(t){this.$input.val(e(t.target).text()),this.$dropdown.hide()},n.prototype.pull=function(){var t=this;this.fetch(function(n){t.$dropdown.empty(),_.each(n,function(n){var r=n.get(t.options.param).replace(t.$input.val(),"<strong>$&</strong>");t.$dropdown.append(e("<li />").html(r))}),t._showDropdown()})},n.prototype.fetch=function(e){var t=this,n={},r=n[this.options.searchParam]=this.$input.val();if(r=="")return;if(!this.options.collection)throw"Collection was not set";this._runningRequest!==null&&this._runningRequest.abort(),this._runningRequest=this.options.collection.fetch({data:n,success:function(n,r){t._runningRequest=null,typeof e=="function"&&e(n.models)}})},e.fn.autocomplete=function(t){return typeof e(this).data("autocomplete")=="undefined"&&(t.input=this,e(this).data("autocomplete",new n(t))),this}}(jQuery),define("lib/thingle.autocomplete",function(){}),define("text!tpl/popups/thingles/new-popup-1.html",[],function(){return'<div class="modal-inner">\n    <div class="modal-header">\n        <button class="close" data-dismiss="modal"></button>\n        <h3>Create a Thingle</h3>\n    </div>\n    <div class="modal-body">\n        <fieldset>\n            <form id="grab-image-form">\n                <label>Grab images from the web</label>\n                <input name="url" type="url" class="span5" placeholder="http://">\n                <button class="btn btn-primary btn-submit">Find Images</button>\n            </form>\n\n            <p class="or">OR</p>\n            <form action="<%= params.get(\'action\') %>" method="post" enctype="multipart/form-data" id="upload-image-form">\n                <input type="hidden" name="key" value="<%= params.get(\'folder\') %>/${filename}">\n                <input type="hidden" name="AWSAccessKeyId" value="<%= params.get(\'AWSAccessKeyId\') %>">\n                <input type="hidden" name="acl" value="<%= params.get(\'acl\') %>">\n                <input type="hidden" name="success_action_redirect"\n                       value="<%= params.get(\'success_action_redirect\') %>">\n                <input type="hidden" name="policy" value="<%- params.get(\'policy\') %>">\n                <input type="hidden" name="signature" value="<%= params.get(\'signature\') %>">\n                <input type="hidden" name="Content-Type" value="image/jpeg">\n                <label>Upload a photo from your computer</label>\n                <input name="file" type="file">\n                <a id="upload-image-button" class="btn btn-primary btn-submit">Upload</a>\n            </form>\n\n        </fieldset>\n    </div>\n</div>'}),define("views/popups/thingles/new-popup-1",["require","lib/jquery.form","lib/thingle.autocomplete","text!tpl/popups/thingles/new-popup-1.html","helpers/html","helpers/image"],function(e){e("lib/jquery.form"),e("lib/thingle.autocomplete");var t=e("text!tpl/popups/thingles/new-popup-1.html"),n=Backbone.Model.extend({url:"/api/things/pictures/upload"}),r=e("helpers/html"),i=e("helpers/image");return Backbone.View.extend({uploadButton:"#upload-image-button",uploadForm:"form#upload-image-form",grabForm:"form#grab-image-form",events:{"submit form#grab-image-form":"_grabImage","click #upload-image-button":"_uploadImage"},mimetypes:{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"},template:_.template(t),initialize:function(){this.thingle=new App.Models.Thing},_grabImage:function(){var e=$("input[name=url]",this.$grabForm).val();if(!e)return alert("Enter image url to grab it"),!1;var t=this;return i.chooseFromURL(e,function(n){n=n instanceof Array?n:[n];var r=new Array;for(var i=0;i<n.length;i++)r.push({sourceURL:e,url:n[i]});t.thingle.set("pictures",r),t.thingle.set("sourceURL",e),t._showThingleForm(n[0])},function(){r.hidePreloader($("button.btn-submit",t.$grabForm))}),r.showPreloader($("button.btn-submit",this.$grabForm)),!1},_uploadImage:function(){var e=$("input[type=file]",this.$uploadForm).val();if(!e)return alert("Choose the file to upload"),!1;r.showPreloader($(this.uploadButton,this.$el));var t=e.match(/[^\.]+$/)[0].toLowerCase(),n=this;this.filename=this.params.get("folder")+"/"+this.params.get("uid")+"."+t,$("input[name=key]",this.uploadForm).val(this.filename);var i=this.mimetypes[t];return i?($('input[name="Content-Type"]',this.$uploadForm).val(i),this.$uploadForm.ajaxSubmit({success:function(e){console.log(e)},complete:function(e,t,r){n.thingle.set("pictures",[{fileName:n.filename}]),n._showThingleForm(n.params.get("action")+n.filename)}}),!1):alert("Wrong image type!")},_showThingleForm:function(e){var t=this,n=$("<img />").attr("src",e);n.error(function(){alert("There was error while uploading your image. Reload the page and try again.")}),n.load(function(){App.popup("thingles/new-popup-2",{thingle:t.thingle,img:this})}),$(this.el).modal("hide")},render:function(){var e=this;this.params=new n,this.params.fetch({success:function(t,n){$(e.el).html(e.template({params:t})),e.$grabForm=$(e.grabForm,this.$el),e.$uploadForm=$(e.uploadForm,this.$el),e.$uploadForm.ajaxForm()}})}})}),define("text!tpl/popups/thingles/new-popup-2.html",[],function(){return'<div class="modal-inner">\n    <div class="modal-header">\n        <button class="close" data-dismiss="modal"></button>\n        <h3>Create a Thingle</h3>\n    </div>\n    <div class="modal-body">\n        <div class="modal-top tab-main">\n            <div class="modal-top-inner">\n                <a id="link-change-image" href="#" class="select-diff-image">Select a different image</a>\n\n                <div class="img"></div>\n                <div class="info">\n                    <div class="control-group">\n                        <select name="deck" class="with-add-line required">\n                            <option value="" selected="selected">Choose a Collection</option>\n                            <% _.each(decks, function(deck) {%>\n                                <% var selected = selectedDeckId == deck.get("_id") ? "selected" : "" %>\n                                <option value="<%= deck.get(\'_id\') %>" <%= selected %> ><%= deck.get("name") %></option>\n                            <%}); %>\n                        </select>\n                    </div>\n                    <div class="control-group">\n                        <label>Title</label>\n                        <input name="title" class="required" type="text">\n                    </div>\n                    <div class="control-group">\n                        <label>Tags (comma separated values)</label>\n                        <input name="tags" type="text">\n                    </div>\n                    <div class="control-group">\n                        <label>Description</label>\n                        <textarea cols="30" rows="10" name="description"></textarea>\n                    </div>\n                    <div class="control-group">\n                        <label for="post-facebook" class="checkbox inline">\n                            <input type="checkbox" name="share" id="post-facebook" checked="checked"/>Post to Facebook\n                        </label>\n                    </div>\n                </div>\n            </div>\n            <a href="#" class="toggle-options">Open Options</a>\n        </div>\n        <div class="modal-bottom tab-options">\n            <div class="modal-bottom-inner">\n                <div class="form-horizontal">\n                    <div class="control-group">\n                        <div class="controls">\n                            <!-- <button class="btn attach-files" disabled>Attach Files</button>\n                                                      <span class="or">or</span> -->\n                            <button class="btn add-link">Find photos from web</button>\n                        </div>\n                    </div>\n                    <div class="control-group add-link-field">\n                        <form class="add-link-form" onsubmit="return false;">\n                            <input type="url" class="span5" placeholder="http://" name="link" />\n                            <input type="submit" class="btn btn-success" value="Find" />\n                        </form>\n                    </div>\n                </div>\n                <div class="scroll-pane">\n                    <ul class="attached-files">\n                    </ul>\n                </div>\n                <div class="form-horizontal">\n                    <div class="control-group add-tags">\n                        <label class="control-label">Add tags</label>\n\n                        <div class="controls">\n                            <form class="add-tag-form" onsubmit="return false;">\n                                <input type="text" name="add-tag" />\n                            </form>\n\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="modal-footer">\n        <div class="attached-count"><strong>0</strong> item<span class="plural-s">s</span> attached</div>\n        <button type="submit" class="btn btn-primary btn-submit">Create a Thingle</button>\n    </div>\n</div>'}),define("views/popups/thingles/new-popup-2",["require","lib/jquery.form","lib/thingle.autocomplete","text!tpl/popups/thingles/new-popup-2.html","helpers/select","helpers/html","helpers/image"],function(e){e("lib/jquery.form"),e("lib/thingle.autocomplete");var t=e("text!tpl/popups/thingles/new-popup-2.html"),n=Backbone.Collection.extend({model:App.Models.Deck,initialize:function(e){this.url="/api/users/"+e+"/decks"}}),r=Backbone.Collection.extend({url:"/api/tags",model:App.Models.Tag}),i=e("helpers/select"),s=e("helpers/html"),o=e("helpers/image");return Backbone.View.extend({auth:!0,_pictures:[],_links:[],events:{"click .toggle-options":"_toggleOptions","click .add-link":"_toggleAddLinkField","submit form.add-link-form":"_addLink","click ul.attached-files li a.remove":"_removeLink","click a#link-change-image":"_selectDifferentImage","click button.btn-submit":"_onSubmit","submit form.add-tag-form":"_addTag"},template:_.template(t),_fileTemplate:_.template('<li data-index="<%= index %>"><span><%= fileName %></span><a href="javascript:void(0)" class="remove">*</a></li>'),initialize:function(){this._thingle=this.options.thingle,typeof this.options.img=="undefined"&&(this.options.img=$("<img />").attr("src",this._thingle.getCoverPicture("medium").url)),this._links=this._thingle.get("links")||[],this._pictures=[],this._updateAttachedCounter()},_selectDifferentImage:function(){return $(this.el).modal("hide"),App.popup("thingles/new-popup-1"),!1},_updateAttributes:function(){var e={},t=this;_.each(["title","description","tags"],function(n){var r=t.$("[name="+n+"]").val().replace(/(^\s+|\s+$)/,"");typeof r!="undefined"&&r!=""&&(e[n]=r)});var n=t.$("[name=deck] option:selected").val();typeof n!="undefined"&&n!="0"&&n!=""&&(e.createdDeck=n),e.share=t.$("[name=share]").attr("checked")?!0:!1,e.tags=e.tags?e.tags.replace(/(^[\s,]+|[\s,]+$)/,"").replace(/(\s*,\s*)+/g,",").split(","):[],e.pictures=this._thingle.get("pictures"),_.each(e.pictures,function(t,n){typeof t.createdUser=="object"&&t.createdUser._id&&(e.pictures[n].createdUser=t.createdUser._id)}),_.each(this._pictures,function(t){e.pictures.push(t)}),this._thingle.set(e)},validate:function(){var e=this.$(".required:input");return this._thingle.isNew()?(e.removeClass("error"),_.each(e,function(e){console.log(e),($(e).is("select")&&$("option:selected",e).val()==""||$(e).is(":not(select)")&&$(e).val()=="")&&$(e).addClass("error")}),e.filter(".error").length==0):!0},_onSubmit:function(){function t(t){$(e.el).modal("hide"),App.popup("success",{title:"Create a Thingle",src:e._src,thing:e._thingle}),typeof e.options.onSubmit=="function"&&e.options.onSubmit()}if(!this.validate())return!1;s.showPreloader($("button.btn-submit",this.el));var e=this;this._thingle.fetch({success:function(n){e._updateAttributes(),e._thingle.save({},{success:t})}})},_addLink:function(){this._toggleAddLinkField();var e=$("[name=link]",this.el),t=e.val();if(t=="")return!1;e.val("");var n=this.$(".btn-submit"),r=this;s.showPreloader(n),o.chooseFromURL(t,function(e){r._addImageURL(t,e)},function(){s.hidePreloader(n)})},_addImageURL:function(e,t){t=t instanceof Array?t:[t];for(var n=0;n<t.length;n++){var r=this._pictures.push({sourceURL:e,url:t[n]})-1,i=$(this._fileTemplate({fileName:t[n],index:r}));i.hide().appendTo($("ul.attached-files",this.el)).slideDown("fast")}this._updateAttachedCounter()},_removeLink:function(e){var t=$(e.target).parents("li");this._pictures.splice(t.attr("data-index"),1),t.slideUp("fast",function(){$(this).remove()}),this._updateAttachedCounter()},_updateAttachedCounter:function(){var e=$(".attached-count strong",this.el),t=this._pictures.length;e.text(t.toString()),t==1?e.siblings("span.plural-s").hide():e.siblings("span.plural-s").show()},_addTag:function(){var e=$("[name=tags]",this.el);$tag=$("[name=add-tag]"),tags=e.val();if($tag.val()=="")return;e.val(tags==""?$tag.val():tags+","+$tag.val()),$tag.val("")},_toggleAddLinkField:function(){var e=$(this.el),t=$(".add-link",e);t.is(":disabled")?t.prop("disabled",!1):t.prop("disabled",!0),$(".add-link-field",e).slideToggle("fast")},_closeAddLinkField:function(e){var t=$(e.target),n=$(this.el);t.prop("disabled",!1),$(".add-link-field",n).slideDown("fast")},_toggleOptions:function(e){var t=$(this.el),n=t.find(".modal-top"),r=t.find(".modal-bottom"),i=$(e.target);r.slideToggle(),t.hasClass("opened")?(i.text("Open Options"),n.animate({height:451},"normal",function(){$(this).children(".modal-top-inner").fadeIn("fast")})):(i.text("Close Options"),n.children(".modal-top-inner").fadeOut(100).end().animate({height:15},"normal",function(){t.find(".scroll-pane").jScrollPane({autoReinitialise:!0,mouseWheelSpeed:100})})),t.toggleClass("opened")},_displayOptions:function(){this.$(".tab-main").hide(),this.$(".tab-options").show(),$(this.el).addClass("opened")},_createDeck:function(e){var t=$(e.target).parents(".new-deck-field"),n=$("input[type=text]",t).val(),r=this;if(!n)return;$(r.el).modal("hide"),$(e.target).parents(".combo-list").hide(),App.popup("decks-new",{deckName:n}),App.on("deckCreated",function(e){$(r.el).modal("show"),r.$("select[name=deck]").append('<option value="'+e.deck_id+'">'+n+"</option>").val(e.deck_id).change()})},render:function(){var e=this;e._src=$(e.options.img).attr("src");var t=new n(App.currentUser.get("_id"));t.fetch({success:function(t){$(e.el).html(e.template({decks:t.models,selectedDeckId:e.options.deckId})),e._thingle.isNew()?($(".img",e.el).append(e.options.img),e._onImageLoad(function(t){if($(t)[0].naturalWidth<220||$(t)[0].naturalHeight<100)alert("Image is too small!"),$(e.el).modal("hide"),App.popup("thingles/new-popup-1")})):(e._displayOptions(),$("[name=tags]",e.el).val(e._thingle.get("tags").join(",")),e.$("h3").text("Add More Content"),e.$(".btn-submit").text("Add Content")),i.customize(e.el),$(".new-deck-field .btn-primary").live("click",function(t){e._createDeck(t)}),$("input[name=add-tag]",this.el).autocomplete({collection:new r,attr:"name"})}})},_onImageLoad:function(e){if(typeof e!="function")return;var t=$(this.options.img);t.width()==0&&t.height()==0?t.load(function(){e(this.options.img)}):e(this.options.img)}})})